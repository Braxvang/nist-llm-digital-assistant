NIST SP 800-85A-4                                        PIV CARD APPLICATION & MIDDLEWARE
                                                                  INTERFACE TEST GUIDELINES

                       6. Call pivGenerateKeyPair with
                          • (IN) cardHandle
                          • (IN) keyReference
                          • (IN) cryptographicMechanism
                          • (OUT) publicKey
                          • (INOUT) KeyLength
 Expected Result(s)    Call returns with status_word of PIV_INSUFFICIENT_BUFFER and sets
                       the KeyLength parameter to the length of the returned public key.
 Postcondition(s)      1. A new key pair is generated.
                       2. The precondition states are unaffected.


B.9         pivCrypt

B.9.1        Valid Test Assertions

B.9.1.1       Authenticate the Card Application to Client Application
 Purpose            Exercise the PIV Middleware to perform Internal Authenticate.
 Target             pivCrypt
 Reference(s)       1. SP 800-73-4 Part 3, Section 3.3.1
                    2. AS04.01, AS04.02A-R4, AS04.08
 Precondition(s)    1. The client application owns a connection to the PIV Card
                        Application accessible through cardHandle.
                    2. The client is logged into the PIV Card Application (required for
                        step 1 for the '9A' PIV Authentication key).
 Test Steps         1.  Set cardHandle := <<valid cardHandle>>
                       2. Set keyReference := <<'9A'>>
                       3. Set algorithmIdentifier := <<'07' or '11'>>
                       4. Set algorithmInput := <<Use the Dynamic Authentication
                          Template format (Table 7 of SP 800-73-4 Part 2) to encode
                          a challenge to be sent to the card>>
                       5. Create algorithmOutput reference
                       6. Call pivCrypt with
                          • (IN) cardHandle
                          • (IN) algorithmIdentifier
                          • (IN) keyReference
                          • (IN) algorithmInput
                          • (IN) inputLength
                          • (OUT) algorithmOutput
                          • (INOUT) outputLength
                       7. Repeat steps 1 – 6, but with the '9E' key (Card
                          Authentication key), and algorithmIdentifier := <<'00',
                          '03', '07', '08', '0A', '0C', or '11'>>
                       8. Perform pivLogIntoCardApplication with PIV Card
                          Application PIN and repeat steps 1 – 6, but with the '9C'
                          key (digital signature key), algorithm <<'07', '11' or
                          '14'>> and data to sign instead of a challenge
                       9. Repeat steps 1 – 6, but with the '9D' key (key management
                          key), algorithm <<'07', '11' or '14'>> and an encrypted



                                      B-25
