      NIST SP 800-63C-4 ipd                                               Digital Identity Guidelines
      December 2022                                                       Federation and Assertions


473   using an asymmetric key, the IdP MAY use the same public and private key pair to
474   sign assertions to multiple RPs. The IdP MAY publish its public key in a verifiable
475   fashion, such as at an HTTPS-protected URL at a well-known location. If the assertion
476   is protected by a keyed message authentication code (MAC) using a shared key, the IdP
477    SHALL use a different shared key for each RP.

478   At FAL1, the trust agreement between the IdP and RP MAY be established entirely
479   dynamically. For instance, the subscriber can identify their chosen IdP to the RP at
480   runtime, allowing the RP to discover the IdPâ€™s parameters and register itself for use by
481   the subscriber. The subscriber is prompted by the IdP to determine which attributes are
482   released to the RP, and for what purposes. In this example, the trust between the IdP and
483   RP is driven entirely by the desires and actions of the subscriber. Note that at FAL1, it is
484   still possible for the trust agreement and registration to happen statically.
485   In existing federation protocols, FAL1 can be implemented with the OpenID Connect
486   Implicit Client profile [OIDC-Implicit], the OpenID Connect Hybrid Client profile in
487   [OIDC], or the SAML Web SSO [SAML-WebSSO] profile with no additional features.
488   In each of these profiles, the assertion is signed by the IdP and the RP is identified in a
489   portion of the assertion covered by the signature.

490   4.2. Federation Assurance Level 2 (FAL2)
491   All the requirements for FAL1 apply at FAL2 except where overridden by more specific
492   or stringent requirements here.
493   At FAL2, the assertion SHALL also be strongly protected from being injected by an
494   attacker. To accomplish this, the assertion SHOULD be presented using back channel
495   presentation as discussed in Sec. 7.1, as in the OpenID Connect Basic Client profile
496   [OIDC-Basic]. In this presentation method, the RP fetches the assertion directly from
497   the IdP by using a single-use assertion reference, thereby preventing an attacker from
498   injecting the assertions through an external access point. If front channel presentation is
499   used as discussed in Sec. 7.2, additional injection protections SHALL be implemented by
500   the RP.
501   Regardless of the presentation method used, injection attacks can be further mitigated by
502   always requiring that the federation transaction start at the RP instead of being initiated by
503   the IdP, thereby allowing the RP to associate an incoming assertion with a specific request
504   that the subscriber initiated within a continuous session.
505   At FAL2, the trust agreement between the IdP and RP SHALL be established statically,
506   including establishing limits of which attributes are made available to the RP and for what
507   purpose. This trust agreement MAY be bilateral between the IdP and RP or MAY be
508   managed through the use of a multilateral federation partnership. The registration MAY
509   be dynamic, provided that the RP and IdP can prove their connection at runtime to the
510   established trust agreement between them. Such methods for this proof vary by federation

                                                    8
