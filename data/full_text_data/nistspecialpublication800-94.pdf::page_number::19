                                                           GUIDE TO INTRUSION DETECTION AND PREVENTION SYSTEMS (IDPS)



mails, initiate large numbers of network connections, and perform other behavior that would be
significantly different from the established profiles for the computer.

An initial profile is generated over a period of time (typically days, sometimes weeks) sometimes called a
training period. Profiles for anomaly-based detection can either be static or dynamic. Once generated, a
static profile is unchanged unless the IDPS is specifically directed to generate a new profile. A dynamic
profile is adjusted constantly as additional events are observed. Because systems and networks change
over time, the corresponding measures of normal behavior also change; a static profile will eventually
become inaccurate, so it needs to be regenerated periodically. Dynamic profiles do not have this problem,
but they are susceptible to evasion attempts from attackers. For example, an attacker can perform small
amounts of malicious activity occasionally, then slowly increase the frequency and quantity of activity. If
the rate of change is sufficiently slow, the IDPS might think the malicious activity is normal behavior and
include it in its profile. Malicious activity might also be observed by an IDPS while it builds its initial
profiles.

Inadvertently including malicious activity as part of a profile is a common problem with anomaly-based
IDPS products. (In some cases, administrators can modify the profile to exclude activity in the profile
that is known to be malicious.) Another problem with building profiles is that it can be very challenging
in some cases to make them accurate, because computing activity can be so complex. For example, if a
particular maintenance activity that performs large file transfers occurs only once a month, it might not be
observed during the training period; when the maintenance occurs, it is likely to be considered a
significant deviation from the profile and trigger an alert. Anomaly-based IDPS products often produce
many false positives because of benign activity that deviates significantly from profiles, especially in
more diverse or dynamic environments. Another noteworthy problem with the use of anomaly-based
detection techniques is that it is often difficult for analysts to determine why a particular alert was
generated and to validate that an alert is accurate and not a false positive, because of the complexity of
events and number of events that may have caused the alert to be generated.

2.3.3    Stateful Protocol Analysis

Stateful protocol analysis is the process of comparing predetermined profiles of generally accepted
definitions of benign protocol activity for each protocol state against observed events to identify
deviations. 6 Unlike anomaly-based detection, which uses host or network-specific profiles, stateful
protocol analysis relies on vendor-developed universal profiles that specify how particular protocols
should and should not be used. The “stateful” in stateful protocol analysis means that the IDPS is capable
of understanding and tracking the state of network, transport, and application protocols that have a notion
of state. For example, when a user starts a File Transfer Protocol (FTP) session, the session is initially in
the unauthenticated state. Unauthenticated users should only perform a few commands in this state, such
as viewing help information or providing usernames and passwords. An important part of understanding
state is pairing requests with responses, so when an FTP authentication attempt occurs, the IDPS can
determine if it was successful by finding the status code in the corresponding response. Once the user has
authenticated successfully, the session is in the authenticated state, and users are expected to perform any
of several dozen commands. Performing most of these commands while in the unauthenticated state
would be considered suspicious, but in the authenticated state performing most of them is considered
benign.


6
    Some vendors use the term “deep packet inspection” to refer to performing some type of stateful protocol analysis, often
    combined with a firewall capability that can block communications determined to be malicious. This publication uses the
    term “stateful protocol analysis” because it is appropriate for analyzing both network-based and host-based activity, whereas
    “deep packet inspection” is an appropriate term for network-based activity only. Also, historically there has not been
    consensus in the security community as to the meaning of “deep packet inspection”.


                                                              2-5
