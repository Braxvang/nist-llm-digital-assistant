                                                                                              NIST SP 800-77 REV. 1                                                         GUIDE TO IPSEC VPNS


                                                                                              2001:db8:1:2::23 2001:db8:1:2::45
                                                                                                      esp mode=tunnel spi=1675186937(0x63d952f9) reqid=1(0x00000001)
                                                                                                      E: rijndael-cbc 1dd058ed 63905223 147979df 1865bfb3
                                                                                                      A: hmac-sha1 fde84c78 b2c90386 600927e3 1eb3dcf8 3163d053
                                                                                                      seq=0x00000000 replay=0 flags=0x00000000 state=mature
                                                                                                      created: Feb 2 17:29:42 2019    current: Feb 2 17:37:19 2019
                                                                                                      diff: 457(s)    hard: 3600(s)   soft: 2960(s)
                                                                                                      last:                           hard: 0(s)      soft: 0(s)
                                                                                                      current: 0(bytes)       hard: 0(bytes) soft: 0(bytes)
                                                                                                      allocated: 0    hard: 0 soft: 0
                                                                                                      sadb_seq=1 pid=1404 refcnt=1
                                                                                              2001:db8:1:2::45 2001:db8:1:2::23
This publication is available free of charge from: https://doi.org/10.6028/NIST.SP.800-77r1




                                                                                                      esp mode=tunnel spi=3301523791(0xc4c9414f) reqid=1(0x00000001)
                                                                                                      E: rijndael-cbc d32b7287 8e0ef003 3a2bac01 4b14d0c7
                                                                                                      A: hmac-sha1 1a3b1fc7 091e76f5 860456f2 5342ceaa bc33a3d3
                                                                                                      seq=0x00000000 replay=4 flags=0x00000000 state=mature
                                                                                                      created: Feb 2 17:29:42 2019    current: Feb 2 17:37:19 2019
                                                                                                      diff: 457(s)    hard: 3600(s)   soft: 2611(s)
                                                                                                      last:                           hard: 0(s)      soft: 0(s)
                                                                                                      current: 0(bytes)       hard: 0(bytes) soft: 0(bytes)
                                                                                                      allocated: 0    hard: 0 soft: 0
                                                                                                      sadb_seq=0 pid=1404 refcnt=1
                                                                                                          Figure 13: Example of an ESP IPsec SA Using a Non-AEAD Algorithm on FreeBSD

                                                                                              The IPsec SA state information consists of:
                                                                                                 •   The SPI that uniquely identifies the IPsec SA
                                                                                                 •   IP addresses of the local and remote hosts that send and receive IPsec packets
                                                                                                 •   Cryptographic algorithms and their key material for encryption and integrity
                                                                                                 •   A link to the associated security policy (sometimes called reqid)
                                                                                                 •   The mode (tunnel or transport)
                                                                                                 •   The encapsulation state (transport protocol, port numbers, and optional framing)
                                                                                                 •   The current and maximum byte and packet counters allowed
                                                                                                 •   The current and maximum timers for idleness and age allowed
                                                                                                 •   An anti-replay context such as the current sequence number
                                                                                                 •   A link to the IPComp state, if present
                                                                                                 •   Flags indicating various properties (TFC padding, etc.)

                                                                                              The maximum counters and lifetimes have a soft and hard value. When the soft value is reached,
                                                                                              the kernel will notify the IKE daemon so that it can take preventative action. When the hard
                                                                                              value is reached, the IPsec SA is deleted by the kernel, and the IKE daemon is notified. Each
                                                                                              time a packet is encrypted or decrypted, this state is updated appropriately.




                                                                                                                                              49
