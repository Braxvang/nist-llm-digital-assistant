                                                                                              NIST SP 800-77 REV. 1                                                             GUIDE TO IPSEC VPNS


                                                                                              compression. If the compressed result is smaller, the compressed packet is encrypted. On the
                                                                                              receiving end, the packet is decrypted, and if it was compressed, it will be decompressed.

                                                                                              However, applications that send large amounts of data usually already compress their data. At
                                                                                              that point, attempting to compress already compressed data will not yield smaller packets, and a
                                                                                              host will ultimately waste CPU cycles at the IPsec layer attempting futile compression. As such,
                                                                                              IPsec level compression has not seen widespread use. This might change in the near future with
                                                                                              the emergence of IoT devices and other battery-powered devices that use mobile data (LTE/5G).
                                                                                              These devices save battery power by transmitting fewer bytes, even if that reduction requires
                                                                                              more CPU power for compression. For non-IoT-based IPsec, NIST does not recommend using
                                                                                              IPComp due to the risk of weakening security and the introduction of complexity to the
This publication is available free of charge from: https://doi.org/10.6028/NIST.SP.800-77r1




                                                                                              encryption function. It is also not universally implemented since its status was always optional.

                                                                                              4.4       Authentication Header (AH)

                                                                                              As with ESP, AH can be used in tunnel mode and transport mode. It offers only integrity
                                                                                              algorithms and provides no confidentiality. The ESP protocol can use null encryption (ESP
                                                                                              algorithm number 12) with an integrity algorithm, such as HMAC-SHA-2, to accomplish the
                                                                                              same as AH. Alternatively, ESP can use an AEAD algorithm, such as AES-GMAC (ESP
                                                                                              algorithm number 21), to offer integrity without confidentiality to replace AH.

                                                                                              NIST discourages the use of AH in this publication. The IETF has specified that AH is an
                                                                                              optional IPsec protocol, which means it is not mandatory to implement and might not be
                                                                                              available with all IPsec implementations. It is recommended that null encryption with the ESP
                                                                                              protocol be used instead of the AH protocol when encryption is not desired.

                                                                                              Some implementations support the legacy IPsec-v2 ESP without authentication in combination
                                                                                              with AH. This is usually referred to as AH+ESP. This combined mode (ESP for encryption and
                                                                                              AH for integrity) is no longer recommended [25] since it provides no advantage over regular
                                                                                              ESP with authentication. Regular ESP with authentication also reduces the effective MTU
                                                                                              compared to AH+ESP, due to the additional overhead of an AH header plus an ESP header
                                                                                              versus just an ESP header with authentication.

                                                                                              4.5       Summary

                                                                                              This section has described the IPsec protocols ESP, IPComp, and AH. The following
                                                                                              summarizes the key points from the section:
                                                                                                    •    The IKE protocol is used to manage IPsec security associations.
                                                                                                    •    ESP is the main IPsec protocol and provides integrity protection for all packet headers
                                                                                                         and data with the exception of a few IP header fields that routinely change unpredictably
                                                                                                         in transit. Since those header fields can change as the packet travels from sender to
                                                                                                         receiver, they cannot be included in the integrity check calculation; if they were included,
                                                                                                         that value would then be different for the sender and the receiver. ESP also provides
                                                                                                         confidentiality protection through the encryption of data. It does not encrypt the headers




                                                                                                                                                  45
