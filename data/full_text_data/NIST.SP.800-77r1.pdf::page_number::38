                                                                                              NIST SP 800-77 REV. 1                                                                                    GUIDE TO IPSEC VPNS


                                                                                               Byte 1                            Byte 2                           Byte 3                           Byte 4
                                                                                                                                                    IKE SA Initiator’s SPI
                                                                                                                                                  IKE SA Responder’s SPI
                                                                                                       Next Payload               Major IKE       Minor IKE             Exchange Type                       Flags
                                                                                                                                   Version         Version
                                                                                                                                                         Message ID
                                                                                                                                      Length of total message (IKE header plus data)

                                                                                                                                                          IKE DATA
This publication is available free of charge from: https://doi.org/10.6028/NIST.SP.800-77r1




                                                                                                                                           Figure 6: The IKEv2 Packet Format

                                                                                              The initiator of an IKE exchange generates a four-byte Initiator SPI. The responder generates the
                                                                                              four-byte Responder SPI. In the first IKE packet sent by the Initiator, the Responder SPI is
                                                                                              0x00000000. The SPI numbers are used to uniquely identify an established IKE SA. Each
                                                                                              endpoint selects the corresponding IKE encryption/decryption key for an encrypted IKE message
                                                                                              from its endpoint to the other endpoint based on the SPI numbers.

                                                                                              An IKE session consists of IKE packet exchanges. Each exchange consists of a single request
                                                                                              packet and a single reply packet. If there is any packet loss, it is the initiator’s responsibility to
                                                                                              retransmit its request. 21 Each exchange packet has a message ID, which starts at zero and is
                                                                                              incremented for each message exchange. The message ID allows for detecting retransmitted
                                                                                              packets and handling out-of-order IKE packets. There is a distinct message ID for messages
                                                                                              started at each IKE peer (endpoint).

                                                                                              The IKEv2 protocol uses two exchanges to establish an IKE SA and an associated IPsec SA. The
                                                                                              IKE SA is then used to send and receive further configuration and management commands. The
                                                                                              first exchange is called IKE_SA_INIT, and the second exchange is called IKE_AUTH. Together,
                                                                                              these two exchanges are referred to as the initial exchanges. Once these two exchanges are
                                                                                              completed, both the initiator and the responder have established the IKE SA and one IPsec SA.
                                                                                              Once the IKE SA is established, other additional exchange types are used to establish additional
                                                                                              IPsec SAs, rekey the existing IKE SA or the IPsec SAs, make configuration changes, perform a
                                                                                              liveness detection of peers, and terminate IKE or IPsec SAs.

                                                                                              The following sections describe the IKE exchanges in detail and explain how they work together
                                                                                              to establish IPsec connections.

                                                                                              3.2      IKE Exchange Types

                                                                                              The exchange type for additional IPsec SA messages is called CREATE_CHILD_SA. Another
                                                                                              common exchange type is the INFORMATIONAL exchange, which is used for notification
                                                                                              messages such as IPsec SA deletions, rekeying, liveness (dead peer detection), and mobility




                                                                                              21    In IKEv1, either party could retransmit, which led to race conditions and amplification attacks.



                                                                                                                                                               21
