                                                                           GUIDELINES FOR THE SECURE DEPLOYMENT OF IPV6


for tunneled traffic. Servers do not forward ordinary traffic for clients. The Teredo client and Teredo
server only communicate when:

         Getting an IPv6 address for the client
         Helping the client get through the NAT with Teredo Bubbles, empty (protocol 59) IPv6
          packets designed to create mappings through the NAT, or
         Sending an IPv6 ping to other IPv6 nodes to discover the best Teredo relay for that address.
A Teredo client can learn about other Teredo clients on its own IPv4 network by using the IPv4 multicast
address 224.0.0.253.

IPv6 addresses for Teredo clients are comprised of the following five parts:

         Prefix: the 32-bit Teredo service prefix 2001:0000::/32
         Server IPv4: the 32-bit IPv4 address of a Teredo server
         Flags: 16 bits set to 8000 for cone NATs and 0000 otherwise
         The Teredo client’s 16-bit UDP port number, inverted bit by bit
         The Teredo client’s 32-bit IPv4 address (behind the NAT), inverted bit by bit.

The parts are illustrated in Figure 6-5.

     +-------------+-------------+-------+------+-------------+
     | Prefix               | Server IPv4 | Flags | Port | Client IPv4 |
     +-------------+-------------+-------+------+-------------+
                                                Figure 6-5. Teredo Address




6.5.7.2       Security Considerations for Teredo

The Teredo specification, RFC 4380, Teredo: Tunneling IPv6 over UDP through Network Address
Translations (NATs) and a subsequent Internet Draft, Security Concerns with Tunneling55, contain lengthy
descriptions of Teredo security considerations, including:

         Teredo allows the use of end-to-end IPsec for the encapsulated IPv6 traffic, thereby preventing
          the inspection of Teredo encapsulated traffic.
         No effective method exists to disable Teredo and filter all Teredo traffic. The initial
          communication with the Teredo server (UDP Port 3544) is easily recognizable, but the port
          assignment can easily be changed.


55
     See the current version of the IETF Internet Draft, Security Concerns with IP Tunneling, Work in Progress.




                                                             6-24
