                                                                          GUIDELINES ON FIREWALLS AND FIREWALL POLICY


4.1.3    TCP and UDP

Application protocols can use TCP, UDP, or both, depending on the design of the protocol. An
application server typically listens on one or more fixed TCP or UDP ports. Some applications use a
single port, but many applications use multiple ports. For example, although SMTP uses TCP port 25 for
sending mail, it uses TCP port 587 for mail submission. Similarly, FTP uses at least two ports, one of
which can be unpredictable, and while most web servers use only TCP port 80, it is common to have web
sites that also use additional ports such as TCP port 8080. Some applications use both TCP and UDP; for
example, DNS lookups can occur on UDP port 53 or TCP port 53. Application clients typically use any of
a wide range of ports.

As with other aspects of firewall rulesets, deny by default policies should be used for incoming TCP and
UDP traffic. Less stringent policies are generally used for outgoing TCP and UDP traffic because most
organizations permit their users to access a wide range of external applications located on millions of
external hosts.

In addition to allowing and blocking UDP and TCP traffic, many firewalls are also able to report or block
malformed UDP and TCP traffic directed towards the firewall or to hosts protected by the firewall. This
traffic is frequently used to scan for hosts, and may also be used in certain types of attacks. The firewall
can help block such activity—or at least report when such activity is happening.

4.1.4    ICMP

Attackers can use various ICMP types and codes to perform reconnaissance or manipulate the flow of
network traffic. 18 However, ICMP is needed for many useful things, such as getting reasonable
performance across the Internet. Some firewall policies block all ICMP traffic, but this often leads to
problems with diagnostics and performance. Other common policies allow all outgoing ICMP traffic, but
limit incoming ICMP to those types and codes needed for Path Maximum Transmission Unit (PMTU)
discovery (ICMP code 3) and destination reachability.

To prevent malicious activity, firewalls at the network perimeter should deny all incoming and outgoing
ICMP traffic except for those types and codes specifically permitted by the organization. For ICMP in
IPv4, ICMP type 3 messages should not be filtered because they are used for important network
diagnostics. The ping command (ICMP code 8) is an important network diagnostic, but incoming pings
are often blocked by firewall policies to prevent attackers from learning more about the internal topology
of the organization’s network. For ICMP in IPv6, many types of messages must be allowed in specific
circumstances to enable various IPv6 features. See RFC 4890, Recommendations for Filtering ICMPv6
Messages in Firewalls, for detailed information on selecting which ICMPv6 types to allow or disallow for
a particular firewall type.

ICMP is often used by low-level networking protocols to increase the speed and reliability of networking.
Therefore, ICMP within an organization’s network generally should not be blocked by firewalls that are
not at the perimeter of the network, unless security needs outweigh network operational needs. Similarly,
if an organization has more than one network, ICMP that comes from or goes to other networks within the
organization should not be blocked.




18
     ICMP type and code numbers are defined at http://www.iana.org/assignments/icmp-parameters.


                                                           4-4
