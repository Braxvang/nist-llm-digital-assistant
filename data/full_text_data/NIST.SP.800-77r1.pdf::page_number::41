                                                                                              NIST SP 800-77 REV. 1                                                                                     GUIDE TO IPSEC VPNS


                                                                                              authentication method can be different between the two endpoints, although they often use the
                                                                                              same method. One example of using different authentication methods by each party is a remote
                                                                                              access VPN where the server is authenticated using its X.509 certificate, but clients are
                                                                                              authenticated via EAP-TLS. 25

                                                                                              Once the IKE_SA_INIT and IKE_AUTH exchanges have successfully completed, the two hosts
                                                                                              have set up an IKE SA and an IPsec SA. Any further communication will be sent using the
                                                                                              encrypted and authenticated IKE SA.

                                                                                              3.2.2.1 Traffic Selectors
This publication is available free of charge from: https://doi.org/10.6028/NIST.SP.800-77r1




                                                                                              The IKE_AUTH exchange negotiates the IPsec SA network parameters, such as the source and
                                                                                              destination IP address, the address family, the source and destination ports, and the protocol,
                                                                                              using traffic selectors. A traffic selector consists of:
                                                                                                   •    The traffic selector type (e.g., IPv4 or IPv6 type)
                                                                                                   •    The IP address range (start address and end address)
                                                                                                   •    The IP protocol number (0 means all protocols)
                                                                                                   •    The port range (start and end port, 0-65535 means all ports) 26

                                                                                              Additional traffic selector components are possible, too, such as Network Label or Security
                                                                                              Context.

                                                                                              Traffic selectors are negotiated in sets of two. A set of two traffic selectors denotes the policy for
                                                                                              the source and destination traffic—one for the inbound traffic and one for the outbound traffic of
                                                                                              the IPsec SA. The IKE_AUTH request contains at least the TSi and TSr. The TSi describes the
                                                                                              sending and receiving address of the initiator, and the TSr describes the sending and receiving
                                                                                              address of the responder.

                                                                                              IKEv2 allows the concept of narrowing, where the responder picks a subset of the TSi/TSr that
                                                                                              the initiator requested. This facilitates setting up a number of smaller-range IPsec SAs instead of
                                                                                              one large network-to-network IPsec SA. This can enhance parallel processing. It is also used for
                                                                                              the initiator obtaining an IP address from the responder where the initiator requests every address
                                                                                              on the internet (by requesting 0.0.0.0/0) and is narrowed down by the responder to one IP
                                                                                              address (e.g., 192.0.2.1/32).

                                                                                              An additional traffic selector pair can be included that contains the actual source, destination, and
                                                                                              protocol values from the packet that triggered the IKE session at the initiator. This assists the
                                                                                              responder in narrowing traffic selectors to a range that includes the traffic that the initiator wants
                                                                                              to send to the responder.


                                                                                              25   Since IPsec is usually a system service, using a certificate on the client would require administrative privileges on the client.
                                                                                                   If EAP credentials are used on the client instead, they could be stored in the non-administrative user’s own profile.
                                                                                              26   For protocols without ports, 0 is used. For protocols with no ports but types, such as ICMP, the value is used to denote type
                                                                                                   ranges.



                                                                                                                                                               24
