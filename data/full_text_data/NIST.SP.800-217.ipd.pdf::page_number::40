       NIST SP 800-217 ipd                         Guidelines for PIV Federation (Initial Public Draft)
       January 2023


1044   Appendix A.      Examples
1045   This appendix is informative.
1046   This appendix contains several example scenarios of PIV federation in various
1047   environments and applications to show different kinds of trust establishment, account
1048   management, and authenticator usage. The details of the federation transactions within
1049   each scenario all follow the common patterns discussed in [SP800-63C] and adhere to the
1050   requirements in this document.
1051   The scenarios in this section are for illustrative purposes and do not convey additional
1052   requirements beyond those imposed by this specification.

1053   A.1. Direct Connection to the Home IdP
1054   Agency A, which issues and manages PIV identity accounts, sets up an OpenID Connect
1055   IdP in order to make its PIV identity accounts available online through a federation
1056   process. The agency publishes its home IdP record from its publicly available website
1057   with all required information for RPs to consume.
1058   The RP enters into a pairwise trust agreement with the IdP to accept assertions for
1059   Agency A. The RP declares the set of attributes that it needs from the IdP as part of this
1060   agreement. The RP uses a just-in-time provisioning system to establish an RP subscriber
1061   account only once the subscriber logs in for the first time. The RP has other pairwise
1062   agreements with other IdPs to accept assertions for different agencies but will reject any
1063   assertions for accounts at Agency A that come from any other IdP.
1064   The IdP generates a pairwise federated identifier for the PIV identity account for each
1065   RP that it is in contact with by hashing the identifier for the RP along with a randomly
1066   generated value stored with the PIV identity account at the IdP. This way, each new RP
1067   that signs on to the IdP gets a different federated identifier for a single account, but a
1068   consistent federated identifier is used for each RP with that account.
1069   Per the terms of the trust agreement, the subscriber is prompted by the IdP the first
1070   time they log on to the RP. The IdP asks for the subscriberâ€™s consent at runtime to share
1071   attributes with the RP. The IdP also prompts the subscriber to allow the IdP to remember
1072   this consent decision. This stored decision causes the IdP to act on the stored consent in a
1073   future request and not prompt the subscriber if the same RP requests the same attributes.

1074   A.2. Multilateral Federation Network
1075   Agencies A, B, and C each have a home IdP running OpenID Connect for their PIV
1076   identity accounts. All three agencies join a multilateral federation in which the federation
1077   authority independently verifies that each home IdP represents the agency in question.
1078   The federation authority publishes the home IdP records for all agencies that are part of
1079   the multilateral federation. This publication allows RPs within the federation to discover

                                                   30
