                                                                                              NIST SP 800-77 REV. 1                                                                                    GUIDE TO IPSEC VPNS


                                                                                              3        Internet Key Exchange (IKE)

                                                                                              When two hosts want to set up an IPsec connection with each other, the parameters of the IPsec
                                                                                              connection need to be negotiated (e.g., the source and destination IP addresses that are allowed,
                                                                                              the encryption algorithms to use, and the cryptographic key material to use for the encryption
                                                                                              and decryption of packets). The hosts also need to authenticate each other. All of this is done
                                                                                              using the Internet Key Exchange (IKE) protocol. The version of the IKE protocol described in
                                                                                              this section is IKE version 2 (IKEv2) and is specified in RFC 7296 [23]. 17 The differences
                                                                                              between IKEv1 and IKEv2 are described at the end of this section.

                                                                                              Typically, IKE runs as a privileged process, while IPsec usually runs as part of the operating
This publication is available free of charge from: https://doi.org/10.6028/NIST.SP.800-77r1




                                                                                              system kernel. The IKE process is responsible for configuring the kernel for IPsec. The kernel is
                                                                                              responsible for the actual packet encryption and decryption operations. The IKE process can
                                                                                              insert a policy into the kernel that will instruct the kernel to warn the IKE process when an
                                                                                              unencrypted packet matching certain source and destination IP addresses and/or other criteria is
                                                                                              about to be transmitted. If the peers can mutually authenticate each other and agree on other
                                                                                              policy details, then the IKE process can negotiate an IPsec tunnel that covers this packet. This is
                                                                                              used for creating IPsec tunnels on demand.

                                                                                              3.1      Overview of IKE

                                                                                              The IKE protocol can be considered the command channel. The IPsec protocol is the data
                                                                                              channel; it encrypts and decrypts the IP packets and verifies that the source and destination IP
                                                                                              address conform to the negotiated policies. The IKE protocol command channel itself also needs
                                                                                              to be encrypted to ensure the privacy of the parameters of the IPsec connection. In other words,
                                                                                              first the IKE encrypted connection is established, and then one or more IPsec connections are
                                                                                              established through the protected IKE command channel. 18 The IKE protocol is used to establish
                                                                                              an IKE Security Association (IKE SA) [23]. 19 An IPsec connection is called an IPsec SA or Child
                                                                                              SA. 20 Both IKEv2 SAs and IPsec SAs are identified by Security Parameters Index (SPI)
                                                                                              numbers; for IKEv1, other fields are used as the SA identifier until the IPsec SPIs are
                                                                                              established.

                                                                                              The IKE protocol consists of UDP messages on port 500 and 4500. As shown in Figure 6, each
                                                                                              IKE packet consists of a fixed IKE header (the first five lines of the figure) followed by the
                                                                                              variable-length IKE data.




                                                                                              17    The base protocol is defined in [23], but many IKE extensions have their own RFCs.
                                                                                              18    The IKEv2 protocol has been optimized to do some of this in parallel. As a result, the first IKE connection and the first
                                                                                                    IPsec connection are established at the same time.
                                                                                              19    An IKE SA is also called a Parent SA. In IKEv1, these were called Internet Security Association and Key Management
                                                                                                    Protocol (ISAKMP) SA or “Phase 1.”
                                                                                              20    In IKEv1, these were called “Phase 2.”



                                                                                                                                                               20
