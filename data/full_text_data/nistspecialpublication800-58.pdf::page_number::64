NIST SP 800-58                                             Voice Over IP Security
    _________________________________________________________________________

         used to set up the call, can dramatically alter the time necessary to prepare a VOIP
         connection.


 7.4.1    Application Level Gateways

         Application Level Gateways (ALGs) are the typical commercial solution to the
         firewall/NAT traversal problem [10]. An ALG is embedded software on a
         firewall or NAT, that allows for dynamic configuration based on application
         specific information. A firewall with a VOIP ALG can parse and understand
         H.323 or SIP, and dynamically open and close the necessary ports. When NAT is
         employed, the ALG needs to open up the VOIP packets and reconfigure the
         header information therein to correspond to the correct internal IP addresses on
         the private network, or on the public network for outgoing traffic. This includes
         modifying the headers and message bodies (e.g., SDP) in H.323 and SIP. ALG
         implementations are discussed for H.323 in [21] and SIP in [22]. The NAT
         problem is alleviated when the ALG replaces the private network addresses with
         the address of the ALG itself. It works by not only changing the IP address, but
         also mapping RTP traffic into ports the ALG can read from and forward to the
         correct internal machine. The need for consecutive ports for RTP and RTCP can
         cause a problem here [22] because all VOIP traffic on the network (and data
         traffic as well) is being routed through the ALG, so as call volume increases,
         finding enough consecutive ports may become an issue. So although both
         endpoints may have adequate ports to convene a conversation, the firewall’s
         deficiencies may cause the call to be rejected as “busy” by the ALG itself.

         There are significant performance and fiscal costs associated with the
         implementation of an ALG. Performance-wise, the manipulation of VOIP
         packets introduces latency into the system and can contribute to jitter when high
         call volumes are experienced. Depending on the firewall architecture, this can
         also slow down throughput in the firewall, contributing to general network
         congestion. A firewall with ALG support can be expensive, and would need to be
         upgraded or replaced each time the standards for VOIP change. Also, the
         addition of application intelligence to a firewall can introduce instabilities into the
         firewall itself. Some firewalls have been found vulnerable to an attack in which a
         high rate of call setups can be sent, depleting the connection tables of the firewall.
         These half-open VOIP sessions may not time out in the firewall for more than 24
         hours. Still with all these detractions, an ALG remains the simplest and safest
         workaround to allow the coexistence of VOIP, firewalls, and NAT.

 7.4.2    Middlebox Solutions

         One drawback to ALGs is that they are embedded in the firewall itself, and thus
         the latency and throughput slowdown of all traffic traversing the firewall is
         aggregated and then compounded by the VOIP call volume. Middlebox-style
         solutions attempt to alleviate this malady by placing an extra device outside the
         firewall that performs many of the functions associated with an ALG. The device


                                                                                              59
