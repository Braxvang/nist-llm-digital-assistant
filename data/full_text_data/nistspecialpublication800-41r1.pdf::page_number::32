                                                                                 GUIDELINES ON FIREWALLS AND FIREWALL POLICY


4.1.5      IPsec Protocols

An organization needs to have a policy whether or not to allow IPsec VPNs that start or end inside its
network perimeter. The ESP and AH protocols are used for IPsec VPNs, and a firewall that blocks these
protocols will not allow IPsec VPNs to pass. While blocking ESP can hinder the use of encryption to
protect sensitive data, it can also force users who would normally encrypt their data with ESP to allow it
to be inspected—for example, by a stateful inspection firewall or an application-proxy gateway.

Organizations that allow IPsec VPNs should block ESP and AH except to and from specific addresses on
the internal network—those addresses belong to IPsec gateways that are allowed to be VPN endpoints. 19
Enforcing this policy will require people inside the organization to obtain the appropriate policy approval
to open ESP and/or AH access to their IPsec routers. This will also reduce the amount of encrypted traffic
coming from inside the network that cannot be examined by network security controls.

4.2      Policies Based on Applications

Most early firewall work involved simply blocking unwanted or suspicious traffic at the network
boundary. Inbound application firewalls or application proxies take a different approach—they let traffic
destined for a particular server into the network, but capture that traffic in a server that processes it like a
port-based firewall. The application-based approach provides an additional layer of security for incoming
traffic by validating some of the traffic before it reaches the desired server. The theory is that the inbound
application firewall’s or proxy’s additional security layer can protect the server better than the server can
protect itself—and can also remove malicious traffic before it reaches the server to help reduce server
load. In some cases, an application firewall or proxy can remove traffic that the server might not be able
to remove on its own because it has greater filtering capabilities. An application firewall or proxy also
prevents the server from having direct access to the outside network.

If possible, inbound application firewalls and proxies should be used in front of any server that does not
have sufficient security features to protect it from application-specific attacks. The main considerations
when deciding whether or not to use an inbound application firewall or proxy are:

 Is a suitable application firewall available? Or, if appropriate, is a suitable application proxy
  available?
 Is the server already sufficiently protected by existing firewalls?
 Can the main server remove malicious content as effectively as the application firewall or proxy?
 Is the latency caused by an application proxy acceptable for the application?
 How easy it is to update the filtering rules on the main server and the application firewall or proxy to
  handle newly developed threats?
Application proxies can introduce problems if they are not highly capable. Unless an application proxy is
significantly more robust than the server and easy to keep updated, it is usually best to stay with the
application server alone. Application firewalls can also introduce problems if they are not fast enough to
handle the traffic destined for the server. However, it is also important to consider the server’s
resources—if the server does not have sufficient resources to withstand attacks, the application firewall or
proxy could be used as a shield.

19
      Wherever there is a policy to allow ESP and/or AH traffic through a firewall, it is extremely likely that the firewall also
      needs a policy to allow Internet Key Exchange (IKE) traffic as well. IKE runs on UDP port 500, and it can also use UDP
      port 4500 for IPsec systems that support NAT traversal.


                                                                4-5
