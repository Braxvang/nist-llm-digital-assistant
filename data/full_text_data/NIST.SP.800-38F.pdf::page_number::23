                                  NIST Special Publication 800-38F


6.3   KWP
Algorithm 5 specifies the authenticated-encryption function for KWP for a given block cipher
and KEK. The wrapping function, W, specified in Algorithm 1 above, is invoked in Step 5 with
the same block cipher and KEK as prerequisites.

Algorithm 5: KWP-AE(P)

Prerequisites:
KEK, K, for an approved, 128-bit block cipher;
designated cipher function, CIPHK;
definition of valid plaintext lengths.

Input:
plaintext P, with valid length.

Output:
ciphertext C.

Steps:
    1. Let ICV2 = 0xA65959A6.
    2. Let padlen = 8⋅len(P)/64-len(P)/8.
    3. Let PAD = 08padlen.
    4. Let S = ICV2 || [len(P)/8]32 || P || PAD.
    5. If len(P) ≤ 64, then return C = CIPHK(S); if len(P) > 64, then return C = W(S).

Algorithm 6 specifies the authenticated-decryption function for KWP for a given block cipher
and KEK. The unwrapping function, W-1, specified in Algorithm 2 above, is invoked in Step 4
with the same block cipher and KEK as prerequisites.

Algorithm 6: KWP-AD(C)

Prerequisites:
KEK, K, for an approved, 128-bit block cipher;
inverse of the designated cipher function, CIPH-1K;
definition of valid ciphertext lengths.

Input:
purported ciphertext, C, with valid length.

Output:
Plaintext P or indication of inauthenticity, FAIL.

Steps:
    1. Let n be the number of semiblocks in C.
    2. Let ICV2 = 0xA65959A6.




                                                 15
