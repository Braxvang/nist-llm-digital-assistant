                       Addendum to NIST Special Publication 800-38A


1.       Let n be the smallest integer such that n⋅b≥len(P), let d=len(P)-(n-1)⋅b, and let P1,
         P2, … , Pn-1, Pn* be the unique sequence of bit strings such that:
                a) P=P1||P2||…||Pn-1||Pn*; and
                b) P1, P2, … and Pn-1 are complete blocks.
         Consequently, len(Pn*)=d, and 1≤d≤b, so that Pn* is either a complete block or a
         nonempty partial block.

2.       Apply CBC-CS1-Encrypt to the plaintext P with initialization vector IV and key K
         to produce C1||C2||…||Cn-2||Cn-1*||Cn.

3.       If d=b, return C1||C2||…||Cn-2 ||Cn-1*||Cn; if d<b, return C1||C2||…||Cn-2||Cn||Cn-1*.

When Pn* is a complete block, then CBC-CS2-Encrypt, like CBC-CS1-Encrypt, is
equivalent to CBC encryption. When Pn* is a partial block, then CBC-CS2-Encrypt and
CBC-CS1-Encrypt differ only in the ordering of Cn-1* and Cn.

Algorithm: CBC-CS2-Decrypt

Input:           ciphertext C, such that len(C) is valid;
                 initialization vector IV;
                 key K.

Output:          plaintext P, such that len(P)=len(C).

Steps:

1.       Let n be the smallest integer such that n⋅b≥len(C), let d=len(C)-(n-1)⋅b, and let C1,
         C2, … , Cn-2, Cn-1, Cn* be the unique sequence of bit strings such that
                a) C=C1||C2||…||Cn-2 ||Cn-1||Cn*;
                b) Cn-1 is a complete block; and
                c) If n>2, then C1,…,Cn-2, are complete blocks.
         Consequently, len(Cn*)=d, and 1 ≤ d ≤ b, so that Cn* is either a complete block or
         a nonempty partial block.

2.       If d=b, i.e., Cn* is a complete block, then apply CBC-CS1-Decrypt to C with
         initialization vector IV and key K, and return the result, P. STOP.

3.       If d<b, i.e., Cn* is a partial block, then let C′= C1||C2||…||Cn-2 ||Cn*||Cn-1.

4.       Apply CBC-CS1-Decrypt to C′, and return the result, P.

Note that in Step 3, Cn* precedes Cn-1 in order to undo the corresponding swap within the
ciphertext in Step 3 of CBC-CS2-Encrypt.




                                                  5
