ESTABLISHING WIRELESS ROBUST SECURITY NETWORKS: A GUIDE TO IEEE 802.11I



                                                     Plaintext MPDU
   KeyID       PN                                                                                                  A2, Priority   TK
                         MAC Header                                        Data
                                                PN

                48-bit


                                              Increment PN


                                                                   PN
                                      KeyID                                    A2, Priority
      48-bit


                                           Construct                 Construct
                                         CCMP Header                  Nonce




                                                       Construct
                                                         AAD


                                                               AAD          Nonce             Data
                                                                                                                    TK
                                                                            CCM Encryption             AES
                                                                                                                    128-bit
                                                                                                  K=16, M=8, L=2

                         MAC Header       CCM Header                             Encrypted Data                       MIC

                                                             Ciphertext MPDU




                                 Figure 4-7. CCMP Encapsulation Block Diagram

CCM is an “authenticate-and-encrypt” block cipher mode of AES. As such, it both encrypts and produces
a MIC. As shown, the four inputs to the CCM processing are the following:

     128-bit cryptographic key, TK
     48-bit nonce (derived for a 48-bit packet number, PN)
     Additional Authentication Data (AAD)
     Variable length packet (frame body) with header.
CCM uses a new Temporal Key every session—with every new STA-AP association. Unlike TKIP, the
use of AES at the core of CCM obviates the need to have per-packet keys. As a result, the two-phase key
mixing functions of TKIP encapsulation are not present in the CCMP encapsulation. Figure 4-7 depicts
the CCMP encapsulation. This illustrates the various functions and their sequence in the encapsulation
process.

The figure depicts the plaintext frame prior to transmission at the top, and the plaintext header and
ciphertext output at the bottom, ready to send. The payload is transformed into encrypted data along with
the integral MIC. For IEEE 802.11 WLANs, the length of the MIC is set to 8 bytes, shown as M=8 in the
figure. The K=16 and L=2 denote the 16-byte AES key size and 2-byte maximum packet length field,
respectively. Also, CCMP uses the 48-bit packet number as an IV. The increment PN function ensures
that the packet number is new for every frame that is encrypted. The 48-bit packet number, which




                                                               4-12
