                                                              GUIDELINES FOR THE SECURE DEPLOYMENT OF IPV6




                                  Figure 4-5. Return Routability—Init Messages

Note that route optimization is optional for both parties. A MN always has a tradeoff between optimal
packet forwarding and location privacy, and a CN may ignore BUs (when it suspects an attack, for
example).

The CN can now compute and return Keygen Tokens for each path:

   Home Keygen Token = First(64, HMAC_SHA1(Kcn, (Home Address, HoA Nonce, 0)))

   Care-of Keygen Token = First(64, HMAC_SHA1(Kcn, (Care-of Address, CoA Nonce, 1)))
The CN sends these back and forgets them so as to avoid a denial-of-service attack. Later, when
addresses and nonce indices are returned, it can re-compute these and:

   Kbm = SHA1(Home Keygen Token, Care-of Keygen Token)
The CN does not allocate Binding Cache storage until authentication completes. Figure 4-6 illustrates the
Keygen replies.




                                                  4-22
