       NIST SP 800-73pt2-5 ipd (Initial Public Draft)                                      Interfaces for Personal Identity Verification: Part 2
       September 2023                                                                         PIV Card Application Card Command Interface

997    command and decrypted the data field in the command (if present). If the PIV Card Application
998    was unable to verify the C-MAC on the command or decrypt the data field in the command, then
999    it SHALL return a 2-byte error response, as described in Section 4.2.7.




1000
1001                                            Fig. 6. Single response under secure messaging

1002   Response chaining 22 will be needed if the secure messaging data field to be transported is larger
1003   than 256 bytes. Figure 7 shows the APDUs for secure messaging that are sent by the PIV Card
1004   Application when the length of the secure messaging data field is between 513 and 768 bytes,
1005   which requires the data to be fragmented across three APDUs. After the first response, an APDU
1006   of '00 C0 00 00 00' will be sent to request the second response. After the second response, an
1007   APDU of '00 C0 00 00 xx' will be sent to request the third response.




1008
1009                                           Fig. 7. Chained response under secure messaging


1010   4.2.7. Error Handling
1011   The SW processing status is the status word of the overall secure messaging command and
1012   response processing. It indicates whether the secure messaging was performed successfully. If
1013   the processing was successful, it SHALL be '90 00'. Otherwise, it SHALL be as follows:
1014           •    '68 82' – Secure messaging not supported
1015           •    '69 82' – Security status not satisfied 23
1016           •    '69 87' – Expected secure messaging data objects are missing
1017           •    '69 88' – Secure messaging data objects are incorrect

       22
            Response chaining is accomplished by issuing several GET RESPONSE commands to the card.
       23
            Status word '69 82' is used when secure messaging is requested but no session keys have been established.



                                                                                36
