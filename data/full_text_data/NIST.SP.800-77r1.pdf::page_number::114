                                                                                              NIST SP 800-77 REV. 1                                                          GUIDE TO IPSEC VPNS


                                                                                              pass through the IPsec tunnel should be excluded from NAT.

                                                                                              After designing the architecture, the network administrators next consider other elements of the
                                                                                              design, including the following:

                                                                                                 •    Authentication. Because the VPN is being established between only two routers, a
                                                                                                      strong PSK with at least 112 bits of entropy should provide adequate authentication with
                                                                                                      minimal effort (as compared to alternatives such as digital certificates). The routers will
                                                                                                      encrypt the PSK in storage to protect it.
                                                                                                 •    IKE and ESP Algorithms. Since 128-bit AES provides sufficiently strong encryption, it
This publication is available free of charge from: https://doi.org/10.6028/NIST.SP.800-77r1




                                                                                                      is initially chosen for ESP to prevent potentially overloading the gateways. The AES-
                                                                                                      GCM algorithm is a good choice for IKE and ESP because it is an AEAD algorithm that
                                                                                                      provides encryption and integrity in an efficient and more secure manner. It is preferred
                                                                                                      over the older combined algorithms with separate encryption and integrity algorithms,
                                                                                                      such as AES-CBC with HMAC-SHA256. The PRF used is HMAC-SHA256. The DH
                                                                                                      group chosen is DH 19, a modern and strong ECP group that provides 128 bits of security
                                                                                                      strength. PFS is enabled to ensure that a compromise of one of the routers will not cause
                                                                                                      all previously captured encrypted traffic to be vulnerable to decryption. A fallback
                                                                                                      proposal using AES-CBC with HMAC-SHA-2 is added to ensure maximum
                                                                                                      interoperability with other devices since not all devices support AES-GCM for IKE and
                                                                                                      ESP. The initiator must use a DH group that is also supported by the responder.
                                                                                                 •    Packet Filters. The network administrators work with the security staff to design packet
                                                                                                      filters that will permit only the necessary network traffic between the two networks and
                                                                                                      require adequate protection for the traffic. To make initial testing of the solution easier,
                                                                                                      the administrators decide that the packet filters should allow all IP-based communications
                                                                                                      from the remote office’s hosts to the main office’s hosts. Once initial testing has been
                                                                                                      completed, more restrictive packet filters will be added and tested. The packet filters
                                                                                                      should permit only the necessary communications and specify the appropriate protection
                                                                                                      for each type of communication.
                                                                                                 •    MTU and Fragmentation. The internet in general uses a maximum MTU size of 1500
                                                                                                      bytes. To avoid the possibility that any router on the internet might not support packets
                                                                                                      larger than 1500 bytes, both IPsec devices are set to use TCP MSS clamping at 1440
                                                                                                      bytes since path MTU discovery might not work properly across the internet either.

                                                                                              9.1.3   Implementing a Prototype

                                                                                              Because the organization has limited network equipment and no test lab, the IT staff decides that
                                                                                              the best option for validating the solution is to test it after hours using the production routers
                                                                                              once the remote office network infrastructure is in place and internet connectivity has been
                                                                                              established. If the testing causes a connectivity outage, the impact should be minimal. The
                                                                                              network administrators perform the following steps to configure and test a prototype of the IPsec
                                                                                              solution.

                                                                                              Note that on Cisco IOS and IOS-XE, there are two methods for implementing IPsec VPNs:
                                                                                              policy-based VPNs, which use crypto maps, and routing-based VPNs, which use tunnel


                                                                                                                                               97
