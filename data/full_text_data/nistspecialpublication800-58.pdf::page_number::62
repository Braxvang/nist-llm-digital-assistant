NIST SP 800-58                                             Voice Over IP Security
    _________________________________________________________________________

 7.3.2    Effects on QoS

         Both firewalls and NATs can degrade QoS in a VOIP system by introducing
         latency and jitter. NATs can also act as a bottleneck on the network because all
         traffic is routed through a single node. QoS related issues stemming from these
         network staples are presented here.

         VOIP is highly sensitive to latency. So a firewall needs to be able to broker data
         traffic, but cannot incur time penalties of any significant length, even those that
         would go unnoticed with simple data traffic [26]. At issue is not only how fast
         the firewall can interact with the network traffic, but how fast its processor can
         handle VOIP packets. Two aspects of VOIP can cause degraded behavior in the
         firewall CPU. First, the call setup process has to be done using H.323 or SIP (see
         chapters 4-5). Regardless of the protocol used, firewalls need to “dig deeper” into
         these packets to determine their validity. A flood of call request packets, as the
         result of an increase in call volume or a malicious attack, can intensify this effect.
         The presence of a NAT compounds this issue because the payload of the packet
         must then be changed at the application level to correspond to the NAT translated
         source or destination address and ports, requiring not only “digging” but filling in
         the hole with new dirt as well. All this labor puts a tremendous burden on the
         firewall processor, which must accomplish all these tasks while introducing the
         bare minimum in latency, especially if protocol security measures are used, such
         as message integrity.

         The other aspect of VOIP that can put a strain on a firewall CPU is the small but
         plentiful number of RTP packets that make up a VOIP conversation. Firewalls
         are rarely concerned with the size of a packet, but since each packet must be
         inspected, a large number of packets can stress the firewall. For example, a
         firewall may support 100 Mbit/sec (based on the assumption of large packets), but
         may be overloaded by a flood of small 50 byte packets long before the 100
         Mbit/sec rate is reached [LaCour qtd in 26]. QoS/VOIP aware firewalls are
         designed to avoid performance problems such as these.

         No matter how fast the network connection, the firewall CPU is a bottleneck for
         all unencrypted network packets. Thus a solution to this issue is to use a VPN for
         all VOIP traffic. Discussion of the pros and cons of this choice is presented in
         chapter 8.

 7.3.3    Firewalls and NATs

         Firewalls have difficulties sorting through VOIP signaling traffic. There are
         solutions to this but there is an additional, and even more vexing problem
         associated with firewalls and VOIP media. RTP traffic is dynamically assigned
         an even port number in the range of UDP ports (1024-65534). In addition, the
         RTCP port controlling this stream will flow through an associated, randomly-
         assigned port. Allowing such traffic along such a vast number of ports by default
         would leave the system highly exposed. So firewalls must be made aware


                                                                                             57
