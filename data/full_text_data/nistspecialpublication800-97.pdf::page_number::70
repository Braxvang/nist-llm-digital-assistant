ESTABLISHING WIRELESS ROBUST SECURITY NETWORKS: A GUIDE TO IEEE 802.11I



5.5     Key Generation and Distribution

Following the successful completion of the authentication phase, the STA and AP perform a series of
functions that position cryptographic keys in both entities. This phase is called the key generation and
distribution (KGD) phase. It provides the final step in authentication and allows the STA and AP to
derive keys that make secure data transfer possible. The KGD phase has several purposes, including the
following:

       Confirming the existence of the Pairwise Master Key (PMK)
       Ensuring the security association keys are new
       Deriving and synchronizing the installation of traffic encryption keys (temporal keys) in the AP
        and STA
       Distributing a group key for multicast and broadcast traffic protection
       Confirming the cipher suite selection.
The KGD phase includes two types of handshakes: a 4-Way Handshake and a Group Handshake. The
Group Handshake is necessary only when STAs participate in multicast or broadcast traffic. Both types
of handshakes employ the following fundamental security features:

       Message integrity checking, to protect against tampering and to validate the source of traffic
       Message encryption, to protect against unauthorized disclosure of data.
The confidentiality and integrity algorithms used for both handshakes are configurable to either of the
following:

       RC4 Encryption with HMAC-MD5. RC4 is the well-known stream cipher that forms the basis
        of WEP. RC4 uses the 128-bit EAPOL-KEK derived from the PTK using the PRF.
       AES Key Wrap 56 with HMAC-SHA-1-128. The AES Key Wrap was designed specifically to
        encrypt keying material (cryptographic keys). The key wrap parses data into n blocks of 64-bits
        and “wraps” (encrypts) the key contents. The key wrap uses the AES codebook mode along with
        the EAPOL-KEK derived from the PTK.
Both RC4 and the AES Key Wrap use the HMAC along with the EAPOL-KCK derived from the PTK
using the PRF to provide integrity during the 4-Way Handshake. As discussed in Section 2, Federal
agencies are required to use encryption algorithms that are FIPS-approved. RC4 encryption and MD5 are
not FIPS-approved, but AES and SHA-1 are, so NIST requires that Federal agencies use AES Key Wrap
with HMAC-SHA-1-128 instead of RC4 encryption with HMAC-MD5.

5.5.1     4-Way Handshake

The KGD phase begins with the 4-Way Handshake, which is depicted in Figure 5-14. During the
handshake, four frames are exchanged between the STA and the AP. To generate data for the frames and
verify data received in frames, both the STA and the AP perform several computations. At the successful
conclusion of the 4-Way Handshake, the AP and STA have been mutually authenticated. At that point,
the IEEE 802.1X controlled ports are opened to allow the flow of frames for data traffic.

56
      The AES Key Wrap is specified in RFC 3394, Advanced Encryption Standard (AES) Key Wrap Algorithm, available at
      http://www.ietf.org/rfc/rfc3394.txt.


                                                          5-18
