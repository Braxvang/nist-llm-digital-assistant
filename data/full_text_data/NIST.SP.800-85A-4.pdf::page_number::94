NIST SP 800-85A-4                                         PIV CARD APPLICATION & MIDDLEWARE
                                                                   INTERFACE TEST GUIDELINES

                       6. Call pivCrypt with
                          • (IN) cardHandle
                          • (IN) algorithmIdentifier
                          • (IN) keyReference
                          • (IN) algorithmInput
                          • (IN) inputLength
                          • (OUT) algorithmOutput
                          • (INOUT) outputLength
 Expected Result(s)    Call returns with status_word of PIV_INVALID_CARD_HANDLE.
 Postcondition(s)      The precondition states are unaffected.


B.9.2.2         Identify and Handle an Invalid keyReference or Algorithm
 Purpose                Ensure the PIV Middleware detects invalid key references or
                        algorithms.
 Target                pivCrypt
 Reference(s)          1. SP 800-73-4 Part 3, Section 3.3.1
                       2. AS04.08
 Precondition(s)       1. The client application owns a connection to the Card Application
                          accessible through cardHandle.
                       2. The client is logged into the PIV Card Application.
 Test Steps            1. Set cardHandle := <<a valid cardHandle>>
                       2. Either the keyReference or algorithmIdentifier, or both,
                          set to an invalid value.
                       3. Set algorithmInput := <<byte sequence compatible with a
                          type of authentication encoded according to the format in
                          the Dynamic Authentication Template – Table 7 of SP 800-
                          73-4 Part 2>>
                       4. Create algorithmOutput reference
                       5. Call pivCrypt with
                          • (IN) cardHandle
                          • (IN) algorithmIdentifier
                          • (IN) keyReference
                          • (IN) algorithmInput
                          • (IN) inputLength
                          • (OUT) algorithmOutput
                          • (INOUT) outputLength
 Expected Result(s)    Call returns with status_word of PIV_INVALID_KEYREF_OR_ALGORITHM.
 Postcondition(s)      The precondition states are unaffected.


B.9.2.3         Identify and Handle the keyReference Set to the PIV Secure Messaging Key
 Purpose                Ensure the PIV Middleware detects and handles a reference to the
                        PIV Secure Messaging key.
 Target                pivCrypt
 Reference(s)          1. SP 800-73-4 Part 3, Section 3.3.1
                       2. AS04.08, AS04.08A-R4


                                       B-28
