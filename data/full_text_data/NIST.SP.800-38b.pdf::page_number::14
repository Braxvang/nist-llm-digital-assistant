                                                                                             NIST SP 800-38B                                                                    BLOCK CIPHER MODES:
                                                                                                                                                                        CMAC MODE FOR AUTHENTICATION


                                                                                             Equivalent sets of steps, i.e., procedures that yield the correct output from the same input, are
                                                                                             permitted. For example, it is not necessary to complete the formatting of the entire message (Steps
                                                                                             3 and 4) prior to the cipher block chaining (Steps 5 and 6). Instead, the iterations of Step 5 may
                                                                                             be executed “on the fly,” i.e., on each successive block of the message as soon as it is available for
                                                                                             processing. Step 4 may be delayed until the final bit string in the partition is available; the
                                                                                             appropriate case, and value of j, if necessary, can be determined from the length of the final bit
                                                                                             string. In such an implementation, the determination in Step 2 of the total number of blocks in the
                                                                                             formatted message may be omitted, assuming that the implementation has another way to identify
                                                                                             the final string in the partition.

                                                                                             Similarly, the subkeys need not be computed anew for each invocation of CMAC with a given
                                                                                             key; instead, they may be precomputed and stored along with the key as algorithm inputs.
This publication is available free of charge from: https://doi.org/10.6028/NIST.SP.800-38B




                                                                                                    M1           M2      …      Mn*                  M1            M2       …    Mn*       10…0

                                                                                                                 ⊕              ⊕       K1                         ⊕               ⊕        K2


                                                                                                   CIPHK       CIPHK          CIPHK                CIPHK         CIPHK           CIPHK


                                                                                                                             MSBTlen                                             MSBTlen

                                                                                                                                 T                                                  T

                                                                                                                Figure 1: Illustration of the two cases of MAC Generation.

                                                                                             The two cases of MAC Generation are illustrated in Figure 1 above. On the left is the case
                                                                                             where the message length is a positive multiple of the block size; on the right is the case where
                                                                                             the message length is not a positive multiple of the block length.


                                                                                             6.3   MAC Verification

                                                                                             The following is a specification of the MAC verification process of CMAC:

                                                                                                    Prerequisites:
                                                                                                    block cipher CIPH with block size b;
                                                                                                    key K;
                                                                                                    subkeys K1, K2;
                                                                                                    MAC length Tlen.

                                                                                                    Input:
                                                                                                    message M of bit length Mlen;


                                                                                                                                               9
