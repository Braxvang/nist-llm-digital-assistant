                                                                                             NIST SP 800-38B                                                                                BLOCK CIPHER MODES:
                                                                                                                                                                                    CMAC MODE FOR AUTHENTICATION


                                                                                             Appendix B: Message Span of the Key

                                                                                             The message span of a key is the total number of messages for which MACs are generated across
                                                                                             all implementations of CMAC with that key. The message span of the key affects the security of
                                                                                             the system against attacks that are based on the detection of a pair of distinct messages with the
                                                                                             same MAC before its truncation 3. Such a pair is called a collision 4 in this appendix. As with other
                                                                                             block cipher-based MAC algorithms, an attacker may be able to exploit a collision to produce the
                                                                                             valid MAC for a new message, the content of which may be largely of the attacker's choosing.
                                                                                             Such an event would be a fundamental breach of the expected authentication assurance.

                                                                                             In principle, collisions must exist because there are many more possible messages than MACs; in
This publication is available free of charge from: https://doi.org/10.6028/NIST.SP.800-38B




                                                                                             practice, however, collisions may not occur among the messages for which MACs are actually
                                                                                             generated during the lifetime of the key. The probability that at least one collision will occur
                                                                                             depends mostly on the message span of the key relative to the block size, b, of the underlying block
                                                                                             cipher. For example, a collision is expected to exist among a set of 2b/2 arbitrary messages; in
                                                                                             other words, 264 messages for the AES algorithm, and 232 messages for TDEA. This property was
                                                                                             one of the motivations to develop the AES with a block size of 128 bits.

                                                                                             For any system in which CMAC is implemented, the risk that an attacker can detect and exploit a
                                                                                             collision shall be limited to a level that is appropriate to the value of the data. A simple and prudent
                                                                                             method to achieve this goal is to establish and enforce an appropriate limit on the message span of
                                                                                             any CMAC key, which in turn limits the probability that a collision will even occur. For general-
                                                                                             purpose applications, the default recommendation is to limit the key to no more than 248 messages
                                                                                             when the block size of the underlying block cipher is 128 bits, as with the AES algorithm, and 221
                                                                                             messages when the block size is 64 bits, as with TDEA. Within these limits, the probability that
                                                                                             a collision will occur is expected to be less than one in a billion for the AES algorithm, and less
                                                                                             than one in a million for TDEA.

                                                                                             For applications where higher confidence in the security is required, the message span of a key
                                                                                             may be measured in terms of the total number of message blocks. The recommendation in this
                                                                                             case is to limit the key to no more than 248 message blocks (222 Gbytes) when the block size is 128
                                                                                             bits, and 221 message blocks (16 Mbytes) when the block size is 64 bits. Within these limits, the
                                                                                             probability that a collision will occur is proved to be less than one in a billion for the AES
                                                                                             algorithm, and less than one in a million for TDEA, assuming that the underlying block cipher has
                                                                                             no weakness, as modeled in Ref. [6].

                                                                                             In some cases, a limit on the message span of a key may be established and enforced within a key
                                                                                             management infrastructure by an appropriate constraint on the time span during which the key
                                                                                             remains in effect, i.e., its cryptoperiod.




                                                                                             3
                                                                                              The MAC before truncation is denoted Cm in Sec. 6.2.
                                                                                             4
                                                                                              The standard definition of a collision, in Ref. [9], for example, is more general: for a given function, a collision is a
                                                                                             pair of distinct input values that yield the same output value.

                                                                                                                                                        13
