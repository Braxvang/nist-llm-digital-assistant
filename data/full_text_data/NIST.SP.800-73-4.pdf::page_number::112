Special Publication 800-73-4                                    Interfaces for Personal Identity Verification – Part 2:
                                                                PIV Card Application Card Command Interface

                                  Figure 6. Single Response under Secure Messaging


If the secure messaging data field to be transported is larger than 256 bytes, response chaining 22 will be
needed. Figure 7 shows the APDUs for secure messaging that are sent by the PIV Card Application for a
case in which the length of the secure messaging data field is between 513 and 768 bytes, requiring the
data to be fragmented across three APDUs. After the first response an APDU of '00 C0 00 00 00' would
be sent to request the second response, and after the second response an APDU of '00 C0 00 00 xx' would
be sent to request the third response.




                                 Figure 7. Chained Response under Secure Messaging


  4.2.7     Error Handling

The SW processing status is the status word of the overall secure messaging command and response
processing. It indicates if the secure messaging was performed successfully. If the processing was
successful, it shall be '90 00'; otherwise, it shall be as follows:

            +    '68 82' – Secure messaging not supported
            +    '69 82' – Security status not satisfied 23
            +    '69 87' – Expected secure messaging data objects are missing
            +    '69 88' – Secure messaging data objects are incorrect
If the command processing was unsuccessful, the card shall return one of the above status words without
performing further secure messaging.

4.3    Session Key Destruction

The session keys established after successful execution of the key establishment protocol in Section 4.1
shall be zeroized in the following circumstances:

            +    the card is reset;
            +    an error occurs in secure messaging; 24 or
22 The response chaining is accomplished by issuing several GET RESPONSE commands to the card.
23 Status word '69 82' is used when secure messaging is requested, but no session keys have been established.




                                                               37
