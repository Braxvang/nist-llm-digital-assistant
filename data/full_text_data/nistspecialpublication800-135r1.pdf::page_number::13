                                 NIST SP 800-135, Revision 1



4.1.2     IKE version 2 (IKEv2)
In IKEv2, an HMAC is used as a randomness extraction step to extract randomness
from a Diffie-Hellman shared secret (gir ) and to uniformly distribute the randomness
across the output (SKEYSEED). The function to produce SKEYSEED is:
      SKEYSEED = HMAC (Ni || Nr, gir).
Ni and Nr are nonces generated by the protocol initiator and responder, respectively;
see RFC 4306 for more details. This function acts as the randomness extraction step
of the E-E KDF. After the SKEYSEED is generated, a key expansion step is used to
derive keys for the security association (SA). SKEYSEED is the key derivation key
for the key expansion step. The string of concatenated non-secret attributes: Ni || Nr ||
SPIi || SPIr 3 is the fixed input message P field in SP 800-56C. Information about
these non-secret attributes can be found in RFC 4306. The specification of the key
expansion step can be found in Sections 2.13 and 2.14 of the RFC. Note that as
shown in Figure 1, the keying material generated by this key expansion step is the
output of the E-E procedure.
One of the seven secret keys derived from the SKEYSEED is called SK_d. It is used
as the key derivation key to derive new keys for child SA(s) using another KDF that
is functionally the same as the key expansion step, but with a different set of
attributes.
One of the attributes is an optional new Diffie-Hellman shared secret established
during the creation of the child SA. Details of this function can be found in Sections
2.17 and 2.18 of RFC 4306.
The IKEv2 KDFs, which are compliant with SP 800-56C, are approved when used
with an approved HMAC function using an approved hash function; see FIPSs 198-
1 and 180-3, respectively. These KDFs are included here for completeness.

4.2      Key Derivation in Transport Layer Security (TLS)
In TLS, after a cipher suite negotiation is completed, a Diffie-Hellman (DH) key
agreement or RSA key transport scheme is used to generate a pre-master secret.
When RSA key transport is used, the pre-master secret is a random value generated
by the client. When the DH key agreement scheme is used, the pre-master secret is
the shared secret generated by the key agreement scheme.

4.2.1     Key Derivation in TLS versions 1.0 and 1.1
In TLS versions 1.0 and 1.1 (TLS 1.0 and 1.1), the pre-master secret is input into an
HMAC-MD5/HMAC-SHA-1 PRF 4 with some non-secret values to produce a master
secret; the PRF acts as the randomness extraction step in an E-E KDF. The master

3
 Ni and Nr are nonces created by the initiator and responder, respectively. SPIi and SPIr are security
parameter indexes (SPIs) of the initiator and responder respectively.
4
  The HMAC-MD5/HMAC-SHA-1 PRF uses HMAC-MD5 and HMAC-SHA-1 as the core functions
in its construction, as specified in RFC 2246, Section 5.


                                                  10
