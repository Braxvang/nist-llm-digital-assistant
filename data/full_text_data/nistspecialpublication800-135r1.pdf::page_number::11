                                 NIST SP 800-135, Revision 1



their KDFs to generate keying material for their security associations (SAs). IKEv1 1
and IKEv2 specify multiple PRFs, including those based on HMAC and block
ciphers. Only an approved hash function and HMAC function shall be used.

4.1.1      IKE version 1 (IKEv1)
In IKEv1, a string called SKEYID is derived from secret material known only to the
communicating parties. An HMAC-PRF is used to produce the SKEYID. The secret
material that is input to the HMAC function is either a Diffie-Hellman shared secret
gxy, secret nonces generated by both of the communicating parties, or a pre-shared
key. In the protocol, the method used to generate SKEYID depends on the
authentication method. One of the following three different functions is used as a
randomness extraction step to produce the SKEYID:
     1) When digital signatures are used for authentication, the function is:
         SKEYID = HMAC (Ni_b || Nr_b, gxy), where Ni_b and Nr_b are non-secret
         values.
     2) When a public key algorithm encryption is used for authentication, the function
        is:
         SKEYID = HMAC (HASH (Ni_b || Nr_b), CKY-I || CKY-R), where Ni_b
         and Nr_b are secret nonces, and CKY-I and CKY-R are non-secret values.
     3) When a pre-shared key is used for authentication, the function is:
          SKEYID = HMAC (pre-shared-key, Ni_b || Nr_b), where Ni_b and Nr_b are
          non-secret values.
Additional technical details for the variables in the functions are provided in RFC
2409.
The appropriate PRF (i.e., the HMAC functions 1-3 above) is executed only once to
generate the SKEYID.
After the randomness extraction step above, the SKEYID is fed into a feedback
function that performs the key expansion step and produces the necessary keying
material. The resulting keying material is defined by the following equations:
     SKEYID_d = HMAC (SKEYID, gxy || CKY-I || CKY-R || 0)
     (SKEYID_d is used as the key derivation key to generate fresh keying material for
     new, negotiated security associations.)
     SKEYID_a = HMAC (SKEYID, SKEYID_d || gxy || CKY-I || CKY-R || 1)
     (SKEYID_a is used as an HMAC key to authenticate the current security
     associationâ€™s messages.)
     SKEYID_e = HMAC (SKEYID, SKEYID_a || gxy || CKY-I || CKY-R || 2)


1
    Note that IKEv1 is considered obsolete by the IETF and not recommended for new protocols.

                                                  8
