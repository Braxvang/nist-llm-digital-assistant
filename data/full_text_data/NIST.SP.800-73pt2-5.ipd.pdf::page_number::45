      NIST SP 800-73pt2-5 ipd (Initial Public Draft)                 Interfaces for Personal Identity Verification: Part 2
      September 2023                                                    PIV Card Application Card Command Interface

980       3. The status word, SW1, and SW2 encapsulated in BER-TLV format with tag '99'
981   Let T R-MAC = CMAC(SK RMAC , M R-MAC ), as described in [SP800-38B]. The BER-TLV-encoded
982   R-MAC for the response SHALL be the 8 most significant bytes of T R-MAC encapsulated in BER-
983   TLV format with tag '8E'. The entire 16-byte value T R-MAC will be the MCV for the next
984   response.
985   Figure 5 illustrates how the R-MAC is generated for the response.




986
987                                        Fig. 5. PIV data integrity of response


988   4.2.6. Response With PIV Secure Messaging
989   For secure messaging, the secure messaging data field that is sent by the PIV Card Application
990   SHALL be constructed as the concatenation of the following:
991       •   The BER-TLV-encoded encrypted message (when present);
992       •   The 4-byte BER-TLV-encoded status word, as described in Section 4.2.5; and
993       •   The 10-byte BER-TLV-encoded R-MAC of the response, as described in Section 4.2.5.
994   Figure 6 illustrates a response under secure messaging when response chaining is not required.
995   The APDU consists of the secure messaging data field and the 2-byte SW processing status ('90
996   00'), which indicates that the PIV Card Application successfully verified the C-MAC on the


                                                            35
