                                NIST Special Publication 800-38D


       Algorithm 4: GCM-AEK (IV, P, A)

       Prerequisites:
       approved block cipher CIPH with a 128-bit block size;
       key K;
       definitions of supported input-output lengths;
       supported tag length t associated with the key.

       Input:
       initialization vector IV (whose length is supported);
       plaintext P (whose length is supported);
       additional authenticated data A (whose length is supported).

       Output:
       ciphertext C;
       authentication tag T.

       Steps:
       1. Let H = CIPHK(0128).
       2. Define a block, J0, as follows:
           If len(IV)=96, then let J0 = IV || 031 ||1.
           If len(IV) ≠ 96, then let s = 128 ⎡len(IV)/128⎤-len(IV), and let
                J0=GHASHH(IV||0s+64||[len(IV)]64).
       3. Let C=GCTRK(inc32(J0), P).
       4. Let u = 128 ⋅ ⎡len(C ) 128⎤ − len(C ) and let v = 128 ⋅ ⎡len( A) 128⎤ − len( A) .
       5. Define a block, S, as follows:
                       S = GHASHH (A || 0v || C || 0u || [len(A)]64 || [len(C)]64).
       6. Let T = MSBt (GCTR K ( J 0 , S )) .
       7. Return (C, T).

In Step 1, the hash subkey for the GHASH function is generated by applying the block cipher to
the “zero” block. In Step 2, the pre-counter block (J0) is generated from the IV. In particular,
when the length of the IV is 96 bits, then the padding string 031||1 is appended to the IV to form
the pre-counter block. Otherwise, the IV is padded with the minimum number of ‘0’ bits,
possibly none, so that the length of the resulting string is a multiple of 128 bits (the block size);
this string in turn is appended with 64 additional ‘0’ bits, followed by the 64-bit representation of
the length of the IV, and the GHASH function is applied to the resulting string to form the pre-
counter block. In Step 3, the 32-bit incrementing function is applied to the pre-counter block to
produce the initial counter block for an invocation of the GCTR function on the plaintext. The
output of this invocation of the GCTR function is the ciphertext.

In Steps 4 and 5, the AAD and the ciphertext are each appended with the minimum number of
‘0’ bits, possibly none, so that the bit lengths of the resulting strings are multiples of the block
size. The concatenation of these strings is appended with the 64-bit representations of the
lengths of the AAD and the ciphertext, and the GHASH function is applied to the result to
produce a single output block. In Step 6, this output block is encrypted using the GCTR function



                                                  15
