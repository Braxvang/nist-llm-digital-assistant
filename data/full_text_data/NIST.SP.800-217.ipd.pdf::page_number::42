       NIST SP 800-217 ipd                          Guidelines for PIV Federation (Initial Public Draft)
       January 2023


1115   A.4. PKI-Based Federation Gateway
1116   A service provider that does not issue any PIV identity account of its own sets up a
1117   SAML IdP that accepts PKI-based PIV credentials as its only authentication method.
1118   These accounts are provisioned at the IdP using the attributes in the certificates when the
1119   subscriber first presents the certificate. The IdP collects no additional attributes from the
1120   subscriber in the process.
1121   The IdP generates federated identifiers for the accounts by computing a hash of the
1122   authentication certificate and encoding that hash in Base64. This process fulfills the
1123   requirements of this document for federated identifiers, but it is specific to this IdP and
1124   need not be known or understood by any RP connecting through the IdP. Note that if
1125   the subscriber changes any attributes in the certificate, such as their name, then a new
1126   federated identifier will be created as a result. As a result, this IdP does not necessarily
1127   provide a stable subject identifier across authenticator updates.
1128   The RP enters into a pairwise trust agreement with the IdP to accept assertions for any
1129   agency with PIV credentials. The RP does not have any other IdPs that it speaks to
1130   directly, and so the only way to log in to the RP is through this gateway. Since the IdP
1131   accepts a broad range of PKI-based credentials, this allows the RP access to any account
1132   based on those credentials.
1133   This setup does not allow the PIV identity accounts to use non-PKI-based derived
1134   PIV credentials since the IdP portion of the gateway is not the home IdP for any of the
1135   accounts in question. The RP is also not able to receive any attributes other than those
1136   available directly to the IdP through subscriber certificates. To ensure account continuity,
1137   an RP would need to have an out-of-band process to bind their new federated identifier to
1138   the existing RP subscriber account if the certificate and attributes change over time.
1139   The IdP is not acting as a federation proxy because the inbound credential is not a
1140   federated assertion but rather a PKI-based credential that the gateway processes directly
1141   as a verifier.

1142   A.5. PIV Federation Proxy as a Federation Authority
1143   A federation proxy is set up within a multilateral federation. The proxy is run by the
1144   federation authority. All IdPs under the multilateral agreement register the proxy as an
1145   RP. The RPs within the federation authority connect to the proxy as their only IdP. All
1146   federation transactions within the multilateral federation flow through the proxy.
1147   The federation authority discloses the nature of the proxy to all parties, so the IdPs know
1148   that this particular RP is a proxy, and the RPs know that their IdP is a proxy. Furthermore,
1149   the proxy lists all of the upstream IdPs and their associated populations of PIV identity
1150   accounts to all RPs connecting through the proxy.
1151   The proxy discloses to the RPs which upstream IdPs participated in the authentication of
1152   the PIV identity account to the proxy, allowing the downstream RPs to validate that the

                                                    32
