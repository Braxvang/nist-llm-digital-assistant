NIST SP 800-85A-4                                                             PIV CARD APPLICATION & MIDDLEWARE
                                                                                       INTERFACE TEST GUIDELINES

                               3. If the PIV Card Application supports on-card generation
                                  of the key management key send GENERATE ASYMMETRIC KEY
                                  PAIR card command with
                                  • P2 is set to value '9D'
                                  • Data field in the command is to include either '07',
                                     '11', '14' as the cryptographic mechanism identifier
                               4. If the PIV Card Application supports on-card generation
                                  of the asymmetric Card Authentication key send GENERATE
                                  ASYMMETRIC KEY PAIR card command with
                                  • P2 is set to value '9E'
                                  • Data field in the command is to include either '07' or
                                     '11' as the cryptographic mechanism identifier
                               5. If the card supports secure messaging send GENERATE
                                  ASYMMETRIC KEY PAIR card command with
                                  • P2 is set to value '04'
                                  • Data field in the command is to include either '11' or
                                     '14' as the cryptographic mechanism identifier
                               NOTE: The following tests are to be performed only if the
                               PIV Card Application supports the use of the key '9B'.
                               6. Perform mutual authentication of PIV Card Application
                                   and the Test Toolkit Application using steps 5a and 5b
                                   of C.2.4.1 (GENERAL AUTHENTICATE)
                               7. Repeat steps 1-5
                               8. Send VERIFY card command with
                                  • P2, key reference value is set to '80'
                                  • Data field of the command will contain the correct PIV
                                     Card Application PIN value, padded with 'FF' to
                                     complete the total length of the value to 8 bytes
                               9. Send GENERAL AUTHENTICATE card command with
                                  • CLA is set to:
                                      • '00' if command chaining is not needed or
                                      • '10' if command chaining is used. (The last chain
                                         of the command sets CLA to '00')
                                  • P1, algorithm reference, is set to '07' or '11'
                                  • P2, key reference, is set to '9A' indicating the PIV
                                     Authentication key
                                  • Data field in the command is to include '81'
                                     specifying a challenge, followed by a randomly
                                     generated challenge, and '82 00' in order to request a
                                     response
                               10. Repeat step 8 to verify cardholder’s PIV Card
                                   Application PIN and repeat step 9 with P2 set to '9C',
                                   P1 (algorithm reference) set to '07', '11', or '14' and
                                   template '81' in the data field containing a hashed
                                   message
                               11. Repeat step 9 with P2 set to '9D', P1 (algorithm
                                   reference) set to '07', '11', or '14' and include
                                   template '81' containing a key encrypted using the key
                                   management public key returned in step 7 (in case of P1
                                   ='07') or template '85' containing the other party’s
                                   public key 17 (in case of P1 = '11' or '14')


17 Template '85' contains the other party’s public key, a point on Curve P-256 or P-384, encoded as '04' || X || Y,

without the use of point compression, as described in Section 2.3.3 of [SEC1].



                                                    C-45
