                        NIST Special Publication
                        NIST SP 800-73pt2-5 ipd

                      Interfaces for
      Personal Identity Verification
Part 2 – PIV Card Application Card Command Interface

                                                Initial Public Draft

                                               Hildegard Ferraiolo
                                                      Ketan Mehta
                                           Salvatore Francomacaro
                                         Ramaswamy Chandramouli
                                                     Sarbari Gupta

                        This publication is available free of charge from:
                        https://doi.org/10.6028/NIST.SP.800-73pt2-5.ipd
                                           NIST Special Publication
                                           NIST SP 800-73pt2-5 ipd

                      Interfaces for
      Personal Identity Verification
Part 2 – PIV Card Application Card Command Interface

                                                                         Initial Public Draft

                                                                      Hildegard Ferraiolo
                                                                             Ketan Mehta
                                                                  Salvatore Francomacaro
                                                                Ramaswamy Chandramouli
                                                                  Computer Security Division
                                                           Information Technology Laboratory

                                                                                     Sarbari Gupta
                                                                          Electrosoft Services, Inc.

                                          This publication is available free of charge from:
                                          https://doi.org/10.6028/NIST.SP.800-73pt2-5.ipd

                                                                                     September 2023




                                                                            U.S. Department of Commerce
                                                                             Gina M. Raimondo, Secretary

                                                            National Institute of Standards and Technology
         Laurie E. Locascio, NIST Director and Under Secretary of Commerce for Standards and Technology
     NIST SP 800-73pt2-5 ipd (Initial Public Draft)                    Interfaces for Personal Identity Verification: Part 2
     September 2023                                                       PIV Card Application Card Command Interface

 1   Certain commercial equipment, instruments, software, or materials, commercial or non-commercial, are identified in
 2   this paper in order to specify the experimental procedure adequately. Such identification does not imply
 3   recommendation or endorsement of any product or service by NIST, nor does it imply that the materials or
 4   equipment identified are necessarily the best available for the purpose.

 5   There may be references in this publication to other publications currently under development by NIST in
 6   accordance with its assigned statutory responsibilities. The information in this publication, including concepts and
 7   methodologies, may be used by federal agencies even before the completion of such companion publications. Thus,
 8   until each publication is completed, current requirements, guidelines, and procedures, where they exist, remain
 9   operative. For planning and transition purposes, federal agencies may wish to closely follow the development of
10   these new publications by NIST.

11   Organizations are encouraged to review all draft publications during public comment periods and provide feedback
12   to NIST. Many NIST cybersecurity publications, other than the ones noted above, are available at
13   https://csrc.nist.gov/publications.


14   Authority
15   This publication has been developed by NIST in accordance with its statutory responsibilities under the Federal
16   Information Security Modernization Act (FISMA) of 2014, 44 U.S.C. § 3551 et seq., Public Law (P.L.) 113-283.
17   NIST is responsible for developing information security standards and guidelines, including minimum requirements
18   for federal information systems, but such standards and guidelines shall not apply to national security systems
19   without the express approval of appropriate federal officials exercising policy authority over such systems. This
20   guideline is consistent with the requirements of the Office of Management and Budget (OMB) Circular A-130.
21
22   Nothing in this publication should be taken to contradict the standards and guidelines made mandatory and binding
23   on federal agencies by the Secretary of Commerce under statutory authority. Nor should these guidelines be
24   interpreted as altering or superseding the existing authorities of the Secretary of Commerce, Director of the OMB, or
25   any other federal official. This publication may be used by nongovernmental organizations on a voluntary basis and
26   is not subject to copyright in the United States. Attribution would, however, be appreciated by NIST.


27   NIST Technical Series Policies
28   Copyright, Use, and Licensing Statements
29   NIST Technical Series Publication Identifier Syntax


30   Publication History
31   Approved by the NIST Editorial Review Board on YYYY-MM-DD [Will be added on final publishing]
32   Supersedes NIST Series XXX (Month Year) DOI [Will be added on final publishing]


33   How to Cite this NIST Technical Series Publication:
34   Ferraiolo H, Mehta K, Francomacaro S, Chandramouli R, Gupta S (2023) Interfaces for Personal Identity
35   Verification: Part 2 – PIV Card Application Card Command Interface. (National Institute of Standards and
36   Technology, Gaithersburg, MD), NIST Special Publication (SP) NIST SP 800-73pt2-5 ipd.
37   https://doi.org/10.6028/NIST.SP.800-73pt2-5.ipd


38   Author ORCID iDs
39   Hildegard Ferraiolo: 0000-0002-7719-5999
40   Ketan Mehta: 0009-0001-1191-8656
41   Salvatore Francomacaro: 0009-0009-0487-2520
42   Ramaswamy Chandramouli: 0000-0002-7387-5858
43   Sarbari Gupta: 0000-0003-1101-0856
     NIST SP 800-73pt2-5 ipd (Initial Public Draft)               Interfaces for Personal Identity Verification: Part 2
     September 2023                                                  PIV Card Application Card Command Interface

44   Public Comment Period
45   September 27, 2023 – November 15, 2023


46   Submit Comments
47   piv_comments@nist.gov
48
49   National Institute of Standards and Technology
50   Attn: Computer Security Division, Information Technology Laboratory
51   100 Bureau Drive (Mail Stop 8930) Gaithersburg, MD 20899-8930


52   All comments are subject to release under the Freedom of Information Act (FOIA).
53
     NIST SP 800-73pt2-5 ipd (Initial Public Draft)         Interfaces for Personal Identity Verification: Part 2
     September 2023                                            PIV Card Application Card Command Interface



54   Abstract
55   FIPS 201 defines the requirements and characteristics of government-wide interoperable identity
56   credentials. It specifies that these identity credentials must be stored on a smart card and that
57   additional common identity credentials, known as derived PIV credentials, may be issued by a
58   federal department or agency and used when a PIV Card is not practical. This document contains
59   the technical specifications to interface with the smart card to retrieve and use the PIV identity
60   credentials. The specifications reflect the design goals of interoperability and PIV Card
61   functions. The goals are addressed by specifying a PIV data model, card edge interface, and
62   application programming interface. Moreover, this document enumerates requirements for the
63   options and branches in international integrated circuit card standards. The specifications go
64   further by constraining interpretations of the normative standards to ease implementation,
65   facilitate interoperability, and ensure performance in a manner tailored for PIV applications.

66   Keywords
67   authentication; FIPS 201; identity credential; logical access control; on-card biometric
68   comparison; Personal Identity Verification (PIV); physical access control; smart cards; secure
69   messaging.

70   Reports on Computer Systems Technology
71   The Information Technology Laboratory (ITL) at the National Institute of Standards and
72   Technology (NIST) promotes the U.S. economy and public welfare by providing technical
73   leadership for the Nation’s measurement and standards infrastructure. ITL develops tests, test
74   methods, reference data, proof of concept implementations, and technical analyses to advance
75   the development and productive use of information technology. ITL’s responsibilities include the
76   development of management, administrative, technical, and physical standards and guidelines for
77   the cost-effective security and privacy of other than national security-related information in
78   Federal information systems. The Special Publication 800-series reports on ITL’s research,
79   guidelines, and outreach efforts in information system security, and its collaborative activities
80   with industry, government, and academic organizations.

81   Trademark Information
82   All registered trademarks or trademarks belong to their respective organizations.
83




                                                      i
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)           Interfaces for Personal Identity Verification: Part 2
      September 2023                                              PIV Card Application Card Command Interface

 84   Call for Patent Claims
 85   This public review includes a call for information on essential patent claims (claims whose use
 86   would be required for compliance with the guidance or requirements in this Information
 87   Technology Laboratory (ITL) draft publication). Such guidance and/or requirements may be
 88   directly stated in this ITL Publication or by reference to another publication. This call also
 89   includes disclosure, where known, of the existence of pending U.S. or foreign patent applications
 90   relating to this ITL draft publication and of any relevant unexpired U.S. or foreign patents.
 91   ITL may require from the patent holder, or a party authorized to make assurances on its behalf,
 92   in written or electronic form, either:
 93       a) assurance in the form of a general disclaimer to the effect that such party does not hold
 94          and does not currently intend holding any essential patent claim(s); or
 95       b) assurance that a license to such essential patent claim(s) will be made available to
 96          applicants desiring to utilize the license for the purpose of complying with the guidance
 97          or requirements in this ITL draft publication either:
 98              i.    under reasonable terms and conditions that are demonstrably free of any unfair
 99                    discrimination; or
100             ii.    without compensation and under reasonable terms and conditions that are
101                    demonstrably free of any unfair discrimination.
102   Such assurance shall indicate that the patent holder (or third party authorized to make assurances
103   on its behalf) will include in any documents transferring ownership of patents subject to the
104   assurance, provisions sufficient to ensure that the commitments in the assurance are binding on
105   the transferee, and that the transferee will similarly include appropriate provisions in the event of
106   future transfers with the goal of binding each successor-in-interest.
107   The assurance shall also indicate that it is intended to be binding on successors-in-interest
108   regardless of whether such provisions are included in the relevant transfer documents.
109   Such statements should be addressed to: piv_comments@nist.gov
110




                                                        ii
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)                                   Interfaces for Personal Identity Verification: Part 2
      September 2023                                                                      PIV Card Application Card Command Interface

111   Table of Contents
112        Introduction ......................................................................................................................... 1
113               Purpose ......................................................................................................................... 1
114               Scope ............................................................................................................................ 1
115               Audience and Assumptions ........................................................................................... 2
116               Content and Organization ............................................................................................. 2
117        Overview: Concepts and Constructs ................................................................................ 3
118               Platform Requirements.................................................................................................. 3
119               Namespaces of the PIV Card Application ..................................................................... 3
120               Card Applications .......................................................................................................... 4
121     2.3.1.      Default Selected Card Application .............................................................................. 4
122               Security Architecture ..................................................................................................... 4
123     2.4.1.      Access Control Rule ................................................................................................... 4
124     2.4.2.      Security Status ............................................................................................................ 5
125     2.4.3.      Authentication of an Individual .................................................................................... 5
126               Current State of the PIV Card Application ..................................................................... 6
127        PIV Card Application Card Command Interface ............................................................... 7
128               PIV Card Application Card Commands for Data Access............................................... 8
129     3.1.1.      SELECT Card Command ............................................................................................ 8
130     3.1.2.      GET DATA Card Command ...................................................................................... 10
131               PIV Card Application Card Commands for Authentication .......................................... 11
132     3.2.1.      VERIFY Card Command ........................................................................................... 11
133     3.2.2.      CHANGE REFERENCE DATA Card Command ...................................................... 14
134     3.2.3.      RESET RETRY COUNTER Card Command ............................................................ 15
135     3.2.4.      GENERAL AUTHENTICATE Card Command .......................................................... 17
136               PIV Card Application Card Commands for Credential Initialization and Administration ..
137               .................................................................................................................................... 18
138     3.3.1.      PUT DATA Card Command ...................................................................................... 18
139     3.3.2.      GENERATE ASYMMETRIC KEY PAIR Card Command ......................................... 19
140        Secure Messaging ............................................................................................................. 21
141               Key Establishment Protocol ........................................................................................ 21
142     4.1.1.      Client Application Steps ............................................................................................ 22
143     4.1.2.      PIV Card Application Protocol Steps ........................................................................ 23
144     4.1.3.      Notations ................................................................................................................... 24
145     4.1.4.      Cipher Suite .............................................................................................................. 25
146     4.1.5.      Card Verifiable Certificates ....................................................................................... 25

                                                                            iii
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)                                  Interfaces for Personal Identity Verification: Part 2
      September 2023                                                                     PIV Card Application Card Command Interface

147      4.1.6.       Key Derivation ........................................................................................................... 28
148      4.1.7.       Key Confirmation ...................................................................................................... 28
149      4.1.8.       Command Interface .................................................................................................. 28
150                 Secure Messaging....................................................................................................... 29
151      4.2.1.       Secure Messaging Data Objects .............................................................................. 30
152      4.2.2.       Command and Response Data Confidentiality ......................................................... 30
153      4.2.3.       Command Integrity .................................................................................................... 32
154      4.2.4.       Command With PIV Secure Messaging .................................................................... 33
155      4.2.5.       Response Integrity .................................................................................................... 34
156      4.2.6.       Response With PIV Secure Messaging .................................................................... 35
157      4.2.7.       Error Handling ........................................................................................................... 36
158                 Session Key Destruction ............................................................................................. 37
159   References ................................................................................................................................. 38
160   Appendix A.              Examples of the Use of the GENERAL AUTHENTICATE Command ........ 40
161   Appendix B.              List of Symbols, Abbreviations, and Acronyms ......................................... 52
162   Appendix C.              Glossary ......................................................................................................... 55
163   Appendix D.              Notation .......................................................................................................... 56
164

165   List of Tables
166   Table 1. State of the PIV Card Application ................................................................................... 6
167   Table 2. PIV Card Application card commands ............................................................................ 7
168   Table 3. Data objects in the PIV Card Application property template (Tag '61') ........................... 9
169   Table 4. Data objects in a coexistent tag allocation authority template (Tag '79') ........................ 9
170   Table 5. Data objects in a cryptographic algorithm identifier template (Tag 'AC') ........................ 9
171   Table 6. Data objects in the data field of the GET DATA card command................................... 10
172   Table 7. Data objects in the dynamic authentication template (Tag '7C') ................................... 18
173   Table 8. Data field of the PUT DATA card command for the Discovery Object ......................... 19
174   Table 9. Data field of the PUT DATA card command for the BIT Group template ..................... 19
175   Table 10. Data field of the PUT DATA card command for all other PIV data objects ................. 19
176   Table 11. Data objects in the template (Tag 'AC') ...................................................................... 20
177   Table 12. Data objects in the template (Tag '7F49') ................................................................... 20
178   Table 13. Public-key encoding for ECC ...................................................................................... 20
179   Table 14: Key Establishment Protocol for PIV Card Application ................................................ 21
180   Table 15: Protocol Steps for Client Application .......................................................................... 22
181   Table 16: Protocol Steps for PIV Card Application ..................................................................... 23
182   Table 17: Notations used in Protocol Description ....................................................................... 24
183   Table 18. Cipher suite for PIV secure messaging ...................................................................... 25
184   Table 19. Secure messaging card verifiable certificate format ................................................... 26
185   Table 20. Intermediate card verifiable certificate format ............................................................. 27
186   Table 21. Secure messaging data objects ................................................................................. 30
187   Table 22. Authentication of PIV Card Application Administrator ................................................ 40

                                                                            iv
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)                              Interfaces for Personal Identity Verification: Part 2
      September 2023                                                                 PIV Card Application Card Command Interface

188   Table 23. Mutual authentication of client application and PIV Card Application ......................... 41
189   Table 24. Validation of the PIV Card Application using GENERAL AUTHENTICATE ............... 42
190   Table 25: PIV Cardholder Authentication over Virtual Contact Interface.................................... 48
191   Table 26: PIV Cardholer Authentication using Secure Messaging Key ...................................... 51


192   List of Figures
193   Fig. 1. PIV Data Confidentiality ................................................................................................... 31
194   Fig. 2. PIV Data Integrity of Command ....................................................................................... 33
195   Fig. 3. Single Command under Secure Messaging .................................................................... 34
196   Fig. 4. Chained Command under Secure Messaging ................................................................. 34
197   Fig. 5. PIV Data Integrity of Response ....................................................................................... 35
198   Fig. 6. Single Response under Secure Messaging .................................................................... 36
199   Fig. 7. Chained Response under Secure Messaging ................................................................. 36
200
201




                                                                        v
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)        Interfaces for Personal Identity Verification: Part 2
      September 2023                                           PIV Card Application Card Command Interface

202   Acknowledgments
203   The authors — Hildegard Ferraiolo, Ketan Mehta, Salvatore Francomacaro, and Ramaswamy
204   Chandramouli of NIST and Sarbari Gupta of Electrosoft Services, Inc. — gratefully
205   acknowledge the contributions of David Cooper, James Dray, William MacGregor, Scott
206   Guthery, Teresa Schwarzhoff, and Jason Mohler, who co-authored prior versions of this three-
207   part publication. The authors also gratefully acknowledge and appreciate the many contributions
208   from the public and private sectors whose thoughtful and constructive comments improved the
209   quality and usefulness of this publication.




                                                       vi
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)           Interfaces for Personal Identity Verification: Part 2
      September 2023                                              PIV Card Application Card Command Interface



210       Introduction
211   Homeland Security Presidential Directive-12 (HSPD-12) called for the adoption of a common
212   identification standard to govern the interoperable use of identity credentials to allow physical
213   and logical access to federally controlled facilities and information systems. In response, Federal
214   Information Processing Standard (FIPS) 201 [FIPS201], Personal Identity Verification (PIV) of
215   Federal Employees and Contractors, was developed to define reliable, government-wide identity
216   credentials for use in applications such as access to federally controlled facilities and information
217   systems. FIPS 201 supports multiple types of authenticators, including authenticators on smart
218   cards (also known as PIV cards) and derived PIV credential authenticators in various other form
219   factors. This publication contains technical specifications to interface with PIV Cards to retrieve
220   and use identity credentials. Other specifications, such as NIST Special Publication (SP) 800-
221   157r1 (Revision 1), contain procedures and life cycle activities to issue, maintain, and use
222   derived PIV credentials.

223           Purpose
224   FIPS 201 defines processes for binding identities to authenticators, such as the PIV Card and
225   derived PIV credentials used in the federal PIV system. SP 800-73-5 contains the technical
226   specifications to interface with the PIV Card to retrieve and use the identity credentials. The
227   specifications reflect the design goals of interoperability and PIV Card functions. The goals are
228   addressed by specifying a PIV data model, card edge interface, and application programming
229   interface. Moreover, SP 800-73-5 enumerates requirements for the options and branches in
230   international integrated circuit card (ICC) standards [ISO7816]. The specifications go further by
231   constraining interpretations of the normative standards to ease implementation, facilitate
232   interoperability, and ensure performance in a manner tailored for PIV applications.

233           Scope
234   SP 800-73-5 specifies the PIV data model, application programming interface (API), and card
235   interface requirements necessary to comply with the use cases, as defined in Section 6 of FIPS
236   201 and further described in Appendix B of SP 800-73-5 Part 1. Interoperability is defined as the
237   use of PIV identity credentials such that client-application programs, compliant card
238   applications, and compliant ICCs CAN be used interchangeably by all information processing
239   systems across federal agencies. SP 800-73-5 defines the PIV data elements’ identifiers,
240   structure, and format, as well as the client API and card command interface for use with the PIV
241   Card.
242   This document — SP 800-73-5, Interfaces for Personal Identity Verification: Part 2 – PIV Card
243   Application Card Command Interface — contains the technical specifications for the PIV Card
244   command interface to the PIV Card. The specifications define the set of commands surfaced by
245   the PIV Card Application at the card edge of the ICC.




                                                        1
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)          Interfaces for Personal Identity Verification: Part 2
      September 2023                                             PIV Card Application Card Command Interface

246           Audience and Assumptions
247   This document is intended for federal agencies and implementers of PIV systems. Readers are
248   assumed to have a working knowledge of smart card standards and applications.
249   Readers should also be aware of the following important content in SP 800-73-5 Part 1:
250       •   The front matter describes configuration management recommendations.
251                o Section 1.3 specifies the effective date of SP 800-73-5.
252       •   The front matter also specifies NPIVP conformance testing procedures.
253       •   Appendix G provides the full Revision History of SP 800-73.

254           Content and Organization
255   All sections in this document are normative (i.e., mandatory for compliance) unless specified as
256   informative (i.e., non-mandatory) and are structured as follows:
257       •   Section 1, Introduction, provides the purpose, scope, audience, and assumptions of the
258           document and outlines its structure.
259       •   Section 2, Overview: Concepts and Constructs, describes the model of computation of
260           the PIV Card Application and the PIV client application programming interface,
261           including information processing concepts and data representation constructs.
262       •   Section 3, PIV Card Application Card Command Interface, describes the set of
263           commands accessible by the PIV Middleware to communicate with the PIV Card
264           Application.
265       •   Section 4, Secure Messaging, describes the secure messaging protocol that is used to
266           enable data confidentiality and integrity.
267       •   Appendix A demonstrates the GENERAL AUHTENTICATE command. This section is
268           informative.
269       •   Appendix B contains the list of acronyms used in this document. This section is
270           informative.
271       •   Appendix C contains a Glossary of terms used in this document. This section is
272           informative.
273       •   Appendix D explains the notation in use in this document. This section is informative.




                                                       2
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)            Interfaces for Personal Identity Verification: Part 2
      September 2023                                               PIV Card Application Card Command Interface


274       Overview: Concepts and Constructs
275   SP 800-73-5 Parts 2 and 3 define two interfaces to an ICC that contain the PIV Card Application:
276   a low-level card command interface (Part 2) and a high-level client API (Part 3). SP 800-73-5
277   Part 3 is optional, and NIST Personal Identity Verification Program (NPIVP) conformance
278   testing for PIV Middleware in accordance with SP 800-73 Part 3 is discontinued since endpoints
279   support high level-client API natively at the time of this publication.
280   The information processing concepts and data constructs on both interfaces are identical and
281   MAY be referred to generically as the information processing concepts and data constructs on
282   the PIV interfaces without specific reference to the client API or the card command interface.
283   The client API provides task-specific programmatic access to these concepts and constructs, and
284   the card command interface provides communication access. The client API is used by client
285   applications using the PIV Card Application. The card command interface is used by software
286   that implement the client API (middleware).
287   The client API is thought of as being at a higher level than the card command interface because
288   access to a single entry point on the client API may cause multiple card commands to traverse
289   the card command interface. In other words, it may require more than one card command on the
290   card command interface to accomplish the task represented by a single call on an entry point of
291   the client API.
292   The client API is a program execution, call/return style interface, whereas the card command
293   interface is a communication protocol, command/response style interface. Because of this
294   difference, the representation of the PIV concepts and constructs as bits and bytes on the client
295   API may be different from the representation of these same concepts and constructs on the card
296   command interface.

297           Platform Requirements
298   The PIV Card Application places the following requirements on the ICC platform on which it is
299   implemented or installed:
300       •   Global security status that includes the security status of a global cardholder PIN
301       •   Application selection using a truncated Application Identifier (AID)
302       •   Ability to reset the security status of an individual application
303       •   Indication to applications as to which physical communication interface — contact versus
304           contactless — is in use
305       •   Support for the default selection of an application upon warm or cold reset

306           Namespaces of the PIV Card Application
307   Part 1 specifies the AID, names, Tag-Length-Value (BER-TLV) tags [ISO8825], ASN.1 Object
308   Identifiers (OIDs) [ISO8824], and Proprietary Identifier eXtensions (PIXes) of the NIST
309   Registered Application Provider IDentifier (RID) used on the PIV interfaces. Part 1 also states



                                                        3
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)                                   Interfaces for Personal Identity Verification: Part 2
      September 2023                                                                      PIV Card Application Card Command Interface

310   that all unspecified names, BER-TLV tags, OIDs, and values of algorithm identifiers, key
311   references, and cryptographic mechanism identifiers are reserved for future use.

312              Card Applications
313   Each command that appears on the card command interface SHALL be implemented by a card
314   application that is resident on the ICC. The card command enables operations on and with the
315   data objects to which the card application has access.
316   Each card application SHALL have a globally unique name called its Application Identifier
317   (AID) [ISO7816, Part 4]. Except for the default applications, access to the card commands and
318   data objects of a card application SHALL be gained by selecting the card application using its
319   application identifier. 1 The PIX of the AID SHALL contain an encoding of the version of the
320   card application. The AID of the PIV Card Application is defined in Part 1.
321   The card application whose commands are currently being used is called the currently selected
322   application.

323   2.3.1. Default Selected Card Application
324   The card platform SHALL support a default selected card application. In other words, there
325   SHALL be a currently selected application immediately after a cold or warm reset. This card
326   application is the default selected card application. The default card application MAY be the PIV
327   Card Application, or it MAY be another card application.

328              Security Architecture
329   The security architecture of an ICC is the means by which the security policies governing access
330   to each data object stored on the card are represented within the card. These security policy
331   representations are applied to all PIV card commands, thereby ensuring that the prescribed data
332   policies for the card applications are enforced.
333   The following subsections describe the security architecture of the PIV Card Application.

334   2.4.1. Access Control Rule
335   An access control rule SHALL consist of an access mode and a security condition. The access
336   mode is an operation that CAN be performed on a data object. A security condition is a Boolean
337   expression using variables called security statuses (see Section 2.4.2).
338   According to an access control rule, the action described by the access mode CAN be performed
339   on the data object if and only if the security condition evaluates to TRUE for the current values
340   of the security statuses. If there is no access control rule with an access mode that describes a
341   particular action, then that action SHALL never be performed on the data object.


      1
        Access to the default application, its commands, and its objects occurs immediately after a warm or cold card reset without an explicit SELECT
      command.




                                                                             4
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)           Interfaces for Personal Identity Verification: Part 2
      September 2023                                              PIV Card Application Card Command Interface

342   2.4.2. Security Status
343   A set of one or more Boolean variables — each called a security status indicator of the
344   authenticable entity — SHALL be associated with each authenticable entity. Each security status
345   indicator is, in turn, associated with a credential that CAN be used to authenticate the entity. The
346   security status indicator of an authenticable entity SHALL be TRUE if the credentials associated
347   with the security status indicator of the authenticable entity have been authenticated and FALSE
348   otherwise.
349   A successful execution of an authentication protocol SHALL set the security status indicator
350   associated with the credential used in the protocol to TRUE. An aborted or failed execution of an
351   authentication protocol SHALL set the security status indicator associated with the credential
352   used in the protocol to FALSE.
353   As an example, the credentials associated with three security status indicators of the cardholder
354   might be a PIN, fingerprint, and pairing code. Demonstrating knowledge of the PIN is the
355   authentication protocol for the first security status indicator wherein the PIN is the credential.
356   Comparing the fingerprint template on the card with a fingerprint acquired from the cardholder is
357   the authentication protocol for the second security status indicator wherein the fingerprint is the
358   credential. Demonstrating knowledge of the pairing code is the authentication protocol for the
359   third security status indicator wherein the pairing code is the credential. A security condition
360   using these three security status indicators might be “pairing code AND (PIN OR fingerprint).”
361   A security status indicator SHALL be said to be a global security status indicator if it is not
362   changed when the currently selected application changes from one application to another. In
363   essence, when changing from one application to another, the global security status indicators
364   SHALL remain unchanged.
365   A security status indicator is said to be an application security status indicator if it is set to
366   FALSE when the currently selected application changes from one application to another. Every
367   security status indicator is either a global security status indicator or an application security
368   status indicator. The security status indicators associated with the PIV Card Application PIN, the
369   PIN Unblocking Key (PUK), OCC, pairing code, and the PIV Card Application Administration
370   Key are application security status indicators for the PIV Card Application, whereas the security
371   status indicator associated with the Global PIN is a global security status indicator.
372   The term global security status refers to the set of all global security status indicators. The term
373   application security status refers to the set of all application security status indicators for a
374   specific application.

375   2.4.3. Authentication of an Individual
376   Knowledge of a PIN is the means by which an individual CAN be authenticated to the PIV Card
377   Application.
378   The pairing code SHALL be exactly 8 bytes in length, and the PIV Card Application PIN
379   SHALL be between 6 and 8 bytes in length. If the actual length of the PIV Card Application PIN
380   is less than 8 bytes, it SHALL be padded to 8 bytes with 'FF' when presented to the card
381   command interface. The 'FF' padding bytes SHALL be appended to the actual value of the PIN.



                                                        5
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)                    Interfaces for Personal Identity Verification: Part 2
      September 2023                                                       PIV Card Application Card Command Interface

382   The bytes that comprise the PIV Card Application PIN and pairing code SHALL be limited to
383   values 0x30 – 0x39, the ASCII values for the decimal digits '0' – '9'. For example:
384       •   Actual PIV Card Application PIN: “123456” or '31 32 33 34 35 36'
385       •   Padded PIV Card Application PIN presented to the card command interface: '31 32 33 34
386           35 36 FF FF'
387   The PIV Card Application SHALL enforce the minimum length requirement of 6 bytes for the
388   PIV Card Application PIN (i.e., SHALL verify that at least the first 6 bytes of the value
389   presented to the card command interface are in the range 0x30 – 0x39) and the other formatting
390   requirements specified in this section.
391   If the Global PIN is used by the PIV Card Application, then the above encoding, length, padding,
392   and enforcement of minimum PIN length requirements for the PIV Card Application PIN
393   SHALL apply to the Global PIN.
394   The PUK SHALL be 8 bytes in length and MAY be any 8-byte binary value. That is, the bytes
395   that comprise the PUK MAY have any value in the range 0x00 – 0xFF.

396           Current State of the PIV Card Application
397   The elements of the current state of the PIV Card Application when the PIV Card Application is
398   the currently selected application are described in Table 1.
399                                     Table 1. State of the PIV Card Application

                      State         Always                                                      Location of
                                                               Comment
                      Name          Defined                                                       State
                  Global                       Contains security status indicators that
                                      Yes                                                      PIV Platform
                  security status              span all card applications on the platform
                                               The platform SHALL support the
                                               selection of a card application using the
                  Currently
                                               full application identifier or by providing
                  selected            Yes                                                      PIV Platform
                                               the right-truncated version, and there
                  application
                                               SHALL always be a currently selected
                                               application.
                  Application                  Contains security status indicators local to      PIV Card
                                      Yes
                  security status              the PIV Card Application                         Application
400




                                                               6
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)                            Interfaces for Personal Identity Verification: Part 2
      September 2023                                                               PIV Card Application Card Command Interface



401          PIV Card Application Card Command Interface
402   Table 2 lists the card commands surfaced by the PIV Card Application at the card edge of the
403   ICC when it is the currently selected card application. All PIV Card Application card commands
404   SHALL be supported by a PIV Card Application. Card commands indicated by a “Yes” in the
405   Command Chaining column SHALL support command chaining for transmitting a data string
406   that is too long for a single command, as defined in [ISO7816].
407                                         Table 2. PIV Card Application card commands

                                                             Contact        Contactless        Security Condition        Command
               Type                      Name
                                                            Interface        Interface              for Use              Chaining
         PIV Card               SELECT                          Yes              Yes                  Always                No
      Application Card
       Commands for                                                                            Data Dependent. See           No
                                GET DATA                        Yes              Yes
        Data Access                                                                              Table 2, Part 1.


                                                                             SM or VCI                                       Yes 2
                                VERIFY                          Yes                                   Always
                                                                            (see Note 1)
         PIV Card               CHANGE                                                                                       Yes 3
                                                                Yes             VCI                PIN or OCC
      Application Card          REFERENCE DATA
       Commands for             RESET RETRY                                                                                  No
                                                                Yes              No           PIN Unblocking Key
       Authentication           COUNTER
                                GENERAL                                         Yes            Key Dependent. See            Yes
                                                                Yes
                                AUTHENTICATE                                (See Note 2)         Table 5, Part 1.


          PIV Card                                                                            PIV Card Application           Yes
                                PUT DATA                        Yes              No
      Application Card                                                                           Administrator
       Commands for                                                                                                          Yes
                                GENERATE
          Credential                                                                          PIV Card Application
                                ASYMMETRIC                      Yes              No
      Initialization and                                                                         Administrator
                                KEY PAIR
       Administration

408   The PIV Card Application shall return the status word of '6A 81' (Function not supported) when
409   it receives a card command on the contactless interface marked “No” in the Contactless Interface
410   column in Table 2. The PIV Card Application may return a different status word (e.g., '69 82') if
411   the card command can be performed over the contactless interface in support of card
412   management. The PIV Card Application will only perform the command in support of card
413   management if the requirements specified in Section 2.9.2 of FIPS 201-2 are satisfied.
414   Note 1: For SM, OCC and pairing code alone CAN be submitted via secure messaging (SM)
415   over the contactless interface. All other key references require VCI for communication over the
416   contactless interface.
417               Note 2: Cryptographic protocols using private/secret keys that require the “PIN” or
418               “OCC” security condition SHALL only be used on the contactless interface after a virtual


      2
          The VERIFY command is only required to support command chaining if the PIV Card Application supports OCC.
      3
          The CHANGE REFERENCE DATA command is only required to support command chaining if the PIV Card Application supports OCC.



                                                                       7
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)                                    Interfaces for Personal Identity Verification: Part 2
      September 2023                                                                       PIV Card Application Card Command Interface

419                contact interface (VCI) has been established. The VCI 4 is established when the following
420                security condition is met:
421                          (command is submitted over secure messaging) AND (the Discovery Object is
422                          present) AND (Bit 4 of the first byte of the PIN Usage Policy is one) AND ((the
423                          security status indicator associated with the pairing code is TRUE) OR (Bit 3 of the
424                          first byte of the PIN Usage Policy is one))

425                PIV Card Application Card Commands for Data Access

426   3.1.1. SELECT Card Command
427   The SELECT card command sets the currently selected application. The PIV Card Application
428   SHALL be selected by providing its application identifier (see Part 1, Section 2.2) in the data
429   field of the SELECT command.
430   There SHALL be at most one PIV Card Application on any ICC. The PIV Card Application
431   CAN also be made the currently selected application by providing the right-truncated version
432   (see Part 1, Section 2.2) — that is, without the 2-byte version number in the data field of the
433   SELECT command.
434   The complete AID, including the 2-byte version, of the PIV Card Application that became the
435   currently selected card application upon successful execution of the SELECT command (using
436   the full or right-truncated PIV AID) SHALL be returned in the application property template.
437   If the currently selected application is the PIV Card Application when the SELECT command is
438   given and the AID in the data field of the SELECT command is either the AID of the PIV Card
439   Application or the right-truncated version thereof, then the PIV Card Application SHALL
440   continue to be the currently selected card application, and the setting of all security status
441   indicators in the PIV Card Application SHALL be unchanged.
442   If the currently selected application is the PIV Card Application when the SELECT command is
443   given and the AID in the data field of the SELECT command is not the PIV Card Application (or
444   the right-truncated version thereof) but a valid AID supported by the ICC, then the PIV Card
445   Application SHALL be deselected, and all the PIV Card Application security status indicators in
446   the PIV Card Application SHALL be set to FALSE.
447   If the currently selected application is the PIV Card Application when the SELECT command is
448   given and the AID in the data field of the SELECT command is an invalid AID not supported by
449   the ICC, then the PIV Card Application SHALL remain the currently selected application, and
450   all PIV Card Application security status indicators SHALL remain unchanged.
451   Command Syntax
                       CLA                        '00'
                       INS                        'A4'
                       P1                         '04'
                       P2                         '00'
                       Lc                         Length of application identifier


      4
          The VCI is explained in further details in SP 800-73-5 Part 1, Section 5.5.



                                                                                 8
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)                              Interfaces for Personal Identity Verification: Part 2
      September 2023                                                                 PIV Card Application Card Command Interface

                                          AID of the PIV Card Application using the full AID or the right-
                 Data Field
                                          truncated AID (See Section 2.2, Part 1)
                 Le                       '00'
452
453   Response Syntax
                   Data Field              Application property template (APT). See Table 3 below
                   SW1-SW2                 Status word

454   Upon selection, the PIV Card Application SHALL return the application property template
455   described in Table 3.
456                   Table 3. Data objects in the PIV Card Application property template (Tag '61')

                        Description                     Tag        M/O/C                            Comment
                                                                                The PIX of the AID includes the encoding of the
          Application identifier of application       '4F'         M            version of the PIV Card Application. See Section
                                                                                2.2, Part 1.
                                                                                Coexistent tag allocation authority template. See
          Coexistent tag allocation authority         '79'         M
                                                                                Table 4.
                                                                                Text describing the application (e.g., for use on a
          Application label                           '50'         O
                                                                                human-machine interface)
                                                                                Reference to the specification describing the
          Uniform resource locator                    '5F50'       O
                                                                                application
                                                                                Cryptographic algorithm identifier template. See
          Cryptographic algorithms supported          'AC'         C
                                                                                Table 5.

457                   Table 4. Data objects in a coexistent tag allocation authority template (Tag '79')

                      Name                      Tag       M/O                               Comment
              Application identifier     '4F'            M             See Section 2.2, Part 1

458   A PIV Card Application MAY use a subset of the cryptographic algorithms defined in SP 800-
459   78. Tag 0xAC encodes the cryptographic algorithms supported by the PIV Card Application. The
460   encoding of tag 0xAC SHALL be as specified in Table 5. Each instance of tag 0x80 SHALL
461   encapsulate one algorithm. The presence of algorithm identifier '27' or '2E' indicates that the
462   corresponding cipher suite is supported by the PIV Card Application for secure messaging and
463   that the PIV Card Application possesses a PIV Secure Messaging key of the appropriate size for
464   the specified cipher suite. Tag 0xAC SHALL be present and indicate algorithm identifier 0x27 or
465   0x2E (but not both) when the PIV Card Application supports secure messaging.
466                   Table 5. Data objects in a cryptographic algorithm identifier template (Tag 'AC')

                      Name                      Tag          M/O                           Comment
              Cryptographic                                            For values, see [SP800-78, Table 9]
                                         '80'            M
              algorithm identifier
              Object identifier          '06'            M             Its value is set to 0x00
467

                     SW1         SW2                                            Meaning
                   '6A'        '82'        Application not found
                   '90'        '00'        Successful execution
468




                                                                         9
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)                          Interfaces for Personal Identity Verification: Part 2
      September 2023                                                             PIV Card Application Card Command Interface

469   3.1.2. GET DATA Card Command
470   The GET DATA card command retrieves the data content of the single data object whose tag is
471   given in the data field. 5
472   Command Syntax
                    CLA                      '00' or '0C' for secure messaging
                    INS                      'CB'
                    P1                       '3F'
                    P2                       'FF'
                    Lc                       Length of data field
                    Data Field               See Table 6
                    Le                       '00'

473   The L c value is '05' for all PIV data objects except for the 0x7E interindustry tag (Discovery
474   Object), which has an L c value of '03', and the 0x7F61 interindustry tag (Biometric Information
475   Templates (BIT) Group Template), which has an L c value of '04'.
476                          Table 6. Data objects in the data field of the GET DATA card command

                   Name         Tag     M/O                            Comment
                  Tag list     '5C'     M   BER-TLV tag of the data object to be retrieved. See Table 3, Part 1.

477   Response Syntax
478   For the 0x7E Discovery Object (if present) and the 0x7F61 BIT Group Template (if present):
                                             - BER-TLV of the 0x7E Discovery data object (see Section 3.3.2,
                                             Part 1 for a description of the Discovery Object’s structure returned
                    Data Field               in the data field) or
                                             - BER-TLV of the 0x7F61 BIT Group Template (see Table 7 of SP
                                             800-76)
                    SW1-SW2                  Status word

479   For all other PIV data objects (if present):
                                             BER-TLV with the tag '53' containing in the value field of the
                    Data Field
                                             requested data object.
                    SW1-SW2                  Status word
480
                     SW1          SW2                                      Meaning
                                             Successful execution where SW2 encodes the number of response
                    '61'         'xx'
                                             data bytes still available
                    '69'         '82'        Security status not satisfied
                    '6A'         '82'        Data object not found
                    '90'         '00'        Successful execution
481




      5
         The GET RESPONSE command is used in conjunction with GET DATA to read larger PIV data objects. The GET RESPONSE command is
      illustrated in Appendix A.4.1 (Command 3).



                                                                    10
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)          Interfaces for Personal Identity Verification: Part 2
      September 2023                                             PIV Card Application Card Command Interface

482           PIV Card Application Card Commands for Authentication

483   3.2.1. VERIFY Card Command
484   The VERIFY card command initiates the comparison in the card of the reference data indicated
485   by the key reference with authentication data in the data field of the command.
486   Key reference '80' specific to the PIV Card Application (i.e., local key references) and,
487   optionally, the Global PIN with key reference '00', the OCC data (key references '96' and '97'),
488   and pairing code (key reference '98') are the only key references that MAY be verified by the
489   PIV Card Application’s VERIFY command. The PIV Card Application MAY allow other key
490   references to be verified by the PIV Card Application’s VERIFY command if they are used for
491   card management operations.
492   Key reference '80' SHALL be able to be verified by the PIV Card Application VERIFY
493   command. If the PIV Card Application does not contain the Discovery Object as described in
494   Part 1, then no other key reference SHALL be able to be verified by the PIV Card Application
495   VERIFY command. If the PIV Card Application contains the Discovery Object, then the ability
496   of the PIV Card Application’s VERIFY command to verify key references '00', '96', '97', and '98'
497   SHALL be as specified by the first byte of the Discovery Object’s PIN Usage Policy value:
498       •   If Bit 6 is one, then key reference '00' SHALL be able to be verified by the PIV Card
499           Application VERIFY command.
500       •   If Bit 5 is one, then key references '96' and/or '97', as specified in the Biometric
501           Information Templates Group Template, SHALL be able to be verified by the PIV Card
502           Application VERIFY command.
503       •   If Bit 4 is one, then key reference '98' SHALL be able to be verified by the PIV Card
504           Application VERIFY command.
505   If any key reference value is specified that CANNOT be verified by the PIV Card Application,
506   then the PIV Card Application SHALL return the status word '6A 88'.
507   The VERIFY command MAY be submitted over the contact interface and, under some
508   conditions, over the contactless interface. The card command SHALL fail if:
509       •   The key reference is '00' or '80', and the command is not submitted over either the contact
510           interface or the VCI, or
511       •   The key reference is '96', '97', or '98', and the command is submitted over the contactless
512           interface without secure messaging.
513   The P1 parameter SHALL be either '00' or 'FF'. If any other value is specified for the P1
514   parameter, then the PIV Card Application SHALL return the status word '6A 86'.
515   If the VERIFY command fails for one of the reasons specified above, then the security status and
516   the retry counter of the key reference SHALL remain unchanged.
517   If P1='00' and L c and the command data field are absent, the command CAN be used to retrieve
518   the number of further retries allowed ('63 CX') or to check whether verification is not needed ('90
519   00').



                                                       11
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)                                       Interfaces for Personal Identity Verification: Part 2
      September 2023                                                                          PIV Card Application Card Command Interface

520   If P1='00' and L c and the command data field are present, then the authentication data in the
521   command data field SHALL be compared against the reference data associated with the key
522   reference, as specified in the following subsections. However, if the key reference is '00', '80',
523   '96', or '97' and the current value of the retry counter associated with the key reference is zero,
524   then the PIV Card Application SHALL return the status word '69 83'. 6 In order to protect against
525   blocking over the contactless interface, PIV Card Applications that implement secure messaging
526   SHALL define an issuer-specified intermediate retry value for each of these key references and
527   return '69 83' if the command is submitted over the contactless interface (over secure messaging
528   or the VCI, as required for the key reference) and the current value of the retry counter
529   associated with the key reference is at or below the issuer-specified intermediate retry value. If
530   status word '69 83' is returned, then the comparison SHALL NOT be made, and the security
531   status and the retry counter of the key reference SHALL remain unchanged.
532   If P1='FF', and L c and the command data field are absent, the command SHALL reset the
533   security status of the key reference in P2. The security status of the key reference specified in P2
534   SHALL be set to FALSE, and the retry counter associated with the key reference SHALL remain
535   unchanged.

536   3.2.1.1.                 PIV Card Application PIN and Global PIN
537   If the key reference is '00' or '80' and the authentication data in the command data field does not
538   satisfy the criteria in Section 2.4.3, then the card command SHALL fail, and the PIV Card
539   Application SHALL return either the status word '6A 80' or '63 CX'. If status word '6A 80' is
540   returned, the security status and the retry counter of the key reference SHALL remain
541   unchanged. 7 If status word '63 CX' is returned, the security status of the key reference SHALL
542   be set to FALSE, and the retry counter associated with the key reference SHALL be decremented
543   by one.
544   If the authentication data in the command data field is properly formatted (see previous
545   paragraph) and does not match reference data associated with the key reference, then the card
546   command SHALL fail, the PIV Card Application SHALL return the status word '63 CX', the
547   security status of the key reference SHALL be set to FALSE, and the retry counter associated
548   with the key reference SHALL be decremented by one.
549   If the card command succeeds, then the security status of the key reference SHALL be set to
550   TRUE, and the retry counter associated with the key reference SHALL be set to the reset retry
551   value associated with the key reference. The initial value of the retry counter and the reset retry
552   value associated with the key reference (i.e., the number of successive failures/retries before the
553   retry counter associated with the key reference reaches zero) is 10 or less for both key references
554   in accordance with FIPS 201 Section 2.9.3.

555   3.2.1.2.                 On-Card Biometric Comparison
556   If the key reference is '96' or '97' and the authentication data in the command data field is not of
557   length 3N, where N satisfies the requirements for the minimum and maximum number of
558   minutiae specified in the BIT, then the card command SHALL fail, and the PIV Card
      6
          There is no retry counter associated with the pairing code, so the authentication method cannot be blocked for that key reference.
      7
          It is recommended that in this case the authentication data not be compared to the on-card reference data.



                                                                                12
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)                                    Interfaces for Personal Identity Verification: Part 2
      September 2023                                                                       PIV Card Application Card Command Interface

559   Application SHALL return the status word '6A 80'. The security status and the retry counter of
560   the key reference SHALL remain unchanged.
561   If the authentication data in the command data field is properly formatted (see previous
562   paragraph) and does not match the reference data associated with the key reference, then the card
563   command SHALL fail, the PIV Card Application SHALL return the status word '63 CX', the
564   security status of the key reference SHALL be set to FALSE, and the retry counter associated
565   with the key reference SHALL be decremented by one.
566   If the card command succeeds, then the security status of the key reference SHALL be set to
567   TRUE, and the retry counter associated with the key reference SHALL be set to the reset retry
568   value associated with the key reference. The initial value of the retry counter and the reset retry
569   value associated with the key reference (i.e., the number of successive failures/retries before the
570   retry counter associated with the key reference reaches zero) are 10 or less in accordance with
571   FIPS 201 Section 2.9.3.

572   3.2.1.3.              Pairing Code
573   If the key reference is '98' and the authentication data in the command data field does not match
574   the reference data associated with the key reference, the command SHALL fail, and the PIV
575   Card Application SHALL return the status word '63 00'. If the authentication data in the
576   command data field does not satisfy the criteria in Section 2.4.3, then the PIV Card Application
577   MAY return the status word '6A 80' instead of '63 00'. If status word '6A 80' is returned, the
578   security status of the key reference SHALL remain unchanged. If status word '63 00' is returned,
579   the security status of the key reference SHALL be set to FALSE.
580   If the card command succeeds, then the security status of the key reference SHALL be set to
581   TRUE.
582   Command Syntax
                                             '00' or '10' indicating command chaining
                  CLA
                                             '0C' or '1C' for secure messaging
                  INS                        '20'
                  P1                         '00' or 'FF'
                  P2                         Key reference. See Part 1, Table 4.
                                             Absent 8 – for absent command data field
                  Lc                         '08' – for PIV Card Application PIN, Global PIN, or pairing code
                                             3N – for OCC data (where N is the number of minutiae)
                                             Absent,7 PIV Card Application PIN, Global PIN, pairing code
                  Data Field                 authentication data as described in Section 2.4.3, or OCC data as
                                             described in Section 5.5.2 of [SP800-76]
                  Le                         Absent

583   Response Syntax
                    SW1           SW2                                       Meaning
                  '63'          '00'         Verification failed
                  '63'          'CX'         Verification failed, X indicates the number of further allowed retries

      8
        If P1='00' and Lc and the command data field are absent, the command can be used to retrieve the number of further retries allowed ('63 CX') or
      to check whether verification is not needed ('90 00').




                                                                             13
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)                 Interfaces for Personal Identity Verification: Part 2
      September 2023                                                    PIV Card Application Card Command Interface

                  SW1       SW2                                    Meaning
                '69'      '82'       Security status not satisfied
                '69'      '83'       Authentication method blocked
                '6A'      '80'       Incorrect parameter in command data field
                '6A'      '81'       Function not supported
                '6A'      '86'       Incorrect parameter in P1
                '6A'      '88'       Key reference not found
                '90'      '00'       Successful execution


584   3.2.2. CHANGE REFERENCE DATA Card Command
585   The CHANGE REFERENCE DATA card command initiates the comparison of the
586   authentication data in the command data field with the current value of the reference data and
587   replaces the reference data with new reference data if the comparison is successful. This
588   command CAN be used by the PIV Card Application Administrator and the Cardholder.
589   Only reference data associated with key references '80', '81' specific to the PIV Card Application
590   (i.e., local key reference), and the Global PIN with key reference '00' MAY be changed by the
591   PIV Card Application CHANGE REFERENCE DATA command. The PIV Card Application
592   MAY allow the reference data associated with other key references (e.g., ‘96’ and ‘97’) to be
593   changed by the PIV Card Application CHANGE REFERENCE DATA if they are used for card
594   management operations and the requirements specified in Section 2.9.2 of FIPS 201-3 are
595   satisfied. If any key reference value is specified that is not supported by the card, the PIV Card
596   Application SHALL return the status word '6A 88'. Key reference '80' reference data SHALL be
597   changed by the PIV Card Application CHANGE REFERENCE DATA command. The ability to
598   change reference data associated with key references '81' and '00' using the PIV Card Application
599   CHANGE REFERENCE DATA command is optional.
600   If key reference '81' is specified and the command is not submitted over the contact interface,
601   then the card command SHALL fail. If key reference '00' or '80' is specified and the command is
602   not submitted over either the contact interface or the VCI, then the card command SHALL fail.
603   In each case, the security status and the retry counter of the key reference SHALL remain
604   unchanged.
605   If the current value of the retry counter associated with the key reference is zero, then the
606   reference data associated with the key reference SHALL NOT be changed, and the PIV Card
607   Application SHALL return the status word '69 83'. If the command is submitted over the
608   contactless interface (VCI) and the current value of the retry counter associated with the key
609   reference is at or below the issuer-specified intermediate retry value (see Section 3.2.1), then the
610   reference data associated with the key reference SHALL NOT be changed, and the PIV Card
611   Application SHALL return the status word '69 83'.
612   If the authentication data in the command data field does not match the current value of the
613   reference data or if either the authentication data or the new reference data in the command data
614   field of the command does not satisfy the criteria in Section 2.4.3, the PIV Card Application
615   SHALL NOT change the reference data associated with the key reference and SHALL return
616   either status word '6A 80' or '63 CX', with the following restrictions. If the authentication data in
617   the command data field satisfies the criteria in Section 2.4.3 and matches the current value of the
618   reference data, but the new reference data in the command data field of the command does not
619   satisfy the criteria in Section 2.4.3, the PIV Card Application SHALL return status word '6A 80'.


                                                             14
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)                                       Interfaces for Personal Identity Verification: Part 2
      September 2023                                                                          PIV Card Application Card Command Interface

620   If the authentication data in the command data field does not match the current value of the
621   reference data, but both the authentication data and the new reference data in the command data
622   field of the command satisfy the criteria in Section 2.4.3, the PIV Card Application SHALL
623   return status word '63 CX'. If status word '6A 80' is returned, the security status and retry counter
624   associated with the key reference SHALL remain unchanged. 9 If status word '63 CX' is returned,
625   the security status of the key reference SHALL be set to FALSE, and the retry counter associated
626   with the key reference SHALL be decremented by one.
627   If the card command succeeds, then the security status of the key reference SHALL be set to
628   TRUE, and the retry counter associated with the key reference SHALL be set to the reset retry
629   value associated with the key reference.
630   The initial value of the retry counter and the reset retry value associated with the key reference
631   (i.e., the number of successive failures/retries before the retry counter associated with the key
632   reference reaches zero) are issuer-dependent.
633   Command Syntax
                     CLA                        '00' or '0C' for secure messaging
                     INS                        '24'
                     P1                         '00'
                     P2                         '00' (Global PIN), '80' (PIV Card Application PIN), or '81' (PUK)
                     Lc                         '10'
                                                Current PIN authentication data concatenated without delimitation
                     Data Field                 with the new PIN reference data, both PINs as described in Section
                                                2.4.3
                     Le                         Absent
634
635   Response Syntax

                       SW1           SW2                                      Meaning
                                                Reference data change failed, X indicates the number of further
                        '63'         'CX'
                                                allowed retries or resets
                         '69'         '82'      Security status not satisfied
                         '69'         '83'      Reference data change operation blocked
                        '6A'          '80'      Incorrect parameter in command data field
                        '6A'          '81'      Function not supported
                        '6A'          '88'      Key reference not found
                         '90'         '00'      Successful execution


636   3.2.3. RESET RETRY COUNTER Card Command
637   The RESET RETRY COUNTER card command resets the retry counter of the PIN to its initial
638   value and changes the reference data. The command enables recovery of the PIV Card
639   Application PIN if the cardholder forgets it.
640   The only key reference allowed in the P2 parameter of the RESET RETRY COUNTER
641   command is '80', the PIV Card Application PIN. The PIV Card Application MAY allow the
642   reference data associated with other key references to be changed by the PIV Card Application
643   RESET RETRY but only if the requirements specified in Section 2.9.2 of FIPS 201-2 are

      9
          It is recommended that in this case the authentication data not be compared to the on-card reference data.



                                                                                15
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)                                Interfaces for Personal Identity Verification: Part 2
      September 2023                                                                   PIV Card Application Card Command Interface

644   satisfied. If a key reference is specified in P2 that is not supported by the card, the PIV Card
645   Application SHALL return the status word '6A 88'. 10
646   If the reset retry counter authentication data (PUK) in the command data field of the command
647   does not match the reference data associated with the PUK, then the PIV Card Application
648   SHALL return the status word '63 CX'. If the current value of the PUK’s retry counter is zero,
649   then the PIN’s retry counter shall not be reset, the PIV Card Application shall return the status
650   word '69 83', and the reset operation shall be blocked.
651   If the new reference data (PIN) in the command data field of the command does not satisfy the
652   criteria in Section 2.4.3, then the PIV Card Application SHALL return the status word '6A 80'. If
653   the reset retry counter authentication data (PUK) in the command data field of the command
654   does not match the reference data associated with the PUK and the new reference data (PIN) in
655   the command data field of the command does not satisfy the criteria in Section 2.4.3, then the
656   PIV Card Application SHALL return status word '6A 80' or '63 CX'. If the PIV Card Application
657   returns status word '6A 80', then the retry counter associated with the PIN SHALL NOT be reset,
658   the security status of the PIN’s key reference SHALL remain unchanged, and the PUK’s retry
659   counter SHALL remain unchanged. 11 If the PIV Card Application returns status word '63 CX',
660   then the retry counter associated with the PIN SHALL NOT be reset, the security status of the
661   PIN’s key reference SHALL be set to FALSE, and the PUK’s retry counter SHALL be
662   decremented by one.
663   If the card command succeeds, then the PIN’s retry counter SHALL be set to its reset retry value.
664   Optionally, the PUK’s retry counter MAY be set to its initial reset retry value. The security status
665   of the PIN’s key reference SHALL NOT be changed.
666   The initial retry counter associated with the PUK (i.e., the number of failures of the RESET
667   RETRY COUNTER command before the PUK’s retry counter reaches zero) is issuer-dependent.
668   Command Syntax
                  CLA                       '00'
                  INS                       '2C'
                  P1                        '00'
                  P2                        '80' (PIV Card Application PIN).
                  Lc                        '10'
                                            Reset retry counter authentication data (PUK) concatenated without delimitation
                  Data Field                with the new reference data (PIN) (both PUK and PIN as described in Section
                                            2.4.3)
                  Le                        Absent

669   Response Syntax
                    SW1          SW2                                       Meaning
                     '63'        'CX'       Reset failed, X indicates the number of further allowed resets
                     '69'         '83'      Reset operation blocked
                    '6A'          '80'      Incorrect parameter in command data field
                    '6A'          '81'      Function not supported
                    '6A'          '88'      Key reference not found
                     '90'         '00'      Successful execution

      10
         The PIV Card Application may be implemented to reset the retry counter associated with OCC data when new OCC data is loaded onto the
      card.
      11
         It is recommended that in this case the authentication data not be compared to the on-card reference data.



                                                                          16
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)                                Interfaces for Personal Identity Verification: Part 2
      September 2023                                                                   PIV Card Application Card Command Interface

670   3.2.4. GENERAL AUTHENTICATE Card Command
671   The GENERAL AUTHENTICATE card command performs a cryptographic operation, such as
672   an authentication protocol, using the data provided in the data field of the command and returns
673   the result of the cryptographic operation in the response data field. 12
674   The GENERAL AUTHENTICATE command SHALL be used with the PIV authentication keys
675   ('9A', '9B', '9E') to authenticate the card or a card application to the client application
676   (INTERNAL AUTHENTICATE), to authenticate an entity to the card (EXTERNAL
677   AUTHENTICATE), and to perform a mutual authentication between the card and an entity
678   external to the card (MUTUAL AUTHENTICATE).
679   The GENERAL AUTHENTICATE command SHALL be used with the digital signature key
680   ('9C') to realize the signing functionality on the PIV client application programming interface.
681   Data to be signed is expected to be hashed off-card. Appendix A.4 illustrates the use of the
682   GENERAL AUTHENTICATE command for signature generation.
683   The GENERAL AUTHENTICATE command SHALL be used with the key management key
684   ('9D') and the retired key management keys ('82' – '95') to realize the key establishment schemes
685   specified in SP 800-78 (ECDH and RSA). Appendix A.5 illustrates the use of the GENERAL
686   AUTHENTICATE command for key establishment schemes aided by the PIV Card Application.
687   The GENERAL AUTHENTICATE command SHALL be used with the PIV Secure Messaging
688   key ('04') and cryptographic algorithm identifier '27' or '2E' to establish session keys for secure
689   messaging, as specified in Section 4. If key reference '04' is specified in P2, then algorithm
690   identifiers in P1 other than '27' and '2E' SHALL NOT be permitted, and the PIV Card
691   Application SHALL return the status word '6A 86'.
692   The GENERAL AUTHENTICATE command supports command chaining to permit the
693   uninterrupted transmission of long command data fields to the PIV Card Application. If a card
694   command other than the GENERAL AUTHENTICATE command is received by the PIV Card
695   Application before the termination of a GENERAL AUTHENTICATE chain, the PIV Card
696   Application SHALL roll back to the state it was in immediately prior to the reception of the first
697   command in the interrupted chain. In other words, an interrupted GENERAL AUTHENTICATE
698   chain has no effect on the PIV Card Application.
699   Command Syntax
                                               '00' or '10' indicating command chaining
                     CLA
                                               '0C' or '1C' for secure messaging
                     INS                       '87'
                     P1                        Algorithm reference. See Table 18 and [SP800-78, Table 9]
                     P2                        Key reference. See Table 5, Part 1 for key reference values
                     Lc                        Length of data field
                     Data Field                See Table 7
                     Le                        Absent or '00'




      12
         The GET RESPONSE command is used to return the complete result of the cryptographic operation with keys sizes such as 2048 or 3072 bits
      RSA. The GET RESPONSE command is illustrated in Appendix A.4.1 (Command 3).



                                                                          17
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)                        Interfaces for Personal Identity Verification: Part 2
      September 2023                                                           PIV Card Application Card Command Interface

700
701                          Table 7. Data objects in the dynamic authentication template (Tag '7C')

                    Name                  Tag       M/O                             Description
              Witness                     '80'       C       Demonstration of knowledge of a fact without revealing
                                                             the fact. An empty witness is a request for a witness.
              Challenge                   '81'        C      One or more random numbers or byte sequences to be
                                                             used in the authentication protocol
              Response                    '82'        C      A sequence of bytes encoding a response step in an
                                                             authentication protocol
              Exponentiation              '85'        C      A parameter used in ECDH key agreement protocol

702   The data objects that appear in the dynamic authentication template (tag '7C') in the data field of
703   the GENERAL AUTHENTICATE card command depend on the authentication protocol being
704   executed. The Witness (tag '80') contains encrypted data (unrevealed fact), which is decrypted by
705   the card. The Challenge (tag '81') contains clear data (byte sequence), which is encrypted by the
706   card. The Response (tag '82') contains either the decrypted data from tag '80' or the encrypted
707   data from tag '81'. Note that the empty tags (i.e., tags with no data) return the same tag with
708   content (they CAN be seen as “requests for requests”):
709       •    '80 00' Returns '80 TL <encrypted random>' (as per definition)
710       •    '81 00' Returns '81 TL <random>' (as per external authenticate example)
711   Response Syntax
                                            Absent, authentication-related data, signed data, shared secret, or
                   Data Field
                                            transported key
                   SW1-SW2                  Status word
712
                    SW1           SW2                                     Meaning
                                            Successful execution where SW2 encodes the number of response
                     '61'          'xx'
                                            data bytes still available
                      '69'         '82'     Security status not satisfied
                     '6A'          '80'     Incorrect parameter in command data field
                     '6A'          '86'     Incorrect parameter in P1 or P2
                      '90'         '00'     Successful execution


713            PIV Card Application Card Commands for Credential Initialization and
714            Administration

715   3.3.1. PUT DATA Card Command
716   The PUT DATA card command completely replaces the data content of a single data object in
717   the PIV Card Application with new content.
718   Command Syntax
                   CLA                      '00' or '10' indicating command chaining
                   INS                      'DB'
                   P1                       '3F'
                   P2                       'FF'



                                                                   18
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)                      Interfaces for Personal Identity Verification: Part 2
      September 2023                                                         PIV Card Application Card Command Interface

                  Lc                     Length of data field
                  Data Field             See Tables 8, 9, and 10
                  Le                     Absent

719   For the 0x7E Discovery Object:
720                  Table 8. Data field of the PUT DATA card command for the Discovery Object

                             Tag          M/O                         Description
                                                    BER-TLV of tag '7E' as illustrated in Section 3.3.2,
                             '7E'           M
                                                    Part 1

721   For the 0x7F61 BIT Group template:
722                 Table 9. Data field of the PUT DATA card command for the BIT Group template

                             Tag          M/O                         Description
                                                    BER-TLV of tag '7F61' as illustrated in Table 7 of SP
                            '7F61'          M
                                                    800-76

723   For all other PIV data objects:
724               Table 10. Data field of the PUT DATA card command for all other PIV data objects

                            Name         Tag        M/O                      Description
                                                            Tag of the data object whose data content is
                      Tag list           '5C'          M
                                                            to be replaced. See Table 3, Part 1.
                                                            Data with tag '53' as an unstructured byte
                      Data               '53'          M
                                                            sequence
725   Response Syntax
                  Data Field             Absent
                  SW1-SW2                Status word
726

                    SW1          SW2                                     Meaning
                     '69'         '82'   Security status not satisfied
                    '6A'          '81'   Function not supported
                    '6A'          '84'   Not enough memory
                     '90'         '00'   Successful execution


727   3.3.2. GENERATE ASYMMETRIC KEY PAIR Card Command
728   The GENERATE ASYMMETRIC KEY PAIR card command initiates the generation and
729   storage of the reference data of an asymmetric key pair (i.e., a public key and a private key) in
730   the card. The public key of the generated key pair is returned as the response to the command. If
731   there is reference data currently associated with the key reference, it is replaced in full by the
732   generated data.
733   Command Syntax
                  CLA                    '00' or '10' indicating command chaining
                  INS                    '47'
                  P1                     '00'



                                                                19
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)                       Interfaces for Personal Identity Verification: Part 2
      September 2023                                                          PIV Card Application Card Command Interface

                  P2                      Key reference '04', '9A', '9C', '9D', or '9E'
                  Lc                      Length of data field
                  Data Field              Control reference template. See Table 11.
                  Le                      '00'

734                                    Table 11. Data objects in the template (Tag 'AC')

                                 Name                          Tag       M/O               Description
                   Cryptographic mechanism identifier          '80'       M       See Part 1, Table 6
                   Parameter                                   '81'       C       Specific to the cryptographic
                                                                                  mechanism

735   Response Syntax
                  Data Field              Data objects of public key of generated key pair. See Table 12
                  SW1-SW2                 Status word

736                                   Table 12. Data objects in the template (Tag '7F49')

                                                       Name                               Tag
                                      Public-key data objects for RSA
                                      Modulus                                             '81'
                                      Public exponent                                     '82'

                                      Public key data objects for ECC
                                      Point                                               '86'

737   The public-key data object in tag '86' is encoded as follows:
738                                         Table 13. Public-key encoding for ECC

                                Tag                  Length               Value
                                '86'                 L                    04 || X || Y [SECG, Section 2.3.3]

739   The octet '04' indicates that the X and Y coordinates of point P are encoded without the use of
740   point compression. The length L is 65 bytes for points on Curve P-256 and 97 bytes for points on
741   Curve P-384.
                    SW1        SW2                                        Meaning
                                          Successful execution where SW2 encodes the number of response
                     '61'      'xx'
                                          data bytes still available
                     '69'      '82'       Security status not satisfied
                                          Incorrect parameter in command data field (e.g., unrecognized
                    '6A'       '80'
                                          cryptographic mechanism)
                    '6A'       '81'       Function not supported
                                          Incorrect parameter P2; the cryptographic mechanism of the
                    '6A'       '86'       reference data to be generated is different than the cryptographic
                                          mechanism of the reference data of a given key reference
                     '90'      '00'       Successful execution
742




                                                                  20
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)                             Interfaces for Personal Identity Verification: Part 2
      September 2023                                                                PIV Card Application Card Command Interface



743            Secure Messaging
744   If a PIV Card Application implements the optional secure messaging protocol for non-card
745   management operations, it SHALL be implemented as specified in this section. Secure
746   messaging is initiated through the use of a key establishment protocol. The key establishment
747   protocol defined here is a one-way authentication protocol that authenticates the PIV Card
748   Application to the client application and establishes a set of session keys that MAY be
749   subsequently used to protect the communication channel between the two parties. 13 PIV Cards
750   MAY implement a different secure messaging protocol for card management operations. Such a
751   protocol is outside of the scope of this document. However, if it is to be used for remote post-
752   issuance updates, it SHALL satisfy the requirements of [FIPS201, Section 2.9.2].
753   Section 4.1 describes the key establishment protocol used to support secure messaging in the PIV
754   Card Application. Section 4.2 describes the use of secure messaging to protect the commands
755   and responses sent between the client application and the PIV Card Application.

756                 Key Establishment Protocol
757   The key establishment protocol for the PIV Card Application uses the One-Pass Diffie-Hellman,
758   C(1e, 1s, ECC CDH) Scheme from [SP800-56A] in a manner that is based on a simplified profile
759   of OPACITY with Zero Key Management [ANSI504-1], as depicted in below.
760                                     Table 14: Key Establishment Protocol for PIV Card Application

                   Client Application (H)                                                                     PIV Card Application (ICC)
           CB H = 0x00              H1                      CB H || ID sH
           Generate an ephemeral key pair (d eH ; Q eH )    || Q eH
           from the domain          H2
           parameters specified in the response to the
           SELECT command
           Send CB H || ID sH || Q eH        H3
                                                                                                           ID sICC = T 8 (SHA256(C ICC ))      C1
                                                                                                           CB ICC = CB H & 'F0' C2
                                                                                                           Check that CB ICC is 0x00           C3
                                                                                                           Verify that Q eH is a valid public key for the
                                                                                                           domain        C4
                                                                                                           parameters of Q sICC
                                                                                                           Z = ECC_CDH(d sICC , Q eH )         C5
                                                                                                           Generate nonce N ICC C6
                                                                                                           SK CFRM || SK MAC || SK ENC || SK RMAC =
                                                                                                           KDF(Z, len, OtherInfo)              C7
                                                                                                           Zeroize Z C8
                                                                                                           AuthCryptogram ICC =                C9
                                                            CB ICC ||                                                    CMAC(SK CRFM , “KC_1_V” ||
                                                            N ICC ||                                       ID sICC || ID sH || Q eH )
                                                            AuthCrypto                                     Zeroize SK CFRM            C10
                                                            gram ICC ||                                    Return CB ICC || N ICC || AuthCryptogram ICC ||
                                                            C ICC                                          C ICC         C11
           Check that CB ICC is 0x00         H4
           Verify C ICC signature and subject public key
                        H5
           ID sICC = T 8 (SHA256(C ICC ))    H6
           Extract Q sICC from C ICC         H7
           Z = ECC_CDH(d eH , Q sICC )       H8
           Zeroize d eH            H9


      13
           The protocol does not provide forward secrecy.



                                                                            21
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)                      Interfaces for Personal Identity Verification: Part 2
      September 2023                                                         PIV Card Application Card Command Interface

       SK CFRM || SK MAC || SK ENC || SK RMAC =
       KDF(Z, len, OtherInfo)              H10
       Zeroize Z H11
       Check that AuthCryptogram ICC equals
                     H12
                     CMAC(SK CFRM , “KC_1_V” ||
       ID sICC || ID sH || Q eH )
       Zeroize SK CFRM            H13
761
762   Sections 4.1.1 and 4.1.2 provide additional details about each of the protocol steps performed by
763   the client application and the PIV Card Application. Section 4.1.3 defines the notations used in
764   the description of the protocol. Section 4.1.4 provides details about the two cipher suites that
765   MAY be supported by the PIV Card Application. Section 4.1.5 specifies the format for the
766   secure messaging card verifiable certificate (CVC) that is used to authenticate the PIV Card
767   Application and for the optional Intermediate CVC that is used to verify the signature on the
768   secure messaging CVC when the public key needed to verify the signature on the secure
769   messaging CVC does not appear in an X.509 content signing certificate. Section 4.1.6 provides
770   additional information about the key derivation function (KDF) used to derive the session keys
771   that are used during secure messaging. Section 4.1.7 provides additional information about the
772   computation of the authentication cryptogram for key confirmation. Section 4.1.8 demonstrates
773   the use of the GENERAL AUTHENTICATE command to perform the key establishment
774   protocol.

775   4.1.1. Client Application Steps
776                                         Table 15: Protocol Steps for Client Application

       Step #                                     Description                                        Comment
       H1          Set CB H to 0x00                                               The client application’s control byte is set to
                                                                                  0x00 to indicate that the client application does
                                                                                  not support persistent binding.
       H2          Generate an ephemeral key pair (d eH ; Q eH )                  Generate an ephemeral ECC key pair
                                                                                  for the client application using an
                                                                                  approved method [FIPS186, Appendix
                                                                                  B], and perform partial public-key
                                                                                  validation [SP800-56A, Section
                                                                                  5.6.2.3.2], either as part of the key
                                                                                  generation process or as a separate
                                                                                  process. If the 0xAC tag of the
                                                                                  application property template (APT)
                                                                                  includes '27', then generate an
                                                                                  ephemeral key pair over Curve P-256.
                                                                                  If the 0xAC tag of the APT includes
                                                                                  '2E', then generate an ephemeral key
                                                                                  pair over Curve P-384.
       H3        Send CB H || ID sH || Q eH
       Wait for response from PIV Card Application:
              CB ICC || N ICC || AuthCryptogram ICC || C ICC




                                                                   22
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)                                    Interfaces for Personal Identity Verification: Part 2
      September 2023                                                                       PIV Card Application Card Command Interface

           Step #                          Description                                                                   Comment
           H4       Check that CB ICC is 0x00                                                      Verify that the card executed the protocol in
                                                                                                   accordance with the parameters specified in
                                                                                                   Step H1. Return an authentication error if check
                                                                                                   fails.
           H5       Verify C ICC signature and subject public key                                  Verify signature on C ICC and, using standards-
                                                                                                   compliant PKI path validation, validate the
                                                                                                   content signing certificate needed to verify the
                                                                                                   signature on C ICC . 14,15 Verify that the domain
                                                                                                   parameters of the subject public key in C ICC are
                                                                                                   the same as the domain parameters for Q eH by
                                                                                                   checking the Algorithm OID in the
                                                                                                   CardHolderPublicKey data object (see Table
                                                                                                   19). Return an authentication error if either
                                                                                                   verification fails.
           H6       ID sICC = T 8 (SHA256(C ICC ))                                                 ID sICC — the leftmost 8 bytes of the SHA-256
                                                                                                   hash of C ICC — is used as an input for session
                                                                                                   key derivation.
           H7       Extract Q sICC from C ICC
           H8       Z = ECC_CDH (d eH , Q sICC )                                                   Compute the shared secret Z using the ECC
                                                                                                   CDH primitive [SP800-56A, Section 5.7.1.2].
           H9       Zeroize d eH                                                                   Destroy the ephemeral private key generated in
                                                                                                   Step H2.
           H10      SK CFRM || SK MAC || SK ENC || SK RMAC =                                       Compute the key confirmation key and the
                                                    KDF(Z, len, OtherInfo)                         session keys. See Section 4.1.6.
           H11      Zeroize Z                                                                      Destroy the shared secret generated in Step H8.
           H12      Check that AuthCryptogram ICC equals                                           Perform key confirmation by verifying the
                      CMAC(SK CFRM , "KC_1_V" || ID sICC || ID sH || Q eH )                        authentication cryptogram, as described in
                                                                                                   Section 4.1.7. Return an authentication error if
                                                                                                   verification fails.
           H13      Zeroize SK CFRM                                                                Destroy the key confirmation key derived in
                                                                                                   Step H10.


777   4.1.2. PIV Card Application Protocol Steps
778                                         Table 16: Protocol Steps for PIV Card Application

           Step #                          Description                                                                Comment
           C1       ID sICC = T 8 (SHA256(C ICC ))                                                 ID sICC — the leftmost 8 bytes of the SHA-256
                                                                                                   hash of C ICC — is used as an input for session
                                                                                                   key derivation. (Note that ID sICC is static and
                                                                                                   MAY be pre-computed off-card.)




      14
         If the public key needed to verify the signature on CICC appears in an Intermediate CVC, then verify the signatures on both CICC and the
      Intermediate CVC and — using standards-compliant PKI validation — validate the content signing certificate needed to verify the signature on
      the Intermediate CVC.
      15
         Validation of the content signing certificate does not need to be performed at the time of signature verification if the certificate has been
      previously validated or if the public key needed to verify the signature on CICC has been previously obtained from a trusted source.



                                                                             23
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)                                    Interfaces for Personal Identity Verification: Part 2
      September 2023                                                                       PIV Card Application Card Command Interface

           Step #                                  Description                                                          Comment
           C2            CB ICC = CB H & 'F0'                                                     Create the PIV Card Application’s control byte
                                                                                                  from the client application’s control byte,
                                                                                                  indicating that persistent binding has not been
                                                                                                  used in the transaction even if CB H indicates
                                                                                                  that the client application supports it. This
                                                                                                  MAY be done by setting CB ICC to the value of
                                                                                                  CB H and then setting the four least significant
                                                                                                  bits of CB ICC to 0.
           C3            Check that CB ICC is 0x00                                                Return an error ('6A 80') if CB ICC is not 0x00.
           C4            Verify that Q eH is a valid public key for the domain                    Perform partial public-key validation of Q eH
                         parameters of Q sICC                                                     [SP800-56A, Section 5.6.2.3.3], 16 where the
                                                                                                  domain parameters are those of Q sICC . Verify
                                                                                                  that P1 is '27' if the domain parameters of Q sICC
                                                                                                  are those of Curve P-256 or that P1 is '2E' if the
                                                                                                  domain parameters of Q sICC are those of Curve
                                                                                                  P-384. Return '6A 86' if P1 has the incorrect
                                                                                                  value. Return '6A 80' if public-key validation
                                                                                                  fails.
           C5            Z = ECC_CDH (d sICC , Q eH )                                             Compute the shared secret Z using the ECC
                                                                                                  CDH primitive [SP800-56A, Section 5.7.1.2].
           C6            Generate nonce N ICC                                                     Create a random nonce, where the length is as
                                                                                                  specified in Table 18. The nonce should be
                                                                                                  created using an approved random bit
                                                                                                  generator where the security strength supported
                                                                                                  by the random bit generator is at least as great
                                                                                                  as the bit length of the nonce being generated
                                                                                                  [SP800-56A, Section 5.3].
           C7            SK CFRM || SK MAC || SK ENC || SK RMAC =                                 Compute the key confirmation key and the
                                                         KDF (Z, len, Otherinfo)                  session keys. See Section 4.1.6.
           C8            Zeroize Z                                                                Destroy the shared secret generated in Step C5.
           C9            AuthCryptogram ICC =                                                     Compute the authentication cryptogram for key
                            CMAC(SK CFRM , "KC_1_V" || ID sICC || ID sH || Q eH )                 confirmation, as described in Section 4.1.7.
           C10           Zeroize SK CFRM                                                          Destroy the key confirmation key derived in
                                                                                                  Step C7.
           C11           Return CB ICC || N ICC || AuthCryptogram ICC || C ICC


779   4.1.3. Notations
780                                            Table 17: Notations used in Protocol Description

                        Name                                       Comment                                           Format    Size (in bytes)
                 ICC                    Integrated Circuit Card (PIV Card)                                           N/A      N/A
                 ID sICC                Static, non-anonymous PIV Card identifier, which is the                      Binary   8 bytes
                                        truncated hash of C ICC
                 GUID                   Card UUID (see Section 3.4.1 of Part 1)                                      Binary   16 bytes
                 C ICC                  Secure messaging card verifiable certificate, which is                       CVC
                                        authenticated by client application. See Section 4.1.5.
                 ID sH                  Client application identifier. This is a locally assigned                    Binary   8 bytes
                                        identifier for the client application. If none is available, it
                                        could be set to all zeros.



      16
           The PIV Card Application may perform full public-key validation instead [SP800-56A, Section 5.6.2.3.2].



                                                                              24
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)                     Interfaces for Personal Identity Verification: Part 2
      September 2023                                                        PIV Card Application Card Command Interface

                    Name                               Comment                                  Format      Size (in bytes)
            N ICC                PIV Card Application nonce. See Table 18 for the length.       Binary     16 or 24 bytes

            SK CFRM              Key confirmation key used to compute authentication                       16 or 32 bytes
                                 cryptogram. See Table 18 for the length.
            SK MAC , SK RMAC ,   Secure messaging session keys. See Table 18 for                           16 or 32 bytes
            SK ENC               encryption or MAC session key length.
            T 8 (Data)           Leftmost 8 bytes of Data.                                      Binary     8 bytes
            T 16 (Data)          Leftmost 16 bytes of Data.                                     Binary     16 bytes
            KDF(Z, len,          Key Derivation Function (KDF) specified in Section 4.1.6.      N/A        N/A
            OtherInfo)
            ECC_CDH              Elliptic curve cryptography cofactor Diffie-Hellman (ECC       N/A        N/A
                                 CDH) primitive, as specified in [SP800-56A, Section
                                 5.7.1.2].
            OtherInfo            Input parameters to the KDF. See Section 4.1.6.                N/A        N/A
            len                  The length (in bits) of the secret keying material to be       N/A        N/A
                                 generated using the KDF (len = 512 for cipher suite 2 and
                                 1024 for cipher suite 7).
            CB ICC               Protocol control byte returned by the PIV Card                 Binary     1 byte
            CB H                 Protocol control byte sent by client application (host)        Binary     1 byte



781   4.1.4. Cipher Suite
782   This document specifies two cipher suites (see Table 18) that MAY be used for key
783   establishment and secure messaging: one that provides 128 bits of channel strength and one that
784   provides 192 bits of channel strength. If the PIV Card Application supports the VCI and either
785   the digital signature key ('9C'), the key management key ('9D'), or one of the retired key
786   management keys ('82' – '95') is an ECC (Curve P-384) key, then PIV Card Application SHALL
787   only support cipher suite CS7. Otherwise, the PIV Card Application MAY support either CS2 or
788   CS7.
789                                    Table 18. Cipher suite for PIV secure messaging

                Cipher suite properties               128 bit channel strength       192 bit channel strength
       Cipher Suite ID                               CS2                            CS7
       Algorithm Identifier (P1)                     '27'                           '2E'
       Key confirmation and session keys             AES 128                        AES 256
       (SK CFRM , SK MAC , SK RMAC , SK ENC )
       C ICC signature                               ECDSA with SHA-256             ECDSA with SHA-384
                                                     using an ECDSA (Curve P-       using an ECDSA (Curve P-
                                                     256) key                       384) key
       C ICC public key                              ECDH (Curve P-256)             ECDH (Curve P-384)
       KDF hash                                      SHA-256                        SHA-384
       Nonce (N ICC )                                16 bytes                       24 bytes


790   4.1.5. Card Verifiable Certificates
791   Table 19 specifies the format for the secure messaging CVC, C ICC . Table 20 specifies the
792   format for the optional Intermediate CVC.




                                                                25
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)                                    Interfaces for Personal Identity Verification: Part 2
      September 2023                                                                       PIV Card Application Card Command Interface

793   C ICC is used to authenticate the PIV Card Application. The specific data object tags and specified
794   order must be used for both CVCs to allow the CVC processing within authentication protocols.
795   The specific data object tags for C ICC and the optional Intermediate CVC are provided in Table
796   19 and Table 20, respectively.
797   The signature of the secure messaging CVC (DigitalSignature object) is calculated over the
798   concatenation of the TLV-encoded Credential Profile Identifier, Issuer Identification Number,
799   Subject Identifier, CardHolderPublicKey Data Object, and Role Identifier (i.e., { '5F29' '01' '80' }
800   || { '42' '08' IIN } || { '5F20' '10' GUID } || { '7F49' L1 { { '06' L2 OID } { '86' L3 '04' X Y } } } {
801   '5F4C' '01' '00' }). Before signing the CVC, the signer SHALL perform partial public-key
802   validation [SP800-56A, Section 5.6.2.3.2] for the public key that will be placed in the public-key
803   object and SHALL verify that the PIV Card is in possession of the corresponding private key
804   (see [SP800-56A, Section 5.6.2.2.3.2] and [SP800-57, Section 8.1.5.1.1.2] for discussions on
805   methods to obtain assurance of private-key possession).
806                                 Table 19. Secure messaging card verifiable certificate format

        Tag           Tag          Tag        Length                  Name                                 Value
      0x7F21                                               Card Verifiable Certificate
                   0x5F29                    1             Credential Profile          0x80
                                                           Identifier
                   0x42                      8             Issuer Identification       The leftmost 8 bytes of the
                                                           Number                      subjectKeyIdentifier in the content signing
                                                                                       certificate needed to verify the signature on
                                                                                       C ICC 17
                   0x5F20                    16            Subject Identifier          GUID (Card UUID)
                   0x7F49                    Variable       CardHolderPublicKey
                                                            Data Object
                                  0x06       Variable       Algorithm OID              Possible values are:
                                                                                       0x2A8648CE3D030107 for ECDH (Curve
                                                                                       P-256) or
                                                                                       0x2B81040022 for ECDH (Curve P-384)
                                  0x86       Variable       Public-key object          Coded as follows: 04 || X || Y, where X and
                                                                                       Y are the coordinates of the point on the
                                                                                       curve. See the “Value” column of Table 13.
                   0x5F4C                    1             Role Identifier             0x00 for card-application key CVC
                   0x5F37                    Variable      DigitalSignature object     DigitalSignature ::= SEQUENCE {
                                                                                                 signatureAlgorithm
                                                                                                 AlgorithmIdentifier,
                                                                                                 signatureValue BIT STRING
                                                                                       }
                                                                                       AlgorithmIdentifier ::= SEQUENCE {
                                                                                                 algorithm         OBJECT
                                                                                       IDENTIFIER,
                                                                                                 parameters        ANY DEFINED
                                                                                       BY
                                                                                                           algorithm OPTIONAL
                                                                                       }
                                                                                       algorithm is 1.2.840.10045.4.3.2 for
                                                                                       ECDSA with SHA-256 (cipher suite 2) and
                                                                                       1.2.840.10045.4.3.3 for ECDSA with SHA-

      17
         If the public key needed to verify the signature on the secure messaging CVC appears in an Intermediate CVC, then the Issuer Identification
      Number SHALL be the value of the Subject Identifier in the Intermediate CVC.



                                                                             26
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)                   Interfaces for Personal Identity Verification: Part 2
      September 2023                                                      PIV Card Application Card Command Interface

        Tag       Tag        Tag       Length             Name                                  Value
                                                                            384 (cipher suite 7). For both algorithms,
                                                                            the parameters field is absent.
                                                                            signatureValue is the DER encoding of
                                                                            signature result ECDSA-Sig-Value defined
                                                                            below.
                                                                            ECDSA-Sig-Value ::= SEQUENCE {
                                                                                     r        INTEGER,
                                                                                     s        INTEGER
                                                                            }

807                                Table 20. Intermediate card verifiable certificate format

        Tag       Tag        Tag       Length           Name                                 Value
      0x7F21                          Variable Card Verifiable
                                               Certificate
                0x5F29                1        Credential Profile       0x80
                                               Identifier
                0x42                  8        Issuer Identification    The leftmost 8 bytes of the subjectKeyIdentifier
                                               Number                   in the content signing certificate needed to
                                                                        verify the signature on the Intermediate CVC
                0x5F20                8         Subject Identifier      The leftmost 8 bytes of the SHA-1 hash of the
                                                                        public-key object
               0x7F49                Variable   PublicKey Data
                                                Object
                           0x06      Variable   Algorithm OID          Possible values are:
                                                                       0x2A8648CE3D030107 for ECDH (Curve P-256)
                                                                       or
                                                                       0x2B81040022 for ECDH (Curve P-384)
                           0x86      Variable   Public-key object      Coded as follows: 04 || X || Y, where X and Y are
                                                                       the coordinates of the point on the curve. See the
                                                                       “Value” column of Table 13.
                0x5F4C                1        Role Identifier          0x12 for card-application root CVC
                0x5F37                Variable DigitalSignature         DigitalSignature ::= SEQUENCE {
                                               object                            signatureAlgorithm
                                                                                 AlgorithmIdentifier,
                                                                                 signatureValue BIT STRING
                                                                        }
                                                                        AlgorithmIdentifier ::= SEQUENCE {
                                                                                 algorithm          OBJECT
                                                                        IDENTIFIER,
                                                                                 parameters         ANY DEFINED BY
                                                                                            algorithm OPTIONAL
                                                                        }
                                                                        algorithm is 1.2.840.113549.1.1.11 for RSA
                                                                        with SHA-256 and PKCS #1 v1.5 padding. The
                                                                        parameters field SHALL be NULL.

808   The signature of the Intermediate CVC (DigitalSignature object) is calculated over the
809   concatenation of the TLV-encoded Credential Profile Identifier, Issuer Identification Number,
810   Subject Identifier, PublicKey Data Object, and Role Identifier (i.e., { '5F29' '01' '80' } || { '42' '08'
811   IIN } || { '5F20' '08' SI } || { '7F49' L1 { { '06' L2 OID } { '86' L3 '04' X Y } } } { '5F4C' '01' '12'
812   }). Before signing the CVC, the signer SHALL perform partial public-key validation [SP800-
813   56A, Section 5.6.2.3.2] for the public key that will be placed in the public-key object and


                                                              27
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)                          Interfaces for Personal Identity Verification: Part 2
      September 2023                                                             PIV Card Application Card Command Interface

814   SHALL verify that the subject is in possession of the corresponding private key (see [SP800-
815   56A, Section 5.6.2.2.3.2] and [SP800-57, Section 8.1.5.1.1.2] for discussions on methods to
816   obtain assurance of private-key possession).

817   4.1.6. Key Derivation
818   The session keys SHALL be derived in Steps C7 and H10 of the protocol using the key
819   derivation function from [SP800-56A, Section 5.8.1], with the auxiliary function H being the
820   hash function specified as the KDF hash in Table 18, the length of the keying material to be
821   derived (len) being 512 bits for CS2 and 1024 bits for CS7, and OtherInfo being constructed
822   using the following concatenation format:
       Cipher
                                                                         OtherInfo
       Suite ID
       CS2        0x04 || 0x09 || 0x09 || 0x09 || 0x09 || 0x08 || ID sH || 0x01 || CB H || 0x10 || T 16 (Q eH ) || 0x08 || ID sICC ||
                  0x10 || N ICC || 0x01 || CB ICC
       CS7        0x04 || 0x0D || 0x0D || 0x0D || 0x0D || 0x08 || ID sH || 0x01 || CB H || 0x10 || T 16 (Q eH ) || 0x08 ||
                  ID sICC || 0x18 || N ICC || 0x01 || CB ICC

823   For Q eH , the coordinates of the ephemeral public key are converted from field elements to byte
824   strings (as specified in [SP800-56A, Appendix C.2]), Field-Element-to-Byte String Conversion,
825   and concatenated (with x first) to form a single byte string. The first 16 bytes from this byte
826   string are included in OtherInfo.

827   4.1.7. Key Confirmation
828   Key confirmation SHALL be performed in Steps C9 and H12 of the protocol by the generation
829   of AuthCryptogram ICC in accordance with Sections 5.9.1.1 and 6.2.2.3 of [SP800-56A].
830   AuthCryptogram ICC SHALL be computed as CMAC(MacKey, MacLen, MacData p ), where
831   MacKey is SK CFRM , MacLen is 128 bits, and MacData p is "KC_1_V" || ID sICC || ID sH || Q eH .
832   "KC_1_V" is a 6-byte ASCII string ('4B 43 5F 31 5F 56'). For Q eH , the coordinates of the
833   ephemeral public key are converted from field elements to byte strings (as specified in [SP800-
834   56A, Appendix C.2]), Field-Element-to-Byte String Conversion, and concatenated (with x first)
835   to form a single byte string. CMAC is a cipher-based message authentication code from
836   [SP800-38B], where the block cipher is AES.

837   4.1.8. Command Interface
838   The following command interface SHALL be used for the key establishment protocol.
839   Command Syntax
                CLA                    '00'
                INS                    '87'
                                       Algorithm reference ('27' or '2E'), as specified in the 0xAC tag of the
                P1
                                       application property template
                P2                     '04' (PIV Secure Messaging key).
                Lc                     Length of data field



                                                                    28
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)                     Interfaces for Personal Identity Verification: Part 2
      September 2023                                                        PIV Card Application Card Command Interface

                                     '7C' L1 { '81' L2 { CB H || ID sH || Q eH } '82 00' }, where CB H is 0x00,
                                     ID sH is an 8-byte client application identifier as described in Section
                Data Field
                                     4.1.3, and Q eH is an ephemeral public key encoded as 04 || X || Y, as
                                     specified in the “Value” column of Table 13.
                Le                   '00'

840   Response Syntax
                Data Field           '7C' L1 { '82' L2 { CB ICC || N ICC || AuthCryptogram ICC || C ICC } }
                SW1-SW2              Status word
841
                 SW1         SW2                                   Meaning
                                     Successful execution, where SW2 encodes the number of response
                  '61'       'xx'
                                     data bytes still available
                  '6A'       '80'    Incorrect parameter in command data field
                  '6A'       '86'    Incorrect parameter in P1 or P2
                   '90'      '00'    Successful execution


842           Secure Messaging
843   PIV secure messaging is used to protect the integrity and confidentiality of the PIV data being
844   transmitted between the card and the relying system. PIV secure messaging SHALL be provided
845   using symmetric session keys derived through the key establishment protocol defined Section
846   4.1.
847   Once session keys are established and the card is authenticated as specified in Section 4.1,
848   subsequent communication with the card CAN be performed using secure messaging by setting
849   bits b3 and b4 of the CLA byte of the command APDU to 1, resulting in a '0C' or '1C' CLA byte.
850   If bits b3 and b4 of the CLA byte are set, then both the command and the response SHALL be
851   encrypted and integrity protected, as described in this section. If the PIV Card Application
852   CANNOT encrypt and integrity protect the response (e.g., because it does not support secure
853   messaging or no session keys have been established), the PIV Card Application SHALL return
854   an error (see Section 4.2.7). In the case of command chaining, if bits b3 and b4 of the CLA are
855   set in any command in the chain, then they SHALL be set in every command in the chain.
856   When secure messaging is used, the data field of the card command (or response) is encrypted
857   first and then a message authentication code (MAC) is applied to the entire command (or
858   response). When command (or response) chaining is required, the encryption and MAC are
859   applied to the entire message and the result is then fragmented into separate command (or
860   response) data fields.
861   In order to ensure that message reordering or replay attacks CAN be detected, a 16-byte MAC
862   chaining value (MCV) is used. For the first command, and for the first response, sent after
863   successful completion of the key establishment protocol the MCV consists of 16 bytes of '00'.
864   For each subsequent command the MCV is the 16-byte MAC value computed on the previous
865   command, and for each subsequent response the MCV is the 16-byte MAC value computed on
866   the previous response. The MCV is included as part of the message over which the MAC value
867   for each command (or response) is computed.
868   The SK ENC session key SHALL be used to encrypt the command data field and response data
869   field, as described in Section 4.2.2. The SK MAC session key SHALL be used to add integrity to


                                                                29
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)                 Interfaces for Personal Identity Verification: Part 2
      September 2023                                                    PIV Card Application Card Command Interface

870   the command, as described in Section 4.2.3. The SK RMAC session key SHALL be used to add
871   integrity to the response, as described in Section 4.2.5.
872   Secure messaging specified in this section CAN be applied to the following commands:
873       •   GET DATA
874       •   VERIFY
875       •   CHANGE REFERENCE DATA
876       •   GENERAL AUTHENTICATE

877   4.2.1. Secure Messaging Data Objects
878   The command and response messages SHALL be BER-TLV encoded according to Table 21.
879                                     Table 21. Secure messaging data objects

                   Tag                                         Description
                '87'        Padding content indicator byte followed by the encrypted data
                '8E'        Cryptographic checksum (MAC)
                '97'        Le
                '99'        Status word


880   4.2.2. Command and Response Data Confidentiality
881   Under secure messaging, the PIV data is encrypted using AES in Cipher Block Chaining (CBC)
882   mode with the SK ENC session key, where SK ENC is a 128-bit key for CS2 and a 256-bit key for
883   CS7, as per Table 18. The encryption and encoding process for command data and response data
884   SHALL be the same. The encryption of the command data or response data and encoding in
885   BER-TLV format is illustrated Fig. 1. The encryption SHALL be computed over the entire
886   message before applying fragmentation for data transportation.




                                                             30
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)                 Interfaces for Personal Identity Verification: Part 2
      September 2023                                                    PIV Card Application Card Command Interface




887
888                                           Fig. 1. PIV data confidentiality

889   Initialization Vector (IV). The IV for the AES CBC encryption of command data SHALL be
890   generated by applying the AES block cipher to a 16-byte encryption counter. The initial value of
891   the encryption counter upon successful completion of the key establishment protocol SHALL be
892   '00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01'. The encryption counter SHALL be
893   incremented by one after each APDU sent over secure messaging (except for the GET
894   RESPONSE command and APDUs with a CLA of '1C'), and it SHALL be reset to its initial
895   value after each successful completion of the key establishment protocol. The 16-byte IV
896   SHALL be created by encrypting the encryption counter with SK ENC using AES in the electronic
897   codebook (ECB) mode of operation.
898   The IV for the AES CBC encryption of response data SHALL also be generated by encrypting
899   an encryption counter with SK ENC using AES in the ECB mode of operation. The encryption
900   counter value used to generate the IV to encrypt the response data SHALL be the same as the
901   encryption counter value used to generate the IV to encrypt the corresponding request data, with
902   the exception that the most significant byte of the 16-byte counter SHALL be set to '80' (i.e., the
903   IV used to encrypt the first response after successful completion of the key establishment
904   protocol SHALL be generated by encrypting '80 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01'
905   with SK ENC ).




                                                            31
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)                                          Interfaces for Personal Identity Verification: Part 2
      September 2023                                                                             PIV Card Application Card Command Interface

906   Padding. Prior to encryption, 1 – 16 bytes of padding data SHALL be appended to the PIV data.
907   The padding SHALL be '80' followed by the number of zeros needed to make the total length of
908   the message to be encrypted (i.e., PIV data plus padding) a multiple of 16 bytes. The first byte of
909   the value field of tag '87' — the padding content indicator byte — SHALL be '01' to indicate that
910   padding has been applied.
911   As illustrated in Fig. 1, the input and output of encryption is as follows:
912           •     Encryption input:
913                 Plain Text
914           •     Encryption output:
915                 BER-TLV-encoded encrypted message, which consists of tag '87' followed by the length
916                 of the encoded encrypted message (L cc + 1), the padding indicator byte ('01'), and then
917                 the encrypted data. L cc is the length of the encrypted PIV data; it SHALL be a multiple of
918                 16.

919   4.2.3. Command Integrity
920   The Command MAC (C-MAC) SHALL be generated by applying the cipher-based MAC
921   (CMAC) [SP800-38B] to the header and data field of a command using the SK MAC session key.
922   If fragmentation is required for data transmission, the command SHALL be constructed without
923   fragmentation for the purposes of computing the MAC, and the CLA byte used in the
924   computation of the MAC SHALL be '0C'.
925   The data to be MACed, M C-MAC , SHALL be constructed by concatenating the following:
926           1. The 16-byte MAC chaining value (MCV). For the first command sent after successful
927              completion of the key establishment protocol the MCV consists of 16 bytes of '00'. For
928              each subsequent command the MCV is the 16-byte MAC value computed for the
929              previous command.
930           2. A 16-btye encoded header. The encoded header SHALL consist of the CLA byte ('0C'),
931              the INS byte, P1, and P2, followed by twelve bytes of padding, consisting of '80'
932              followed eleven bytes of '00'. (The length of the data field, L c , is not included in the data
933              to be MACed.)
934           3. The data field, which is the BER-TLV-encoded encrypted message. 18
935           4. L e encapsulated in BER-TLV format with tag '97' if the L e field is included in the
936              command. 19
937   Let T C-MAC = CMAC(SK MAC , M C-MAC ), as described in [SP800-38B]. The BER-TLV-encoded C-
938   MAC for the command SHALL be the 8 most significant bytes of T C-MAC encapsulated in BER-
939   TLV format with tag '8E'. The entire 16-byte value T C-MAC will be the MCV for the next
940   command.
941   Figure 2 illustrates how the C-MAC is generated for each command.


      18
           The data field may be absent in the case of the VERIFY command.
      19
           As noted in Sections 3.1.2 and 3.2.4, the value of Le will always be '00' when it is present.



                                                                                  32
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)                                 Interfaces for Personal Identity Verification: Part 2
      September 2023                                                                    PIV Card Application Card Command Interface




942
943                                                Fig. 2. PIV data integrity of command


944   4.2.4. Command With PIV Secure Messaging
945   For secure messaging, the secure messaging data field SHALL be constructed as the
946   concatenation of the following:
947        •    The BER-TLV-encoded encrypted PIV data; 20
948        •    The 3-btye BER-TLV-encoded L e , as described in Section 4.2.3, if L e would have been
949             included in a message sent without secure messaging;
950        •    The 10-byte BER-TLV-encoded C-MAC of the command, as described in Section 4.2.3;
951             and
952        •    A new L e field, which SHALL be 1 byte and SHALL have a value of '00'. 21



      20
        The data field may be absent in the case of the VERIFY command.
      21
        Note that the new Le field is always included in the command — even if Le would have been absent if the command were sent without secure
      messaging — since a response is always expected, even if the expected response only consists of the BER-TLV-encoded status word and
      response MAC (R-MAC).



                                                                          33
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)            Interfaces for Personal Identity Verification: Part 2
      September 2023                                               PIV Card Application Card Command Interface

953   Figure 3 shows the APDU for secure messaging when command chaining is not required. The
954   APDU consists of the CLA byte ('0C'), INS, P1, P2, the length of the secure messaging data field
955   (L c '), the secure messaging data field, and the new L e field ('00').




956
957                                 Fig. 3. Single command under secure messaging

958   Command chaining will be needed if the secure messaging data field to be transported is larger
959   than 255 bytes. Figure 4 shows the APDUs for secure messaging when the length of the secure
960   messaging data field is between 256 and 510 bytes, which requires the data to be fragmented
961   across two APDUs. The APDUs are constructed in the same manner as when fragmentation is
962   not required, except that the CLA byte for the first APDU is '1C', the first APDU contains the
963   first 255 bytes of the secure messaging data field, and the second APDU contains the remaining
964   bytes of the secure messaging data field and the new L e field ('00'). The PIV Card Application
965   provides a 2-byte response of '90 00' for the first APDU. After receiving the second APDU, the
966   PIV Card Application reconstructs and processes the entire command.




967
968                                Fig. 4. Chained command under secure messaging


969   4.2.5. Response Integrity
970   The response MAC (R-MAC) SHALL be generated by applying CMAC [SP800-38B] to the data
971   field and status bytes of the response using the SK RMAC session key. An R-MAC SHALL be
972   generated for each response that corresponds to a command that was sent to the card using secure
973   messaging.
974   The data to be MACed, M R-MAC , SHALL be constructed by concatenating the following:
975       1. The 16-byte MAC chaining value (MCV). For the first response sent after successful
976          completion of the key establishment protocol the MCV consists of 16 bytes of '00'. For
977          each subsequent response the MCV is the 16-byte MAC value computed for the previous
978          response.
979       2. The data field (if present), which is the BER-TLV-encoded encrypted message



                                                         34
      NIST SP 800-73pt2-5 ipd (Initial Public Draft)                 Interfaces for Personal Identity Verification: Part 2
      September 2023                                                    PIV Card Application Card Command Interface

980       3. The status word, SW1, and SW2 encapsulated in BER-TLV format with tag '99'
981   Let T R-MAC = CMAC(SK RMAC , M R-MAC ), as described in [SP800-38B]. The BER-TLV-encoded
982   R-MAC for the response SHALL be the 8 most significant bytes of T R-MAC encapsulated in BER-
983   TLV format with tag '8E'. The entire 16-byte value T R-MAC will be the MCV for the next
984   response.
985   Figure 5 illustrates how the R-MAC is generated for the response.




986
987                                        Fig. 5. PIV data integrity of response


988   4.2.6. Response With PIV Secure Messaging
989   For secure messaging, the secure messaging data field that is sent by the PIV Card Application
990   SHALL be constructed as the concatenation of the following:
991       •   The BER-TLV-encoded encrypted message (when present);
992       •   The 4-byte BER-TLV-encoded status word, as described in Section 4.2.5; and
993       •   The 10-byte BER-TLV-encoded R-MAC of the response, as described in Section 4.2.5.
994   Figure 6 illustrates a response under secure messaging when response chaining is not required.
995   The APDU consists of the secure messaging data field and the 2-byte SW processing status ('90
996   00'), which indicates that the PIV Card Application successfully verified the C-MAC on the


                                                            35
       NIST SP 800-73pt2-5 ipd (Initial Public Draft)                                      Interfaces for Personal Identity Verification: Part 2
       September 2023                                                                         PIV Card Application Card Command Interface

997    command and decrypted the data field in the command (if present). If the PIV Card Application
998    was unable to verify the C-MAC on the command or decrypt the data field in the command, then
999    it SHALL return a 2-byte error response, as described in Section 4.2.7.




1000
1001                                            Fig. 6. Single response under secure messaging

1002   Response chaining 22 will be needed if the secure messaging data field to be transported is larger
1003   than 256 bytes. Figure 7 shows the APDUs for secure messaging that are sent by the PIV Card
1004   Application when the length of the secure messaging data field is between 513 and 768 bytes,
1005   which requires the data to be fragmented across three APDUs. After the first response, an APDU
1006   of '00 C0 00 00 00' will be sent to request the second response. After the second response, an
1007   APDU of '00 C0 00 00 xx' will be sent to request the third response.




1008
1009                                           Fig. 7. Chained response under secure messaging


1010   4.2.7. Error Handling
1011   The SW processing status is the status word of the overall secure messaging command and
1012   response processing. It indicates whether the secure messaging was performed successfully. If
1013   the processing was successful, it SHALL be '90 00'. Otherwise, it SHALL be as follows:
1014           •    '68 82' – Secure messaging not supported
1015           •    '69 82' – Security status not satisfied 23
1016           •    '69 87' – Expected secure messaging data objects are missing
1017           •    '69 88' – Secure messaging data objects are incorrect

       22
            Response chaining is accomplished by issuing several GET RESPONSE commands to the card.
       23
            Status word '69 82' is used when secure messaging is requested but no session keys have been established.



                                                                                36
       NIST SP 800-73pt2-5 ipd (Initial Public Draft)                                  Interfaces for Personal Identity Verification: Part 2
       September 2023                                                                     PIV Card Application Card Command Interface

1018   If the command processing was unsuccessful, the card SHALL return one of the above status
1019   words without performing further secure messaging.

1020              Session Key Destruction
1021   The session keys established after successful execution of the key establishment protocol in
1022   Section 4.1 SHALL be zeroized in the following circumstances:
1023        •     The card is reset,
1024        •     An error occurs in secure messaging, 24 or
1025        •     New session keys are requested by the client application by sending a GENERAL
1026              AUTHENTICATE command to the card to perform the key establishment protocol using
1027              the PIV Secure Messaging key.
1028




       24
         An error has occurred in secure messaging if the SW processing status in the response to a command sent with secure messaging is other than
       '61 XX' or '90 00'.



                                                                             37
       NIST SP 800-73pt2-5 ipd (Initial Public Draft)            Interfaces for Personal Identity Verification: Part 2
       September 2023                                               PIV Card Application Card Command Interface

1029   References
1030   [ANSI504-1]           Information Technology - Generic Identity Command Set – Part 1: Card
1031                         Application Command Set, 13th Edition, 2018.
1032   [FIPS201]             National Institute of Standards and Technology (2022) Personal Identity
1033                         Verification (PIV) of Federal Employees and Contractors. (U.S. Department
1034                         of Commerce, Washington, DC), Federal Information Processing Standards
1035                         Publication (FIPS) 201-3. https://doi.org/10.6028/NIST.FIPS.201-3
1036   [ISO7816]             International Organization for Standardization/International Electrotechnical
1037                         Commission (2004-2020) ISO/IEC 7816 — Identification cards — Integrated
1038                         circuit cards. (multiple parts):
1039                          International Organization for Standardization/International
1040                             Electrotechnical Commission (2020) ISO/IEC 7816-4:2020 —
1041                             Identification cards — Integrated circuit cards — Part 4: Organization,
1042                             security and commands for interchange. (International Organization for
1043                             Standardization, Geneva, Switzerland) [or as amended]. Available at
1044                             https://www.iso.org/standard/77180.html
1045                          International Organization for Standardization/International
1046                             Electrotechnical Commission (2004) ISO/IEC 7816-5:2004 —
1047                             Identification cards — Integrated circuit cards — Part 5: Registration of
1048                             application providers. (International Organization for Standardization,
1049                             Geneva, Switzerland) [or as amended]. Available at
1050                             https://www.iso.org/standard/34259.html
1051                          International Organization for Standardization/International
1052                             Electrotechnical Commission (2016) ISO/IEC 7816-6:2016 —
1053                             Identification cards — Integrated circuit cards — Part 6: Interindustry data
1054                             elements for interchange. (International Organization for Standardization,
1055                             Geneva, Switzerland) [or as amended]. Available at
1056                             https://www.iso.org/standard/64598.html
1057                          International Organization for Standardization/International
1058                             Electrotechnical Commission (2016) ISO/IEC 7816-8:2021 —
1059                             Identification cards — Integrated circuit cards — Part 8: Commands and
1060                             mechanisms for security operations. (International Organization for
1061                             Standardization, Geneva, Switzerland) [or as amended]. Available at
1062                             https://www.iso.org/standard/79893.html
1063                          International Organization for Standardization/International
1064                             Electrotechnical Commission (2017) ISO/IEC 7816-9:2017 —
1065                             Identification cards — Integrated circuit cards — Part 9: Commands for
1066                             card management. (International Organization for Standardization,
1067                             Geneva, Switzerland) [or as amended]. Available at
1068                             https://www.iso.org/standard/67802.html
1069
1070   [ISO8824]             International Organization for Standardization/International Electrotechnical
1071                         Commission (2021) ISO/IEC 8824-2:2021 — Information technology —
1072                         Abstract Syntax Notation One (ASN.1) – Part 2: Information object
1073                         specification. (International Organization for Standardization, Geneva,



                                                          38
       NIST SP 800-73pt2-5 ipd (Initial Public Draft)           Interfaces for Personal Identity Verification: Part 2
       September 2023                                              PIV Card Application Card Command Interface

1074                         Switzerland) [or as amended]. Available at
1075                         https://www.iso.org/standard/81417.html
1076   [ISO8825]             International Organization for Standardization/International Electrotechnical
1077                         Commission (2015) ISO/IEC 8825-1:2015— Information technology —
1078                         ASN.1 encoding rules: Specification of Basic Encoding Rules (BER),
1079                         Canonical Encoding Rules (CER) and Distinguished Encoding Rules (DER)
1080                         Part 1. (International Organization for Standardization, Geneva, Switzerland)
1081                         [or as amended]. Available at https://www.iso.org/standard/81420.html
1082   [PKCS1]               K. Moriarty, B. Kaliski, J. Jonsson, and A. Rusch, “Public-Key Cryptography
1083                         Standards (PKCS) #1: RSA Cryptography Specifications Version 2.2,” RFC
1084                         8017, November 2016. Available at https://www.rfc-editor.org/rfc/rfc8017
1085   [SECG]                Standards for Efficient Cryptography Group (SECG), “SEC 1: Elliptic Curve
1086                         Cryptography,” Version 2.0, May 2009.
1087   [SP800-38B]           Dworkin MJ (2005) Recommendation for Block Cipher Modes of Operation:
1088                         the CMAC Mode for Authentication. (National Institute of Standards and
1089                         Technology, Gaithersburg, MD), NIST Special Publication (SP) 800-38B,
1090                         Includes updates as of October 6, 2016 [or as amended].
1091                         https://doi.org/10.6028/NIST.SP.800-38B
1092   [SP800-56A]           Barker EB, Chen L, Roginsky AL, Vassilev A, Davis R (2018)
1093                         Recommendation for Pair-Wise Key-Establishment Schemes Using Discrete
1094                         Logarithm Cryptography. (National Institute of Standards and Technology,
1095                         Gaithersburg, MD), NIST Special Publication (SP) 800-56A, Rev. 3 [or as
1096                         amended]. https://doi.org/10.6028/NIST.SP.800-56Ar3
1097   [SP800-76]            Grother PJ, Salamon WJ, Chandramouli R (2013) Biometric Specifications
1098                         for Personal Identity Verification. (National Institute of Standards and
1099                         Technology, Gaithersburg, MD), NIST Special Publication (SP) 800-76-2 [or
1100                         as amended]. https://doi.org/10.6028/NIST.SP.800-76-2
1101   [SP800-78]            Polk WT, Dodson DF, Burr WE, Ferraiolo H, Cooper DA (2015)
1102                         Cryptographic Algorithms and Key Sizes for Personal Identity Verification.
1103                         (National Institute of Standards and Technology, Gaithersburg, MD), NIST
1104                         Special Publication (SP) 800-78-4 [or as amended].
1105                         https://doi.org/10.6028/NIST.SP.800-78-4
1106




                                                         39
       NIST SP 800-73pt2-5 ipd (Initial Public Draft)                 Interfaces for Personal Identity Verification: Part 2
       September 2023                                                    PIV Card Application Card Command Interface

1107   Appendix A. Examples of the Use of the GENERAL AUTHENTICATE Command

1108   A.1.     Authentication of the PIV Card Application Administrator
1109   The PIV Card Application Administrator is authenticated by the PIV Card Application using a
1110   challenge-response protocol. A challenge retrieved from the PIV Card Application is encrypted
1111   by the client application and returned to the PIV Card Application associated with key reference
1112   '9B', which is the key reference of the PIV Card Application Administration key. The PIV Card
1113   Application decrypts the response using this reference data and the algorithm associated with the
1114   key reference (e.g., AES-128 – ECB, algorithm identifier '08'). If this decrypted value matches
1115   the previously provided challenge, then the security status indicator of the PIV Card Application
1116   Administration key is set to TRUE within the PIV Card Application.
1117   Table 22 shows the GENERAL AUTHENTICATE card commands sent to the PIV Card
1118   Application to realize this particular challenge-response protocol.
1119                          Table 22. Authentication of PIV Card Application Administrator

                        Command                         Response                           Comment
              '00 87 08 9B 04 7C 02 81 00                                    The client application requests a
              00'                                                            challenge from the PIV Card
                                                                             Application.
                                              '7C 0A 81 08 01 02 03 04 05    The challenge ('01 02 03 04 05 06
                                              06 07 08 90 00'                07 08') returned to client application
                                                                             by the PIV Card Application.
              '00 87 08 9B 0C 7C 0A 82 08                                    The client application returns the
              88 77 66 55 44 33 22 11'                                       encryption of the challenge ('88 77
                                                                             66 55 44 33 22 11') referencing
                                                                             algorithm '08' and key reference '9B'
                                                                             [SP800-78, Tables 8 and 9].
                                              '90 00'                        The PIV Card Application indicates
                                                                             successful authentication of PIV
                                                                             Card Application Administrator after
                                                                             decrypting '88 77 66 55 44 33 22 11'
                                                                             using the referenced algorithm and
                                                                             key and getting '01 02 03 04 05 06
                                                                             07 08'.


1120   A.2.     Mutual Authentication of Client Application and Card Application
1121   The PIV Card Application Administrator and the PIV Card Application authenticate each other
1122   using a challenge-response protocol. A witness retrieved from the PIV Card Application is
1123   decrypted by the client application and returned to the PIV Card Application associated with key
1124   reference '9B', the key reference of the PIV Card Application Administration key. The command
1125   includes the decrypted witness and a challenge for the PIV Card Application. The PIV Card
1126   Application verifies that the decrypted witness matches the value that it encrypted to create the
1127   witness. If it does, then the security status indicator of the PIV Card Application Administration
1128   key is set to TRUE within the PIV Card Application, and the PIV Card Application encrypts the
1129   challenge that it received from the client application and returns the result. The witness and
1130   challenge are encrypted and decrypted using the same the key and algorithm. Table 23 shows the



                                                              40
       NIST SP 800-73pt2-5 ipd (Initial Public Draft)                                  Interfaces for Personal Identity Verification: Part 2
       September 2023                                                                     PIV Card Application Card Command Interface

1131   GENERAL AUTHENTICATE card commands sent to the PIV Card Application to realize
1132   mutual authentication using AES – ECB (algorithm identifier '08’).
1133                      Table 23. Mutual authentication of client application and PIV Card Application

                        Command                                     Response                                  Comment
              '00 87 08 9B 04 7C 02 80 00                                                       The client application requests a
              00'                                                                               witness from the PIV Card
                                                                                                Application.
                                                       '7C 0A 80 08 88 77 66 55 44              The PIV Card Application returns a
                                                       33 22 11 90 00'                          witness that is created by generating
                                                                                                8 bytes of random data ('01 02 03 04
                                                                                                05 06 07 08') and encrypting it using
                                                                                                the referenced key ('9B') and
                                                                                                algorithm ('08') [SP800-78, Tables 8
                                                                                                and 9].
              '00 87 08 9B 18 7C 16 80 08                                                       The client application returns the
              01 02 03 04 05 06 07 08 81 08                                                     decrypted witness (‘01 02 03 04 05
              09 0A 0B 0C 0D 0E 0F 10 82                                                        06 07 08’), which references
              00 00'                                                                            algorithm '08' and key reference
                                                                                                '9B'. The client application requests
                                                                                                the encryption of challenge data ('09
                                                                                                0A 0B 0C 0D 0E 0F 10') from the
                                                                                                card using the same key.
                                                       '7C 0A 82 08 11 FF EE DD                 The PIV Card Application
                                                       CC BB AA 99 90 00'                       authenticates the client application
                                                                                                by verifying the decrypted witness.
                                                                                                The PIV Card Application indicates
                                                                                                the successful authentication of the
                                                                                                PIV Card Application Administrator
                                                                                                and sends back the encrypted
                                                                                                challenge ('11 FF EE DD CC BB
                                                                                                AA 99'). The client application
                                                                                                authenticates the PIV Card
                                                                                                Application by decrypting the
                                                                                                encrypted challenge and getting ('09
                                                                                                0A 0B 0C 0D 0E 0F 10').


1134   A.3.       Authentication of PIV Cardholder
1135   The PIV cardholder is authenticated by first retrieving and validating either the X.509 Certificate
1136   for PIV Authentication or the X.509 Certificate for Card Authentication. Assuming that the
1137   certificate is valid, the client application requests the PIV Card Application to sign a challenge
1138   using the private key associated with this certificate (i.e., key reference '9A' or '9E') and the
1139   appropriate algorithm (e.g., algorithm identifier '07' 25), which CAN be determined from the
1140   certificate, as described in SP 800-73-5 Part 1, Appendix C.1. The response from the card is
1141   verified using the public key in the certificate. If the signature is verified, then the PIV
1142   cardholder is authenticated.
1143   Table 24 shows the GENERAL AUTHENTICATE card commands sent to the PIV Card
1144   Application to realize cardholder authentication when the X.509 Certificate for PIV
       25
          Higher strength keys are recommended starting in 2031, per SP 800-56 Part 1. See SP 800-78-5 Tables 9 and 10, which reflect support for
       higher strength keys for PIV cards and supporting systems, where applicable.



                                                                            41
       NIST SP 800-73pt2-5 ipd (Initial Public Draft)                                   Interfaces for Personal Identity Verification: Part 2
       September 2023                                                                      PIV Card Application Card Command Interface

1145   Authentication includes a 2048-bit 26 RSA public key. It is assumed that the cardholder PIN or
1146   OCC data has been successfully verified prior to sending the GENERAL AUTHENTICATE
1147   command.
1148                  Table 24. Validation of the PIV Card Application using GENERAL AUTHENTICATE

                      Command                                           Response                                      Comment
        '10 87 07 9A FF 7C 82 01 06 82 00                                                               The client application sends a
        81 82 01 00 00 01 FF FF FF FF ...                                                               challenge to the PIV Card
        FF FF FF FF FF 00 9D F4 6E 09                                                                   Application indicating that the
        E7 D6 19 18 53 1E 6E 1C 66 87 C4                                                                reference data associated with key
        3E CF FF 7D 53 47 BD 2E 93 19'                                                                  reference '9A' is to be used with
        ("..." represents 208 bytes of                                                                  algorithm '07' [SP800-78, Tables 9
        challenge data)                                                                                 and 10]. The challenge data, which
                                                                                                        in this example is encoded as
                                                                                                        specified for TLS version 1.3 client
                                                                                                        authentication, is '00 01 FF ... 18
                                                                                                        BC A7'. Bit 5 of the CLA byte is set
                                                                                                        to one to indicate that command
                                                                                                        chaining is needed. L e is absent to
                                                                                                        indicate that no data is expected.
                                                        ‘90 00’                                         The PIV Card Application indicates
                                                                                                        that it received the command
                                                                                                        successfully.
        '00 87 07 9A 0B 94 53 76 FE A7 91                                                               The client application sends the
        72 14 18 BC A7 00'                                                                              remaining data with the second and
                                                                                                        last command of the chain. L e is
                                                                                                        ‘00’ to indicate that the expected
                                                                                                        length of the response data field is
                                                                                                        256 bytes.
                                                        ‘7C 82 01 04 82 82 01 00 29 69 44               The PIV Card Application returns
                                                        3B 49 AC 5B 70 63 51 A1 5B B5                   the result of signing the challenge
                                                        … AD F7 0B 7D A6 4C 6C AA 62                    using the indicated key reference
                                                        40 C5 FA A8 7E A2 2B DC 92 18                   data and algorithm ('29 69 44 3B 49
                                                        56 8B CE F4 69 14 D9 83 61’08“                  AC…'). The last 2 bytes '61 08'
                                                        ("”.." represents 208 bytes of                  indicate that 8 more bytes are
                                                        response data)                                  available to read from the card.
        '00 C0 00 00 08'                                                                                The GET RESPONSE command is
                                                                                                        used to request the remaining 8
                                                                                                        bytes.
                                                        '30 1B 11 06 AE E2 F1 2E 90 00'                 The PIV Card Application sends the
                                                                                                        remaining 8 bytes.


1149   A.4.       Signature Generation With the Digital Signature Key
1150   The GENERAL AUTHENTICATE command CAN be used to generate signatures. The pre-
1151   signature hash and padding (if applicable) are computed off-card. The PIV Card Application
1152   receives the hashed value of the original message, applies the private signature key (key
1153   reference '9C'), and returns the resulting signature to the client application.



       26
          Higher strength keys are recommended starting in 2031, per SP 800-56 Part 1. See SP 800-78-5 Tables 9 and 10, which reflect support for
       higher strength keys for PIV cards and supporting systems, where applicable.



                                                                             42
       NIST SP 800-73pt2-5 ipd (Initial Public Draft)                                 Interfaces for Personal Identity Verification: Part 2
       September 2023                                                                    PIV Card Application Card Command Interface

1154   The card commands sent to the PIV Card Application to generate a signature are listed below. It
1155   is assumed that the cardholder PIN or OCC data has been successfully verified prior to sending
1156   the GENERAL AUTHENTICATE command.

1157   A.4.1. RSA
1158   This example illustrates signature generation using RSA 2048 27 (i.e., algorithm identifier '07').
1159   Command chaining is used in the first command since the padded hash value sent to the card for
1160   signature generation is bigger than the length of the data field.
1161   Command 1 — GENERAL AUTHENTICATE (first chain)
                      CLA                       '10' indicating command chaining
                      INS                       '87'
                      P1                        '07'
                      P2                        '9C'
                      Lc                        Length of data field
                                                '7C' – L1 { '82' '00' '81' L2 {first part of the PKCS #1 v1.5 or PSS
                      Data Field
                                                padded message hash value }}
                      Le                        Absent (no response expected)

1162   Response 1
                      Data Field                Absent
                      SW1-SW2                   '90 00' (Status word)

1163   Command 2 — GENERAL AUTHENTICATE (last chain)
                      CLA                       '00' indicates last command of the chain
                      INS                       '87'
                      P1                        '07'
                      P2                        '9C'
                      Lc                        Length of data field
                                                {second and last part of the PKCS #1 v1.5 or PSS padded message
                      Data Field
                                                hash value}
                      Le                        '00'

1164    Response 2
                      Data Field                '7C' – L1 {'82' L2 {first part of signature} }
                                                '61 xx', where xx indicates the number of bytes remaining to send by
                      SW1-SW2
                                                the PIV Card Application

1165   Command 3 — GET RESPONSE APDU)
                      CLA                       '00'
                      INS                       'C0'
                      P1                        '00'
                      P2                        '00'
                      Le                        xx length of remaining response as indicated by previous SW1-SW2



       27
         Higher strength keys are recommended per SP 800-56 Part 1 starting in 2031. See SP 800-78-5 Tables 9 and 10 which reflect support for
       higher strength keys for PIV cards and supporting system, where applicable.



                                                                            43
       NIST SP 800-73pt2-5 ipd (Initial Public Draft)                  Interfaces for Personal Identity Verification: Part 2
       September 2023                                                     PIV Card Application Card Command Interface

1166   Response 3
                   Data Field           {second and last part of signature}
                   SW1-SW2              '90 00' (Status word)


1167   A.4.2. ECDSA
1168   The following example illustrates signature generation with ECDSA using ECC: Curve P-256
1169   (i.e., algorithm identifier '11'). Command chaining is not used in this example, as the hash value
1170   fits into the data field of the command. Padding does not apply to ECDSA.
1171   Command — GENERAL AUTHENTICATE
                   CLA                  '00'
                   INS                  '87'
                   P1                   '11'
                   P2                   '9C'
                   Lc                   Length of data field
                   Data Field           '7C' – L1 { '82' '00' '81' L2 {hash value of message}}
                   Le                   '00'

1172   Response
                                        '7C' – L1 {'82' L2 (r,s)}, where
                                             • (r,s) is DER-encoded with the following ASN.1 structure:
                                                 Ecdsa-Sig-Value ::= SEQUENCE {
                                                         r INTEGER,
                   Data Field
                                                         s INTEGER }
                                             • L1 is the length of tag '82' TLV structure
                                             • L2 is the length of the DER-encoded Ecdsa-Sig-Value
                                                 structure
                   SW1-SW2              '90 00' (Status word)


1173   A.5.    Key Establishment Schemes With the PIV Key Management Key
1174   FIPS 201 specifies a public key pair and associated X.509 Certificate for Key Management. The
1175   key management key (KMK) is further defined in SP 800-78, which defines two distinct key
1176   establishment schemes for the KMK:
1177       1. RSA key transport and
1178       2. Elliptic Curve Diffie-Hellman (ECDH) key agreement.
1179   The use of the KMK for RSA key transport and ECDH key agreement is discussed in
1180   Appendices A.5.1 and A.5.2, respectively.

1181   A.5.1. RSA Key Transport
1182   In general, RSA transport keys are used to establish symmetric keys, where a sender encrypts a
1183   symmetric key with the receiver’s public key and sends the encrypted key to the receiver. The
1184   receiver decrypts the encrypted key with the corresponding private key. The decrypted
1185   symmetric key is subsequently used by both parties to protect further communication between



                                                               44
       NIST SP 800-73pt2-5 ipd (Initial Public Draft)                                   Interfaces for Personal Identity Verification: Part 2
       September 2023                                                                      PIV Card Application Card Command Interface

1186   them. Many types of security protocols employ the RSA key transport technique, such as
1187   Secure/Multipurpose Internet Mail Extensions (S/MIME) for secure email.

1188   A.5.1.1.              RSA Key Transport With the PIV KMK
1189   As specified in SP 800-78, the on-card private KMK CAN be an RSA transport key that
1190   complies with [PKCS1]. In the scenario described above, a sender encrypts a symmetric key with
1191   the public RSA transport key of the recipient’s KMK. The role of the on-card KMK private RSA
1192   transport key is to decrypt the sender’s symmetric key on behalf of the cardholder and provide it
1193   to the client application cryptographic module.

1194   A.5.1.1.1             GENERAL AUTHENTICATE Command

1195   The card commands sent to the PIV Card to decrypt the symmetric key are listed below. It is
1196   assumed that the cardholder’s PIN or OCC data has been successfully verified prior to sending
1197   the GENERAL AUTHENTICATE command to the card.
1198   Command 1 — GENERAL AUTHENTICATE (first chain)
          CLA                       '10' indicates command chaining
          INS                       '87'
          P1                        '07' 28
          P2                        '9D'
          Lc                        Length of data field
                                    '7C' – L1 {'82' '00' '81' L2 {first part of C}}, where C is the ciphertext to
          Data Field
                                    be decrypted, as defined in [PKCS1, Sections 7.1.2 and 7.2.2]
          Le                        Absent (no response expected)

1199   Response 1
       Data Field                Absent
       SW1-SW2                   '90 00' (Status word)

1200   Command 2 — GENERAL AUTHENTICATE (last chain)
          CLA                       '00' indicates last command of the chain
          INS                       '87'
          P1                        '07' 29
          P2                        '9D'
          Lc                        Length of data field
          Data Field                {second and last part of ciphertext to be decrypted C }}
          Le                        '00'

1201   Response 2
                                    '7C' – L1 {'82' L2 {first part of encoded message EM}}, where EM is as
          Data Field
                                    defined in [PKCS1, Sections 7.1.2 and 7.2.2]
          SW1-SW2                   '61 xx', where x indicates the number of bytes remaining to send


       28
          Higher strength keys are recommended starting in 2031, per SP 800-56 Part 1. See SP 800-78-5 Tables 9 and 10, which reflect support for
       higher strength keys for PIV cards and supporting systems, where applicable.
       29
          Higher strength keys are recommended starting in 2031, per SP 800-56 Part 1. See SP 800-78-5 Tables 9 and 10, which reflect support for
       higher strength keys for PIV cards and supporting systems, where applicable.



                                                                             45
       NIST SP 800-73pt2-5 ipd (Initial Public Draft)                   Interfaces for Personal Identity Verification: Part 2
       September 2023                                                      PIV Card Application Card Command Interface

1202   Command 3 — GET RESPONSE APDU
       CLA                  '00'
       INS                  'C0'
       P1                   '00'
       P2                   '00'
       Le                   xx length of remaining response, as indicated by previous SW1-SW2

1203   Response 3:
       Data Field           {second and last part of encoded message EM}
       SW1-SW2              '90 00' (Status word)


1204   A.5.2. Elliptic Curve Cryptography Diffie-Hellman
1205   An ECDH key agreement scheme does not send an encrypted symmetric key to the participating
1206   entities. Instead, the two entities involved in the key agreement scheme compute a shared secret
1207   by combining their ECC private key(s) with the other party’s public key(s). The resulting shared
1208   secret (Z) serves as an input to a key derivation function (KDF), which each entity independently
1209   invokes to derive a common secret key. The secret key MAY be used as a session key or to
1210   encrypt a session key.

1211   A.5.2.1.         ECDH With the PIV KMK
1212   The PIV Card supports ECDH key agreement by performing the elliptic curve cryptography
1213   cofactor Diffie-Hellman (ECC CDH) primitive [SP800-56A, Section 5.7.1.2] using its ECC
1214   KMK private key and an ECC public key that is provided as input to the GENERAL
1215   AUTHENTICATE command. All other procedures required to complete key agreement are
1216   performed by the cardholder’s client application and its associated cryptographic module.

1217   A.5.2.1.1        GENERAL AUTHENTICATE Command

1218   The sequence of commands to perform the ECC CDH primitive from [SP800-56A, Section
1219   5.7.1.2] with the private ECC KMK is illustrated below for ECC: Curve P-256.
1220   Command – GENERAL AUTHENTICATE
         CLA                  '00'
         INS                  '87'
         P1                   '11'
         P2                   '9D'
         Lc                   Length of data field
                              '7C' – L1 {'82' '00' '85' L2 { '04' || X || Y}}, where
                                   • '04' || X || Y is the other party’s public key, a point on Curve
                                        P-256, encoded without the use of point compression, as
         Data Field
                                        described in [SECG, Section 2.3.3].
                                   • The length of each coordinate (X and Y) is 32 bytes.
                                   • The value of L2 is 65 bytes.
         Le                   '00'




                                                               46
       NIST SP 800-73pt2-5 ipd (Initial Public Draft)                 Interfaces for Personal Identity Verification: Part 2
       September 2023                                                    PIV Card Application Card Command Interface

1221   Response:
                              '7C' – L1 {'82' L2 {shared secret Z}}, where
                                   • Z is the X coordinate of point P, as defined in [SP800-56A,
         Data Field
                                        Section 5.7.1.2]
                                   • L2 is 32 bytes.
         SW1-SW2              '90 00' (Status word)


1222   A.5.2.2.         PIV KMK-Specific ECDH Key Agreement Schemes
1223   SP 800-56A describes five different ECDH key agreement schemes that a client application
1224   cryptographic module MAY implement. These schemes differ in the number of keys (i.e., 1 or 2)
1225   and the type of keys (i.e., ephemeral or static) used by each party. Since the PIV Card only
1226   computes the ECC CDH primitive using its static private key, the client application
1227   cryptographic module only employs the PIV Card to implement an ECDH key agreement
1228   scheme when the scheme involves the use of the cardholder’s static key pair. The ECDH key
1229   agreement schemes that involve the use of at least one party’s static key pair and, thus, MAY
1230   involve the use of the PIV Card are:
1231       •   C(2e, 2s) — Each party has a static key pair and generates an ephemeral key pair [SP800-
1232           56A, Section 6.1.1].
1233           In this scheme, the information sent between the client application and the PIV Card is
1234           the same when acting as the initiator or the responder. The other party’s static public key
1235           is sent to the PIV Card, and a static shared secret is returned by the PIV Card in plaintext.
1236           Note that an ephemeral key pair is generated by the client application, and the private key
1237           of that key pair is combined with the other party’s ephemeral public key to produce an
1238           ephemeral shared secret.
1239       •   C(1e, 2s) — The initiator has a static key pair and generates an ephemeral key pair, while
1240           the responder has a static key pair [SP800-56A, Section 6.2.1].
1241           When the cardholder is acting as the initiator, the other party’s static public key is sent to
1242           the PIV Card, and a static shared secret is returned in plaintext by the PIV Card. Note
1243           that, in this case, an ephemeral key pair is generated by the client application’s
1244           cryptographic module, and the corresponding ephemeral private key is combined with the
1245           other party’s static public key to produce a second shared secret.
1246           When the cardholder is acting as the responder, two public keys are sent by the client
1247           application to the PIV Card (i.e., the other party’s static and ephemeral public keys), and
1248           two shared secrets are returned in plaintext (i.e., the static shared secret and the
1249           ephemeral shared secret). Note that two GENERAL AUTHENTICATE commands are
1250           required to provide the two shared secrets to the client application’s cryptographic
1251           module.
1252       •   C(1e, 1s) — The initiator only generates an ephemeral key pair, while the responder only
1253           has a static key pair [SP800-56A, Section 6.2.2].
1254           In this scheme, the PIV Card is only employed by the client application if the cardholder
1255           is acting as the responder. In this case, the other party’s ephemeral public key is sent to
1256           the PIV Card, and the shared secret is returned by the PIV Card in plaintext.


                                                             47
       NIST SP 800-73pt2-5 ipd (Initial Public Draft)                                      Interfaces for Personal Identity Verification: Part 2
       September 2023                                                                         PIV Card Application Card Command Interface

1257        •     C(0e, 2s) — Both the initiator and responder use only static key pairs [SP800-56A,
1258              Section 6.3].
1259              In the C(0e, 2s) scheme, the information sent between the client application’s
1260              cryptographic module and the PIV Card is the same when acting as the initiator or the
1261              responder. The other party’s static public key is sent to the PIV Card, and the static
1262              shared secret is returned in plaintext. Note that, for this scheme, the client application’s
1263              cryptographic module also generates a nonce when acting as the initiator of the scheme.
1264   The C(2e, 0s) scheme does not involve the use of static keys, so the PIV Card would not be
1265   involved in the implementation of this scheme.

1266   A.6.       Authentication of the PIV Cardholder Over the Virtual Contact Interface
1267   If the PIV Card supports the virtual contact interface, then all non-card management operations
1268   of the PIV Card Application MAY be performed over the contactless interface. In order to
1269   perform an operation that would otherwise be restricted to the contact interface, the key
1270   establishment protocol in Section 4.1 needs to be performed to establish session keys for secure
1271   messaging, and the pairing code needs to be submitted over secure messaging in order to
1272   establish a virtual contact interface. 30
1273   This appendix shows an example of the establishment of a VCI and its use to perform cardholder
1274   authentication using the PIV Authentication key. First, the GENERAL AUTHENTICATE
1275   command is used to perform the key establishment protocol. The VERIFY command is then
1276   used to submit the pairing code and establish the VCI. At that point, the GET DATA command
1277   is used to read the X.509 Certificate for PIV Authentication. The GENERAL AUTHENTICATE
1278   command is used to perform a challenge/response with the PIV Authentication key after the PIN
1279   is submitted using the VERIFY command.
1280                           Table 25: PIV Cardholder Authentication over Virtual Contact Interface

                    Command                                                Response                    Comment
        00 87 27 04 50 7C 4E 81 4A 00 00                                                The GENERAL AUTHENTICATE
        00 00 00 00 00 00 00 04 X Y 82 00                                               command is used to perform the
        00                                                                              key establishment protocol, as
                                                                                        specified in Section 4.1.8, where
                                                                                        cipher suite CS2 is being used, ID sH
                                                                                        is all zeros, and X and Y are the
                                                                                        coordinates of Q eH . X and Y are 32
                                                                                        bytes each.
                                                  7C L1 82 L2 00 N ICC                  The response for the key
                                                  AuthCryptogram ICC C ICC              establishment protocol, as specified
                                                                                        in Section 4.1.8, where N ICC and
                                                                                        AuthCryptogram ICC are 16 bytes
                                                                                        each and C ICC is as specified in
                                                                                        Section 4.1.5.
        After the client application verifies C ICC and the authentication cryptogram and validates the certificate(s) needed
        to verify the signature on C ICC , the PIV Card has been authenticated, and session keys for secure messaging have
        been established (SK ENC , SK MAC , and SK RMAC ).


       30
          As noted in SP 800-73-5 Part 1, Section 5.5, the pairing code does not need to be submitted if the Bit 3 of the first byte of the PIN Usage Policy
       is set to one.



                                                                                48
NIST SP 800-73pt2-5 ipd (Initial Public Draft)                      Interfaces for Personal Identity Verification: Part 2
September 2023                                                         PIV Card Application Card Command Interface

               Command                                  Response                                 Comment
 The VERIFY command is used to submit the pairing code (“65135275”) to the PIV Card Application.
 For the command, ENC C1 is the result of encrypting '36 35 31 33 35 32 37 35 80 00 00 00 00 00 00 00' using an
 IV of AES(SK ENC , '00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01') and T C-MAC,1 = CMAC(SK MAC , '00 00 00
 00 00 00 00 00 00 00 00 00 00 00 00 00 0C 20 00 98 80 00 00 00 00 00 00 00 00 00 00 00 87 11 01' || ENC C1 ).
 For the response, T R-MAC,1 = CMAC(SK RMAC , '00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 99 02 90 00').
 0C 20 00 98 1D 87 11 01 ENC C1                                                    The VERIFY command is used
 8E 08 T 8 (T C-MAC,1 ) 00                                                         over secure messaging to submit the
                                                                                   pairing code to the card.
                                          99 02 90 00 8E 08 T 8 (T R-MAC,1 ) 90    The card responds that the
                                          00                                       command has been successfully
                                                                                   executed and that the VCI has been
                                                                                   established.
 Once the VCI has been established, the GET DATA command MAY be used to retrieve the X.509 Certificate for
 PIV Authentication.
 For the command, ENC C2 is the result of encrypting '5C 03 5F C1 05 80 00 00 00 00 00 00 00 00 00 00' using an
 IV of AES(SK ENC , '00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 02'), and T C-MAC,2 is computed using T C-MAC,1
 as the MCV.
 For the response, ENC R2 is the result of encrypting the X.509 Certificate for the PIV Authentication data object
 encapsulated in BER-TLV format with tag '53' using an IV of AES(SK ENC , '80 00 00 00 00 00 00 00 00 00 00 00
 00 00 00 02'), and T R-MAC,2 is computed using T R-MAC,1 as the MCV.
 0C CB 3F FF 20 87 11 01 ENC C2                                                    The GET DATA command is used
 97 01 00 8E 08 T 8 (T C-MAC,2 ) 00                                                to request the X.509 Certificate for
                                                                                   PIV Authentication. The command
                                                                                   is submitted over VCI.
                                          87 82 05 91 01 <bytes 1 – 251 of         The response includes the tag,
                                          ENC R2 > 61 00                           length, and padding indicator bytes
                                                                                   of the BER-TLV-encoded
                                                                                   encrypted response data, the first
                                                                                   251 bytes of the encrypted
                                                                                   response, and an indicator that at
                                                                                   least 256 bytes of additional data is
                                                                                   available. The padding indicator is
                                                                                   '01' to indicate that padding was
                                                                                   applied.
 00 C0 00 00 00                                                                    Request the next 256 bytes of the
                                                                                   response.
                                          <bytes 252 – 507 of ENC R2 > 61 00 Return the next 256 bytes of the
                                                                                   response.
 …                                        …
 00 C0 00 00 A3                                                                    Request the final 163 bytes of the
                                                                                   response.
                                          <bytes 1276 – 1424 of ENC R2 > 99        Return the final 163 bytes of the
                                          02 90 00 8E 08 T 8 (T R-MAC,2 ) 90 00    response, including the BER-TLV-
                                                                                   encoded status word for the
                                                                                   command and the BER-TLV-
                                                                                   encoded R-MAC.
 At this point, the VERIFY command could be used to submit the PIV Card Application PIN to the PIV Card
 Application. However, in this example and for illustrative purposes only, a VERIFY command is sent to the card
 without a data field in order to retrieve the current value of the retry counter associated with the PIV Card
 Application PIV.
 0C 20 00 80 0A 8E 08 T 8 (T C-MAC,3 )                                             The VERIFY command is used to
 00                                                                                retrieve the number of additional
                                                                                   retries allowed for the PIV Card
                                                                                   Application PIN.



                                                           49
NIST SP 800-73pt2-5 ipd (Initial Public Draft)                      Interfaces for Personal Identity Verification: Part 2
September 2023                                                         PIV Card Application Card Command Interface

             Command                                 Response                                  Comment
                                         99 02 63 C3 8E 08 T 8 (T R-MAC,3 ) 90  The PIV Card Application indicates
                                         00                                     that three additional retries are
                                                                                allowed ('63 C3').
 The VERIFY command is used to submit the PIV Card Application PIN to the PIV Card Application. Other than
 the key reference and the PIN value, the command and response are the same as when using the VERIFY
 command to submit the pairing code.
 For the command, ENC C4 is the result of encrypting the PIN value along with the padding bytes using an IV of
 AES(SK ENC , '00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 04'), and T C-MAC,4 is computed using T C-MAC,3 as the
 MCV. (Note that the encryption counter used to generate the IV was incremented as a result of the previous
 VERIFY command even though no encryption was performed for that command.)
 For the response, T R-MAC,4 is computed using T R-MAC,3 as the MCV.
 0C 20 00 80 1D 87 11 01 ENC C4                                                 The VERIFY command is used to
 8E 08 T 8 (T C-MAC,4 ) 00                                                      submit the PIV Card Application
                                                                                PIN to the card.
                                         99 02 90 00 8E 08 T 8 (T R-MAC,4 ) 90  The card responds that the
                                         00                                     command has been successfully
                                                                                executed.
 Now that a virtual contact interface has been established and the PIV Card Application PIN has been verified,
 privileged operations MAY be performed over the contactless interface. The GENERAL AUTHENTICATE
 command is used to perform a challenge/response with the PIV Authentication key.
 For the command, ENC C5 is the result of encrypting the challenge along with the padding bytes using an IV of
 AES(SK ENC , '00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 05'), and T C-MAC,5 is computed using T C-MAC,4 as the
 MCV. The challenge to be encrypted is '7C 82 01 06 82 00 81 82 01 00 00 01 FF FF … BC A7' from the example
 in Table 24.
 For the response, ENC R5 is the result of encrypting the response along with the padding bytes using an IV of
 AES(SK ENC , '80 00 00 00 00 00 00 00 00 00 00 00 00 00 00 05'), and T R-MAC,5 is computed using T R-MAC,4 as the
 MCV. The response to be encrypted is '7C 82 01 04 82 82 01 00 29 69 44 3B … E2 F1 2E' from the example in
 Table 24.
 1C 87 07 9A FF 87 82 01 11 01                                                  The GENERAL AUTHENTICATE
 <bytes 1 – 250 of ENC C5 >                                                     command is used to send a
                                                                                challenge to the PIV Card. This
                                                                                command includes the first part of
                                                                                the challenge.
                                         90 00                                  The PIV Card Application indicates
                                                                                that it received the first part of the
                                                                                command successfully.
 0C 87 07 9A 23 <bytes 251 – 272                                                The remaining challenge data is
 of ENC C5 > 97 01 00 8E 08                                                     sent, including the BER-TLV-
 T 8 (T C-MAC,5 ) 00                                                            encoded L e and the BER-TLV-
                                                                                encoded C-MAC.
                                         87 82 01 11 01 <bytes 1 – 251 of       The PIV Card Application sends the
                                         ENC R5 > 61 1B                         first part of the result of signing the
                                                                                challenge. The padding indicator is
                                                                                '01' to indicate that padding was
                                                                                applied.
 00 C0 00 00 1B                                                                 The remaining portion of response
                                                                                is requested.
                                         <bytes 252 – 272 of ENC R5 > 99 02 The PIV Card Application sends the
                                         90 00 8E 08 T 8 (T R-MAC,5 ) 90 00     final portion of the result of signing
                                                                                the challenge, along with the BER-
                                                                                TLV-encoded status word and R-
                                                                                MAC.




                                                          50
       NIST SP 800-73pt2-5 ipd (Initial Public Draft)                                       Interfaces for Personal Identity Verification: Part 2
       September 2023                                                                          PIV Card Application Card Command Interface

1281   A.6.1. Authentication of the PIV Cardholder Using SM-AUTH
1282   PIV Cards that implement VCI or OCC use the key establishment protocol described Section 4.1
1283   to establish a secure messaging key and subsequently protect communication between the PIV
1284   Card and the host. During the key establishment protocol, the PIV Card and the Cardholder are
1285   authenticated. Departments and agencies CAN use these authentication steps as a stand-alone
1286   authentication mechanism known as SM-AUTH.
1287   The SM-AUTH authentication mechanism is performed with the GENERAL AUTHENTICATE
1288   command as follows:
1289                              Table 26: PIV Cardholder Authentication using Secure Messaging Key

                        Command                                             Response                       Comment
            00 87 27 04 50 7C 4E 81 4A 00 00                                                The GENERAL AUTHENTICATE
            00 00 00 00 00 00 00 04 X Y 82 00                                               command is used to perform the
            00                                                                              key establishment protocol, as
                                                                                            specified in Section 4.1.8, where
                                                                                            cipher suite CS2 is being used, ID sH
                                                                                            is all zeros, and X and Y are the
                                                                                            coordinates of Q eH . X and Y are 32
                                                                                            bytes each.
                                                      7C L1 82 L2 00 N ICC                  The response for the key
                                                      AuthCryptogram ICC C ICC              establishment protocol, as specified
                                                                                            in Section 4.1.8, where N ICC and
                                                                                            AuthCryptogram ICC are 16 bytes
                                                                                            each, and C ICC is as specified in
                                                                                            Section 4.1.5
            After the client application verifies C ICC and the authentication cryptogram and validates the certificate(s) needed
            to verify the signature on C ICC , the PIV Card has been authenticated, and session keys for secure messaging have
            been established (SK ENC , SK MAC , and SK RMAC ). The session keys are zeroized since they are not used 31 in
            subsequent communication.
1290
1291




       31
            Bits b3 and b4 of the CLA byte are set to zero to indicate that further communication with the card will not be encrypted.



                                                                                 51
       NIST SP 800-73pt2-5 ipd (Initial Public Draft)             Interfaces for Personal Identity Verification: Part 2
       September 2023                                                PIV Card Application Card Command Interface

1292   Appendix B. List of Symbols, Abbreviations, and Acronyms
1293   AES
1294   Advanced Encryption Standard

1295   AID
1296   Application Identifier

1297   APDU
1298   Application Protocol Data Unit

1299   API
1300   Application Programming Interface

1301   APT
1302   Application Property Template

1303   ASCII
1304   American Standard Code for Information Interchange

1305   ASN.1
1306   Abstract Syntax Notation One

1307   BER
1308   Basic Encoding Rules

1309   BIT
1310   Biometric Information Template

1311   CLA
1312   Class (first) byte of a card command

1313   CMAC
1314   Cipher-Based Message Authentication Code

1315   C-MAC
1316   Command Message Authentication Code

1317   CVC
1318   Card Verifiable Certificate

1319   DER
1320   Distinguished Encoding Rules

1321   ECB
1322   Electronic Codebook

1323   ECC
1324   Elliptic Curve Cryptography

1325   ECDSA
1326   Elliptic Curve Digital Signature Algorithm

1327   ECDH
1328   Elliptic Curve Diffie-Hellman

1329   EC CDH
1330   Elliptic Curve Cryptography Cofactor Diffie-Hellman




                                                             52
       NIST SP 800-73pt2-5 ipd (Initial Public Draft)                  Interfaces for Personal Identity Verification: Part 2
       September 2023                                                     PIV Card Application Card Command Interface

1331   FIPS
1332   Federal Information Processing Standard

1333   FISMA
1334   Federal Information Security Management Act

1335   HSPD
1336   Homeland Security Presidential Directive

1337   ICC
1338   Integrated Circuit Card

1339   IEC
1340   International Electrotechnical Commission

1341   IETF
1342   Internet Engineering Task Force

1343   INS
1344   Instruction (second) byte of a card command

1345   INCITS
1346   InterNational Committee for Information Technology Standards

1347   ISO
1348   International Organization for Standardization

1349   ITL
1350   Information Technology Laboratory

1351   KDF
1352   Key Derivation Function

1353   LSB
1354   Least Significant Bit

1355   MAC
1356   Message Authentication Code

1357   MSB
1358   Most Significant Bit

1359   MCV
1360   MAC Chaining Value

1361   NIST
1362   National Institute of Standards and Technology

1363   OCC
1364   On-Card Biometric Comparison

1365   OID
1366   Object Identifier

1367   OMB
1368   Office of Management and Budget

1369   OPACITY
1370   Open Protocol for Access Control, Identification, and Ticketing with privacY




                                                               53
       NIST SP 800-73pt2-5 ipd (Initial Public Draft)        Interfaces for Personal Identity Verification: Part 2
       September 2023                                           PIV Card Application Card Command Interface

1371   P1
1372   First parameter of a card command

1373   P2
1374   Second parameter of a card command

1375   PKCS
1376   Public-Key Cryptography Standards

1377   PIN
1378   Personal Identification Number

1379   PIV
1380   Personal Identity Verification

1381   PIX
1382   Proprietary Identifier extension

1383   PUK
1384   PIN Unblocking Key

1385   RFU
1386   Reserved for Future Use

1387   RID
1388   Registered Application Provider Identifier

1389   R-MAC
1390   Response Message Authentication Code

1391   RSA
1392   Rivest–Shamir–Adleman

1393   SM
1394   Secure Messaging

1395   S/MIME
1396   Secure/Multipurpose Internet Mail Extensions

1397   SP
1398   Special Publication

1399   SW1
1400   First byte of a 2-byte status word

1401   SW2
1402   Second byte of a 2-byte status word

1403   TLS
1404   Transport Layer Security

1405   TLV
1406   Tag-Length-Value

1407   VCI
1408   Virtual Contact Interface




                                                        54
       NIST SP 800-73pt2-5 ipd (Initial Public Draft)                       Interfaces for Personal Identity Verification: Part 2
       September 2023                                                          PIV Card Application Card Command Interface

1409   Appendix C. Glossary
1410   application identifier
1411   A globally unique identifier of a card application. [ISO7816, Part 4, adapted]

1412   algorithm identifier
1413   A 1-byte identifier that specifies a cryptographic algorithm and key size. For symmetric cryptographic operations,
1414   the algorithm identifier also specifies a mode of operation (i.e., ECB).

1415   Authenticable entity
1416   An entity that can successfully participate in an authentication protocol with a card application.

1417   BER-TLV data object
1418   A data object coded according to ISO/IEC 8824-2:2021.

1419   Card
1420   An integrated circuit card.

1421   Card application
1422   A set of data objects and card commands that can be selected using an application identifier.

1423   Card management operation
1424   Any operation involving the PIV Card Application Administrator.

1425   Card Verifiable Certificate
1426   A certificate stored on the card that includes a public key, the signature of a certification authority, and the
1427   information needed to verify the certificate.

1428   Data object
1429   An item of information seen at the card command interface for which is specified a name, a description of logical
1430   content, a format, and a coding.

1431   Key reference
1432   A 1-byte identifier that specifies a cryptographic key according to its PIV Key Type. The identifier is part of
1433   cryptographic material used in a cryptographic protocol, such as an authentication or a signing protocol.

1434   MAC Chaining Value
1435   A 16-byte value that is an input to the CMAC function and used to detect communication errors in duplicate or
1436   missing commands.

1437   Object identifier
1438   A globally unique identifier of a data object. [ISO8824, adapted]

1439   reference data
1440   Cryptographic material used in the performance of a cryptographic protocol, such as an authentication or a signing
1441   protocol. The reference data length is the maximum length of a password or PIN. For algorithms, the reference data
1442   length is the length of a key.

1443   status word
1444   Two bytes returned by an integrated circuit card after processing any command that signify the success of or errors
1445   encountered during said processing.

1446   template
1447   A (constructed) BER-TLV data object whose value field contains specific BER-TLV data objects.




                                                                   55
       NIST SP 800-73pt2-5 ipd (Initial Public Draft)           Interfaces for Personal Identity Verification: Part 2
       September 2023                                              PIV Card Application Card Command Interface

1448   Appendix D. Notation
1449   The 16 hexadecimal digits SHALL be denoted using the alphanumeric characters 0, 1, 2, …, 9,
1450   A, B, C, D, E, and F. A byte consists of two hexadecimal digits, such as '2D'. The two
1451   hexadecimal digits are represented in quotations '2D' or as 0x2D. A sequence of bytes MAY be
1452   enclosed in single quotation marks (e.g., 'A0 00 00 01 16') rather than given as a sequence of
1453   individual bytes (e.g., 'A0' '00' '00' '01' '16').
1454   A byte can also be represented by bits b8 to b1, where b8 is the most significant bit (MSB) and
1455   b1 is the least significant bit (LSB) of the byte. In textual or graphic representations, the leftmost
1456   bit is the MSB. Thus, for example, the most significant bit b8 of '80' is 1, and the least significant
1457   bit b1 is 0.
1458   All bytes specified as RFU SHALL be set to '00', and all bits specified as RFU SHALL be set to
1459   0.
1460   All lengths SHALL be measured in number of bytes unless otherwise noted.
1461   The expression 'X' & 'Y' is a bitwise AND operation between bytes 'X' and 'Y'.
1462   The symbol || means concatenation of byte strings. For example, if X is '00 01 02' and Y is '03 04
1463   05', then X || Y is '00 01 02 03 04 05'.
1464   Data objects in templates are described as being mandatory (M), optional (O), or conditional (C).
1465   Mandatory means that the data object SHALL appear in the template. Optional means that the
1466   data object MAY appear in the template. For conditional data objects, the conditions under
1467   which they are required are provided.
1468   In other tables, the M/O/C column identifies properties of the PIV Card Application that SHALL
1469   be present (M), may be present (O), or are conditionally required to be present (C).
1470   BER-TLV data object tags are represented as byte sequences, as described above. Thus, for
1471   example, 0x4F is the interindustry data object tag for an application identifier, and 0x7F60 is the
1472   interindustry data object tag for the Biometric Information Templates Group template.
1473   This document uses the following typographical conventions in text:
1474       •   ASN.1 data types are represented in a monospaced font. For example, SignedData and
1475           SignerInfo are data types defined for digital signatures.
1476       •   Specific terms in CAPITALS represent normative requirements. When these same terms
1477           are not in CAPITALS, the term does not represent a normative requirement.
1478       •   The terms SHALL and SHALL NOT indicate requirements to be strictly followed in
1479           order to conform to the publication and from which no deviation is permitted.
1480       •   The terms SHOULD and SHOULD NOT indicate that among several possibilities, one
1481           is recommended as particularly suitable without mentioning or excluding others, that a
1482           certain course of action is preferred but not necessarily required, or that — in the negative
1483           form — a certain possibility or course of action is discouraged but not prohibited.
1484       •   The terms MAY and NEED NOT indicate a course of action that is permissible within
1485           the limits of the publication.




                                                         56
       NIST SP 800-73pt2-5 ipd (Initial Public Draft)        Interfaces for Personal Identity Verification: Part 2
       September 2023                                           PIV Card Application Card Command Interface

1486       •   The terms CAN and CANNOT indicate a material, physical, or causal possibility or
1487           capability or — in the negative — the absence of that possibility or capability.
1488




                                                        57
